<tal:token condition="view/token" tal:define="use_domain context/@@si-use-domain|nothing">
    <script src="https://cdn.siteimprove.net/cms/overlay.js" async></script>
    <tal:tag replace="structure string:<script>"/>
        var _siteimprove_token = '${view/token}';
        document.addEventListener("DOMContentLoaded", function(event) {
            require(['jquery', 'siteimprove'], function ($, siteimprove) {
                <tal:not_domain condition="not:use_domain">siteimprove.input();</tal:not_domain>
                <tal:domain condition="use_domain">siteimprove.domain();</tal:domain>
                <tal:recheck condition="view/recheck|nothing">siteimprove.recheck();</tal:recheck>
                $('#plone-contentmenu-actions-siteimprove').on('click', function () {
                    siteimprove.recheck();
                    $(this).parents('li').removeClass('active');
                    $('#global_statusmessage > div').append(
                        '<div class="portalMessage info"> <strong>Info</strong>Siteimprove recheck requested</div>'
                    );
                    return false;
                });
            });
        });
    <tal:tag replace="structure string:</script>"/>
</tal:token>

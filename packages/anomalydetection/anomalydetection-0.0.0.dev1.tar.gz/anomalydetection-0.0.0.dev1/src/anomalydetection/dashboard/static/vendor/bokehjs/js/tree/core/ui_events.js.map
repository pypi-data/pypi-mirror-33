{"version":3,"sources":["core/ui_events.ts"],"names":[],"mappings":"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","file":"ui_events.js","sourcesContent":["import * as Hammer from \"hammerjs\"\n\nimport {Input} from \"hammerjs\"\nexport type HammerEvent = typeof Input\n\nimport {Signal} from \"./signaling\"\nimport {DOMView} from \"./dom_view\"\nimport {logger} from \"./logging\"\nimport {offset, Keys} from \"./dom\"\nimport {getDeltaY} from \"./util/wheel\"\nimport {reversed} from \"./util/array\"\nimport {isEmpty} from \"./util/object\"\nimport {isString} from \"./util/types\"\nimport {BokehEvent} from \"./bokeh_events\"\nimport {PlotCanvasView} from \"../models/plots/plot_canvas\"\nimport {Plot} from \"../models/plots/plot\"\nimport {Toolbar} from \"../models/tools/toolbar\"\nimport {ToolView} from \"../models/tools/tool\"\n\nexport const is_mobile = 'ontouchstart' in window || navigator.maxTouchPoints > 0\n\nexport interface UIEvent {\n  type: string\n  sx: number\n  sy: number\n}\n\nexport interface GestureEvent extends UIEvent {\n  deltaX: number\n  deltaY: number\n  scale: number\n  shiftKey: boolean\n}\n\nexport interface TapEvent extends UIEvent {\n  shiftKey: boolean\n}\n\nexport interface MoveEvent extends UIEvent {}\n\nexport interface ScrollEvent extends UIEvent {\n  delta: number\n}\n\nexport interface KeyEvent {\n  type: string\n  keyCode: Keys\n}\n\nexport type EventType = \"pan\" | \"pinch\" | \"rotate\" | \"move\" | \"tap\" | \"press\" | \"scroll\"\n\nexport type UISignal<E> = Signal<{id: string | null, e: E}, UIEvents>\n\nexport class UIEvents {\n\n  readonly pan_start    : UISignal<GestureEvent> = new Signal(this, 'pan:start')\n  readonly pan          : UISignal<GestureEvent> = new Signal(this, 'pan')\n  readonly pan_end      : UISignal<GestureEvent> = new Signal(this, 'pan:end')\n  readonly pinch_start  : UISignal<GestureEvent> = new Signal(this, 'pinch:start')\n  readonly pinch        : UISignal<GestureEvent> = new Signal(this, 'pinch')\n  readonly pinch_end    : UISignal<GestureEvent> = new Signal(this, 'pinch:end')\n  readonly rotate_start : UISignal<GestureEvent> = new Signal(this, 'rotate:start')\n  readonly rotate       : UISignal<GestureEvent> = new Signal(this, 'rotate')\n  readonly rotate_end   : UISignal<GestureEvent> = new Signal(this, 'rotate:end')\n\n  readonly tap          : UISignal<TapEvent>     = new Signal(this, 'tap')\n  readonly doubletap    : UISignal<TapEvent>     = new Signal(this, 'doubletap')\n  readonly press        : UISignal<TapEvent>     = new Signal(this, 'press')\n\n  readonly move_enter   : UISignal<MoveEvent>    = new Signal(this, 'move:enter')\n  readonly move         : UISignal<MoveEvent>    = new Signal(this, 'move')\n  readonly move_exit    : UISignal<MoveEvent>    = new Signal(this, 'move:exit')\n\n  readonly scroll       : UISignal<ScrollEvent>  = new Signal(this, 'scroll')\n\n  readonly keydown      : UISignal<KeyEvent>     = new Signal(this, 'keydown')\n  readonly keyup        : UISignal<KeyEvent>     = new Signal(this, 'keyup')\n\n  protected readonly hammer = new Hammer(this.hit_area)\n\n  constructor(readonly plot_view: PlotCanvasView,\n              readonly toolbar: Toolbar,\n              readonly hit_area: HTMLElement,\n              readonly plot: Plot) {\n    this._configure_hammerjs()\n  }\n\n  protected _configure_hammerjs(): void {\n    // This is to be able to distinguish double taps from single taps\n    this.hammer.get('doubletap').recognizeWith('tap')\n    this.hammer.get('tap').requireFailure('doubletap')\n    this.hammer.get('doubletap').dropRequireFailure('tap')\n\n    this.hammer.on('doubletap', (e) => this._doubletap(e))\n    this.hammer.on('tap', (e) => this._tap(e))\n    this.hammer.on('press', (e) => this._press(e))\n\n    this.hammer.get('pan').set({ direction: Hammer.DIRECTION_ALL })\n    this.hammer.on('panstart', (e) => this._pan_start(e))\n    this.hammer.on('pan', (e) => this._pan(e))\n    this.hammer.on('panend', (e) => this._pan_end(e))\n\n    this.hammer.get('pinch').set({ enable: true })\n    this.hammer.on('pinchstart', (e) => this._pinch_start(e))\n    this.hammer.on('pinch', (e) => this._pinch(e))\n    this.hammer.on('pinchend', (e) => this._pinch_end(e))\n\n    this.hammer.get('rotate').set({ enable: true })\n    this.hammer.on('rotatestart', (e) => this._rotate_start(e))\n    this.hammer.on('rotate', (e) => this._rotate(e))\n    this.hammer.on('rotateend', (e) => this._rotate_end(e))\n\n    this.hit_area.addEventListener(\"mousemove\", (e) => this._mouse_move(e))\n    this.hit_area.addEventListener(\"mouseenter\", (e) => this._mouse_enter(e))\n    this.hit_area.addEventListener(\"mouseleave\", (e) => this._mouse_exit(e))\n\n    this.hit_area.addEventListener(\"wheel\", (e) => this._mouse_wheel(e))\n\n    document.addEventListener(\"keydown\", (e) => this._key_down(e))\n    document.addEventListener(\"keyup\", (e) => this._key_up(e))\n  }\n\n  register_tool(tool_view: ToolView): void {\n    const et = tool_view.model.event_type\n\n    if (et != null) {\n      if (isString(et))\n        this._register_tool(tool_view, et)\n      else {\n        // Multi-tools should only registered shared events once\n        et.forEach((e, index) => this._register_tool(tool_view, e, index < 1))\n      }\n    }\n  }\n\n  private _register_tool(tool_view: ToolView, et: EventType, shared: boolean = true): void {\n    const v = tool_view\n    const {id} = v.model\n\n    const conditionally = <T>(fn: (e: T) => void) => (arg: {id: string | null, e: T}): void => {\n      if (arg.id == id) fn(arg.e)\n    }\n\n    const unconditionally = <T>(fn: (e: T) => void) => (arg: {id: string | null, e: T}): void => {\n      fn(arg.e)\n    }\n\n    switch (et) {\n      case \"pan\": {\n        if (v._pan_start != null)    v.connect(this.pan_start,    conditionally(v._pan_start.bind(v)))\n        if (v._pan != null)          v.connect(this.pan,          conditionally(v._pan.bind(v)))\n        if (v._pan_end != null)      v.connect(this.pan_end,      conditionally(v._pan_end.bind(v)))\n        break\n      }\n      case \"pinch\": {\n        if (v._pinch_start != null)  v.connect(this.pinch_start,  conditionally(v._pinch_start.bind(v)))\n        if (v._pinch != null)        v.connect(this.pinch,        conditionally(v._pinch.bind(v)))\n        if (v._pinch_end != null)    v.connect(this.pinch_end,    conditionally(v._pinch_end.bind(v)))\n        break\n      }\n      case \"rotate\": {\n        if (v._rotate_start != null) v.connect(this.rotate_start, conditionally(v._rotate_start.bind(v)))\n        if (v._rotate != null)       v.connect(this.rotate,       conditionally(v._rotate.bind(v)))\n        if (v._rotate_end != null)   v.connect(this.rotate_end,   conditionally(v._rotate_end.bind(v)))\n        break\n      }\n      case \"move\": {\n        if (v._move_enter != null)   v.connect(this.move_enter,   conditionally(v._move_enter.bind(v)))\n        if (v._move != null)         v.connect(this.move,         conditionally(v._move.bind(v)))\n        if (v._move_exit != null)    v.connect(this.move_exit,    conditionally(v._move_exit.bind(v)))\n        break\n      }\n      case \"tap\": {\n        if (v._tap != null)          v.connect(this.tap,          conditionally(v._tap.bind(v)))\n        break\n      }\n      case \"press\": {\n        if (v._press != null)        v.connect(this.press,        conditionally(v._press.bind(v)))\n        break\n      }\n      case \"scroll\": {\n        if (v._scroll != null)       v.connect(this.scroll,       conditionally(v._scroll.bind(v)))\n        break\n      }\n      default:\n        throw new Error(`unsupported event_type: ${et}`)\n    }\n\n    // Skip shared events if registering multi-tool\n    if (!shared)\n      return\n\n    if (v._doubletap != null)\n      v.connect(this.doubletap, unconditionally(v._doubletap.bind(v)))\n\n    if (v._keydown != null)\n      v.connect(this.keydown, unconditionally(v._keydown.bind(v)))\n\n    if (v._keyup != null)\n      v.connect(this.keyup, unconditionally(v._keyup.bind(v)))\n\n    // Dual touch hack part 1/2\n    // This is a hack for laptops with touch screen who may be pinching or scrolling\n    // in order to use the wheel zoom tool. If it's a touch screen the WheelZoomTool event\n    // will be linked to pinch. But we also want to trigger in the case of a scroll.\n    if (is_mobile && v._scroll != null && et == 'pinch') {\n      logger.debug(\"Registering scroll on touch screen\")\n      v.connect(this.scroll, conditionally(v._scroll.bind(v)))\n    }\n  }\n\n  protected _hit_test_renderers(sx: number, sy: number): DOMView | null {\n    const views = this.plot_view.get_renderer_views()\n\n    for (const view of reversed(views)) {\n      const {level} = view.model\n      if ((level == 'annotation' || level == 'overlay') && view.bbox != null) {\n        if (view.bbox().contains(sx, sy))\n          return view\n      }\n    }\n\n    return null\n  }\n\n  protected _hit_test_frame(sx: number, sy: number): boolean {\n    return this.plot_view.frame.bbox.contains(sx, sy)\n  }\n\n  _trigger<E extends UIEvent>(signal: UISignal<E>, e: E, srcEvent: Event): void {\n    const gestures = this.toolbar.gestures\n    type BaseType = keyof typeof gestures\n\n    let event_type = signal.name\n    const base_type = event_type.split(\":\")[0] as BaseType\n    const view = this._hit_test_renderers(e.sx, e.sy)\n\n    switch (base_type) {\n      case \"move\": {\n        const active_gesture = gestures[base_type].active\n        if (active_gesture != null)\n          this.trigger(signal, e, active_gesture.id)\n\n        const active_inspectors = this.toolbar.inspectors.filter(t => t.active)\n        let cursor = \"default\"\n\n        // the event happened on a renderer\n        if (view != null) {\n          cursor = view.cursor || cursor\n\n          if (!isEmpty(active_inspectors)) {\n            // override event_type to cause inspectors to clear overlays\n            signal = this.move_exit\n            event_type = signal.name\n          }\n\n        // the event happened on the plot frame but off a renderer\n        } else if (this._hit_test_frame(e.sx, e.sy)) {\n          if (!isEmpty(active_inspectors)) {\n            cursor = \"crosshair\"\n          }\n        }\n\n        this.plot_view.set_cursor(cursor)\n        active_inspectors.map((inspector) => this.trigger(signal, e, inspector.id))\n        break\n      }\n      case \"tap\": {\n        const {target} = srcEvent\n        if (target != null && target != this.hit_area)\n          return // don't trigger bokeh events\n\n        if (view != null && view.on_hit != null)\n          view.on_hit(e.sx, e.sy)\n\n        const active_gesture = gestures[base_type].active\n        if (active_gesture != null)\n          this.trigger(signal, e, active_gesture.id)\n        break\n      }\n      case \"scroll\": {\n        // Dual touch hack part 2/2\n        // This is a hack for laptops with touch screen who may be pinching or scrolling\n        // in order to use the wheel zoom tool. If it's a touch screen the WheelZoomTool event\n        // will be linked to pinch. But we also want to trigger in the case of a scroll.\n        const base = is_mobile ? \"pinch\" : \"scroll\"\n        const active_gesture = gestures[base].active\n        if (active_gesture != null) {\n          srcEvent.preventDefault()\n          srcEvent.stopPropagation()\n          this.trigger(signal, e, active_gesture.id)\n        }\n        break\n      }\n      default: {\n        const active_gesture = gestures[base_type].active\n        if (active_gesture != null)\n          this.trigger(signal, e, active_gesture.id)\n      }\n    }\n\n    this._trigger_bokeh_event(e)\n  }\n\n  trigger<E>(signal: UISignal<E>, e: E, id: string | null = null): void {\n    signal.emit({id, e})\n  }\n\n  protected _trigger_bokeh_event(e: UIEvent): void {\n    const event_cls = BokehEvent.event_class(e)\n    if (event_cls != null)\n      this.plot.trigger_event(event_cls.from_event(e))\n    else\n      logger.debug(`Unhandled event of type ${e.type}`)\n  }\n\n  protected _get_sxy(event: TouchEvent | MouseEvent | PointerEvent): {sx: number, sy: number} {\n    // XXX: jsdom doesn't support TouchEvent constructor\n    function is_touch(event: TouchEvent | MouseEvent | PointerEvent): event is TouchEvent {\n      return typeof TouchEvent !== \"undefined\" && event instanceof TouchEvent\n    }\n    const {pageX, pageY} = is_touch(event) ? (event.touches.length != 0 ? event.touches : event.changedTouches)[0] : event\n    const {left, top} = offset(this.hit_area)\n    return {\n      sx: pageX - left,\n      sy: pageY - top,\n    }\n  }\n\n  protected _gesture_event(e: HammerEvent): GestureEvent {\n    return {\n      type: e.type,\n      ...this._get_sxy(e.srcEvent),\n      deltaX: e.deltaX,\n      deltaY: e.deltaY,\n      scale: e.scale,\n      shiftKey: e.srcEvent.shiftKey,\n    }\n  }\n\n  protected _tap_event(e: HammerEvent): TapEvent {\n    return {\n      type: e.type,\n      ...this._get_sxy(e.srcEvent),\n      shiftKey: e.srcEvent.shiftKey,\n    }\n  }\n\n  protected _move_event(e: MouseEvent): MoveEvent {\n    return {type: e.type, ...this._get_sxy(e)}\n  }\n\n  protected _scroll_event(e: WheelEvent): ScrollEvent {\n    return {type: e.type, ...this._get_sxy(e), delta: getDeltaY(e)}\n  }\n\n  protected _key_event(e: KeyboardEvent): KeyEvent {\n    return {type: e.type, keyCode: e.keyCode}\n  }\n\n  protected _pan_start(e: HammerEvent): void {\n    const ev = this._gesture_event(e)\n    // back out delta to get original center point\n    ev.sx -= e.deltaX\n    ev.sy -= e.deltaY\n    this._trigger(this.pan_start, ev, e.srcEvent)\n  }\n\n  protected _pan(e: HammerEvent): void {\n    this._trigger(this.pan, this._gesture_event(e), e.srcEvent)\n  }\n\n  protected _pan_end(e: HammerEvent): void {\n    this._trigger(this.pan_end, this._gesture_event(e), e.srcEvent)\n  }\n\n  protected _pinch_start(e: HammerEvent): void {\n    this._trigger(this.pinch_start, this._gesture_event(e), e.srcEvent)\n  }\n\n  protected _pinch(e: HammerEvent): void {\n    this._trigger(this.pinch, this._gesture_event(e), e.srcEvent)\n  }\n\n  protected _pinch_end(e: HammerEvent): void {\n    this._trigger(this.pinch_end, this._gesture_event(e), e.srcEvent)\n  }\n\n  protected _rotate_start(e: HammerEvent): void {\n    this._trigger(this.rotate_start, this._gesture_event(e), e.srcEvent)\n  }\n\n  protected _rotate(e: HammerEvent): void {\n    this._trigger(this.rotate, this._gesture_event(e), e.srcEvent)\n  }\n\n  protected _rotate_end(e: HammerEvent): void {\n    this._trigger(this.rotate_end, this._gesture_event(e), e.srcEvent)\n  }\n\n  protected _tap(e: HammerEvent): void {\n    this._trigger(this.tap, this._tap_event(e), e.srcEvent)\n  }\n\n  protected _doubletap(e: HammerEvent): void {\n    // NOTE: doubletap event triggered unconditionally\n    const ev = this._tap_event(e)\n    this._trigger_bokeh_event(ev)\n    this.trigger(this.doubletap, ev)\n  }\n\n  protected _press(e: HammerEvent): void {\n    this._trigger(this.press, this._tap_event(e), e.srcEvent)\n  }\n\n  protected _mouse_enter(e: MouseEvent): void {\n    this._trigger(this.move_enter, this._move_event(e), e)\n  }\n\n  protected _mouse_move(e: MouseEvent): void {\n    this._trigger(this.move, this._move_event(e), e)\n  }\n\n  protected _mouse_exit(e: MouseEvent): void {\n    this._trigger(this.move_exit, this._move_event(e), e)\n  }\n\n  protected _mouse_wheel(e: WheelEvent): void {\n    this._trigger(this.scroll, this._scroll_event(e), e)\n  }\n\n  protected _key_down(e: KeyboardEvent): void {\n    // NOTE: keyup event triggered unconditionally\n    this.trigger(this.keydown, this._key_event(e))\n  }\n\n  protected _key_up(e: KeyboardEvent): void {\n    // NOTE: keyup event triggered unconditionally\n    this.trigger(this.keyup, this._key_event(e))\n  }\n}\n"]}
{"version":3,"sources":["models/glyphs/ellipse.ts"],"names":[],"mappings":"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","file":"ellipse.js","sourcesContent":["import {XYGlyph, XYGlyphView, XYGlyphData} from \"./xy_glyph\"\nimport {DistanceSpec, AngleSpec} from \"core/vectorization\"\nimport {LineMixinVector, FillMixinVector} from \"core/property_mixins\"\nimport {Line, Fill} from \"core/visuals\"\nimport {Arrayable} from \"core/types\"\nimport * as p from \"core/properties\"\nimport {IBBox} from \"core/util/bbox\"\nimport {Rect} from \"core/util/spatial\"\nimport {Context2d} from \"core/util/canvas\"\n\nexport interface EllipseData extends XYGlyphData {\n  _angle: Arrayable<number>\n  _width: Arrayable<number>\n  _height: Arrayable<number>\n\n  sw: Arrayable<number>\n  sh: Arrayable<number>\n\n  max_width: number\n  max_height: number\n\n  max_w2: number\n  max_h2: number\n}\n\nexport interface EllipseView extends EllipseData {}\n\nexport class EllipseView extends XYGlyphView {\n  model: Ellipse\n  visuals: Ellipse.Visuals\n\n  protected _set_data(): void {\n    this.max_w2 = 0\n    if (this.model.properties.width.units == \"data\")\n      this.max_w2 = this.max_width/2\n\n    this.max_h2 = 0\n    if (this.model.properties.height.units == \"data\")\n      this.max_h2 = this.max_height/2\n  }\n\n  protected _map_data(): void {\n    if (this.model.properties.width.units == \"data\")\n      this.sw = this.sdist(this.renderer.xscale, this._x, this._width, 'center')\n    else\n      this.sw = this._width\n\n    if (this.model.properties.height.units == \"data\")\n      this.sh = this.sdist(this.renderer.yscale, this._y, this._height, 'center')\n    else\n      this.sh = this._height\n  }\n\n  protected _render(ctx: Context2d, indices: number[], {sx, sy, sw, sh}: EllipseData): void {\n     for (const i of indices) {\n       if (isNaN(sx[i] + sy[i] + sw[i] + sh[i] + this._angle[i]))\n         continue\n\n       ctx.beginPath()\n       ctx.ellipse(sx[i], sy[i], sw[i]/2.0, sh[i]/2.0, this._angle[i], 0, 2 * Math.PI)\n\n       if (this.visuals.fill.doit) {\n         this.visuals.fill.set_vectorize(ctx, i)\n         ctx.fill()\n       }\n\n       if (this.visuals.line.doit) {\n         this.visuals.line.set_vectorize(ctx, i)\n         ctx.stroke()\n       }\n     }\n   }\n\n  draw_legend_for_index(ctx: Context2d, {x0, y0, x1, y1}: IBBox, index: number): void {\n    const len = index + 1\n\n    const sx: number[] = new Array(len)\n    sx[index] = (x0 + x1)/2\n    const sy: number[] = new Array(len)\n    sy[index] = (y0 + y1)/2\n\n    const scale = this.sw[index] / this.sh[index]\n    const d = Math.min(Math.abs(x1 - x0), Math.abs(y1 - y0))*0.8\n\n    const sw: number[] = new Array(len)\n    const sh: number[] = new Array(len)\n    if (scale > 1) {\n      sw[index] = d\n      sh[index] = d/scale\n    } else {\n      sw[index] = d*scale\n      sh[index] = d\n    }\n\n    this._render(ctx, [index], {sx, sy, sw, sh} as any) // XXX\n  }\n\n  protected _bounds({minX, maxX, minY, maxY}: Rect): Rect {\n    return {\n      minX: minX - this.max_w2,\n      maxX: maxX + this.max_w2,\n      minY: minY - this.max_h2,\n      maxY: maxY + this.max_h2,\n    }\n  }\n}\n\nexport namespace Ellipse {\n  export interface Mixins extends LineMixinVector, FillMixinVector {}\n\n  export interface Attrs extends XYGlyph.Attrs, Mixins {\n    angle: AngleSpec\n    width: DistanceSpec\n    height: DistanceSpec\n  }\n\n  export interface Props extends XYGlyph.Props {\n    angle: p.AngleSpec\n    width: p.DistanceSpec\n    height: p.DistanceSpec\n  }\n\n  export interface Visuals extends XYGlyph.Visuals {\n    line: Line\n    fill: Fill\n  }\n}\n\nexport interface Ellipse extends Ellipse.Attrs {}\n\nexport class Ellipse extends XYGlyph {\n\n  properties: Ellipse.Props\n\n  constructor(attrs?: Partial<Ellipse.Attrs>) {\n    super(attrs)\n  }\n\n  static initClass(): void {\n    this.prototype.type = 'Ellipse'\n    this.prototype.default_view = EllipseView\n\n    this.mixins(['line', 'fill'])\n    this.define({\n      angle:  [ p.AngleSpec,   0.0 ],\n      width:  [ p.DistanceSpec     ],\n      height: [ p.DistanceSpec     ],\n    })\n  }\n}\nEllipse.initClass()\n"]}
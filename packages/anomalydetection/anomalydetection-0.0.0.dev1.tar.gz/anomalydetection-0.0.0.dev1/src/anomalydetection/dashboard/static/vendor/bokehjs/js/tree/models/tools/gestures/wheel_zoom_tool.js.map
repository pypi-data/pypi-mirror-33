{"version":3,"sources":["models/tools/gestures/wheel_zoom_tool.ts"],"names":[],"mappings":"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","file":"wheel_zoom_tool.js","sourcesContent":["import {GestureTool, GestureToolView} from \"./gesture_tool\"\nimport {scale_range} from \"core/util/zoom\"\nimport * as p from \"core/properties\"\nimport {GestureEvent, ScrollEvent} from \"core/ui_events\"\nimport {Dimensions} from \"core/enums\"\nimport {is_mobile} from \"core/ui_events\"\n\nexport class WheelZoomToolView extends GestureToolView {\n  model: WheelZoomTool\n\n  _pinch(ev: GestureEvent): void {\n    // TODO (bev) this can probably be done much better\n    const {sx, sy, scale} = ev\n\n    let delta: number\n    if (scale >= 1)\n      delta = (scale - 1) * 20.0\n    else\n      delta = -20.0/scale\n\n    this._scroll({type: \"mousewheel\", sx, sy, delta})\n  }\n\n  _scroll(ev: ScrollEvent): void {\n    const frame = this.plot_model.frame\n\n    const hr = frame.bbox.h_range\n    const vr = frame.bbox.v_range\n\n    const {sx, sy} = ev\n    const dims = this.model.dimensions\n\n    // restrict to axis configured in tool's dimensions property and if\n    // zoom origin is inside of frame range/domain\n    const h_axis = (dims == 'width' || dims == 'both') && hr.start < sx && sx < hr.end\n    const v_axis = (dims == 'height' || dims == 'both') && vr.start < sy && sy < vr.end\n\n    if ((!h_axis || !v_axis) && !this.model.zoom_on_axis) {\n      return\n    }\n\n    const factor = this.model.speed*ev.delta\n\n    const zoom_info = scale_range(frame, factor, h_axis, v_axis, {x: sx, y: sy})\n\n    this.plot_view.push_state('wheel_zoom', {range: zoom_info})\n    this.plot_view.update_range(zoom_info, false, true, this.model.maintain_focus)\n\n    if (this.model.document != null)\n      this.model.document.interactive_start(this.plot_model.plot)\n  }\n}\n\nexport namespace WheelZoomTool {\n  export interface Attrs extends GestureTool.Attrs {\n    dimensions: Dimensions\n    maintain_focus: boolean\n    zoom_on_axis: boolean\n    speed: number\n  }\n\n  export interface Props extends GestureTool.Props {}\n}\n\nexport interface WheelZoomTool extends WheelZoomTool.Attrs {}\n\nexport class WheelZoomTool extends GestureTool {\n\n  properties: WheelZoomTool.Props\n\n  constructor(attrs?: Partial<WheelZoomTool.Attrs>) {\n    super(attrs)\n  }\n\n  static initClass(): void {\n    this.prototype.type = \"WheelZoomTool\"\n\n    this.prototype.default_view = WheelZoomToolView\n\n    this.define({\n      dimensions:     [ p.Dimensions, \"both\" ],\n      maintain_focus: [ p.Boolean,    true   ],\n      zoom_on_axis:   [ p.Boolean,    true   ],\n      speed:          [ p.Number,     1/600  ],\n    })\n\n  }\n\n  tool_name = \"Wheel Zoom\"\n  icon = \"bk-tool-icon-wheel-zoom\"\n  event_type = is_mobile ? \"pinch\" as \"pinch\" : \"scroll\" as \"scroll\"\n  default_order = 10\n\n  get tooltip(): string {\n    return this._get_dim_tooltip(this.tool_name, this.dimensions)\n  }\n}\n\nWheelZoomTool.initClass()\n"]}
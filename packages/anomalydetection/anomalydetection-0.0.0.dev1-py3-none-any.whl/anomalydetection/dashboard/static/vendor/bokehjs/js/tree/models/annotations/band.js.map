{"version":3,"sources":["models/annotations/band.ts"],"names":[],"mappings":"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","file":"band.js","sourcesContent":["import {Annotation, AnnotationView} from \"./annotation\"\nimport {ColumnarDataSource} from \"../sources/columnar_data_source\"\nimport {ColumnDataSource} from \"../sources/column_data_source\"\nimport {DistanceSpec} from \"core/vectorization\"\nimport {LineMixinScalar, FillMixinScalar} from \"core/property_mixins\"\nimport {Line, Fill} from \"core/visuals\"\nimport {Arrayable} from \"core/types\"\nimport {Dimension} from \"core/enums\"\nimport * as p from \"core/properties\"\n\nexport class BandView extends AnnotationView {\n  model: Band\n  visuals: Band.Visuals\n\n  protected _lower: Arrayable<number>\n  protected _upper: Arrayable<number>\n  protected _base:  Arrayable<number>\n\n  protected max_lower: number\n  protected max_upper: number\n  protected max_base:  number\n\n  protected _lower_sx: Arrayable<number>\n  protected _lower_sy: Arrayable<number>\n  protected _upper_sx: Arrayable<number>\n  protected _upper_sy: Arrayable<number>\n\n  initialize(options: any): void {\n    super.initialize(options)\n    this.set_data(this.model.source)\n  }\n\n  connect_signals(): void {\n    super.connect_signals()\n    this.connect(this.model.source.streaming, () => this.set_data(this.model.source))\n    this.connect(this.model.source.patching, () => this.set_data(this.model.source))\n    this.connect(this.model.source.change, () => this.set_data(this.model.source))\n  }\n\n  set_data(source: ColumnarDataSource): void {\n    super.set_data(source)\n    this.visuals.warm_cache(source)\n    this.plot_view.request_render()\n  }\n\n  protected _map_data(): void {\n    const {frame} = this.plot_view\n    const dim = this.model.dimension\n\n    const xscale = frame.xscales[this.model.x_range_name]\n    const yscale = frame.yscales[this.model.y_range_name]\n\n    const limit_scale = dim == \"height\" ? yscale : xscale\n    const base_scale  = dim == \"height\" ? xscale : yscale\n\n    const limit_view = dim == \"height\" ? frame.yview : frame.xview\n    const base_view  = dim == \"height\" ? frame.xview : frame.yview\n\n    let _lower_sx\n    if (this.model.lower.units == \"data\")\n      _lower_sx = limit_scale.v_compute(this._lower)\n    else\n      _lower_sx = limit_view.v_compute(this._lower)\n\n    let _upper_sx\n    if (this.model.upper.units == \"data\")\n      _upper_sx = limit_scale.v_compute(this._upper)\n    else\n      _upper_sx = limit_view.v_compute(this._upper)\n\n    let _base_sx\n    if (this.model.base.units  == \"data\")\n      _base_sx  = base_scale.v_compute(this._base)\n    else\n      _base_sx  = base_view.v_compute(this._base)\n\n    const [i, j] = dim == 'height' ? [1, 0] : [0, 1]\n\n    const _lower = [_lower_sx, _base_sx]\n    const _upper = [_upper_sx, _base_sx]\n\n    this._lower_sx = _lower[i]\n    this._lower_sy = _lower[j]\n\n    this._upper_sx = _upper[i]\n    this._upper_sy = _upper[j]\n  }\n\n  render(): void {\n    if (!this.model.visible)\n      return\n\n    this._map_data()\n\n    const {ctx} = this.plot_view.canvas_view\n\n    // Draw the band body\n    ctx.beginPath()\n    ctx.moveTo(this._lower_sx[0], this._lower_sy[0])\n\n    for (let i = 0, end = this._lower_sx.length; i < end; i++) {\n      ctx.lineTo(this._lower_sx[i], this._lower_sy[i])\n    }\n    // iterate backwards so that the upper end is below the lower start\n    for (let start = this._upper_sx.length-1, i = start; i >= 0; i--) {\n      ctx.lineTo(this._upper_sx[i], this._upper_sy[i])\n    }\n\n    ctx.closePath()\n\n    if (this.visuals.fill.doit) {\n      this.visuals.fill.set_value(ctx)\n      ctx.fill()\n    }\n\n    // Draw the lower band edge\n    ctx.beginPath()\n    ctx.moveTo(this._lower_sx[0], this._lower_sy[0])\n    for (let i = 0, end = this._lower_sx.length; i < end; i++) {\n      ctx.lineTo(this._lower_sx[i], this._lower_sy[i])\n    }\n\n    if (this.visuals.line.doit) {\n      this.visuals.line.set_value(ctx)\n      ctx.stroke()\n    }\n\n    // Draw the upper band edge\n    ctx.beginPath()\n    ctx.moveTo(this._upper_sx[0], this._upper_sy[0])\n    for (let i = 0, end = this._upper_sx.length; i < end; i++) {\n      ctx.lineTo(this._upper_sx[i], this._upper_sy[i])\n    }\n\n    if (this.visuals.line.doit) {\n      this.visuals.line.set_value(ctx)\n      ctx.stroke()\n    }\n  }\n}\n\nexport namespace Band {\n  export interface Mixins extends LineMixinScalar, FillMixinScalar {}\n\n  export interface Attrs extends Annotation.Attrs, Mixins {\n    lower: DistanceSpec\n    upper: DistanceSpec\n    base: DistanceSpec\n    dimension: Dimension\n    source: ColumnarDataSource\n    x_range_name: string\n    y_range_name: string\n  }\n\n  export interface Props extends Annotation.Props {\n    lower: p.DistanceSpec\n    upper: p.DistanceSpec\n    base: p.DistanceSpec\n    dimension: p.Property<Dimension>\n    source: p.Property<ColumnarDataSource>\n    x_range_name: p.Property<string>\n    y_range_name: p.Property<string>\n  }\n\n  export type Visuals = Annotation.Visuals & {line: Line, fill: Fill}\n}\n\nexport interface Band extends Band.Attrs {}\n\nexport class Band extends Annotation {\n\n  properties: Band.Props\n\n  constructor(attrs?: Partial<Band.Attrs>) {\n    super(attrs)\n  }\n\n  static initClass(): void {\n    this.prototype.type = 'Band'\n    this.prototype.default_view = BandView\n\n    this.mixins(['line', 'fill'])\n\n    this.define({\n      lower:        [ p.DistanceSpec                               ],\n      upper:        [ p.DistanceSpec                               ],\n      base:         [ p.DistanceSpec                               ],\n      dimension:    [ p.Dimension,    'height'                     ],\n      source:       [ p.Instance,     () => new ColumnDataSource() ],\n      x_range_name: [ p.String,       'default'                    ],\n      y_range_name: [ p.String,       'default'                    ],\n    })\n\n    this.override({\n      fill_color: \"#fff9ba\",\n      fill_alpha: 0.4,\n      line_color: \"#cccccc\",\n      line_alpha: 0.3,\n    })\n  }\n}\nBand.initClass()\n"]}
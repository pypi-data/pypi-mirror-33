{"version":3,"sources":["embed.ts"],"names":[],"mappings":"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","file":"embed.js","sourcesContent":["import * as base from \"./base\"\nimport {logger, set_log_level} from \"./core/logging\"\nimport {Document, DocJson, DocumentChangedEvent, RootAddedEvent, RootRemovedEvent, TitleChangedEvent} from \"./document\"\nimport {div, link, style, replaceWith} from \"./core/dom\"\nimport {defer} from \"./core/util/callback\"\nimport {unescape} from \"./core/util/string\"\nimport {size, values} from \"./core/util/object\"\nimport {isString} from \"./core/util/types\"\nimport {Receiver} from \"./protocol/receiver\"\nimport {ClientSession} from \"./client/session\"\nimport {pull_session} from \"./client/connection\"\nimport {HasProps} from \"./core/has_props\"\nimport {DOMView} from \"./core/dom_view\"\n\nexport type DocsJson = {[key: string]: DocJson}\n\nexport interface RenderItem {\n  elementid: string\n  docid?: string\n  modelid?: string\n  sessionid?: string\n  use_for_title?: boolean\n  notebook_comms_target?: any\n}\n\nexport declare interface CommMessage {\n  buffers: DataView[],\n  content: {\n    data: string\n  }\n}\n\nexport declare interface Comm {\n  target_name: string\n  on_msg: (msg: CommMessage) => void\n  onMsg: (this: Document, receiver: Receiver, comm_msg: CommMessage) => void\n}\n\nexport declare interface Kernel {\n  comm_manager: {\n    register_target: (target: string, fn: (comm: Comm) => void) => void,\n  },\n  registerCommTarget: (target: string, fn: (comm: Comm) => void) => void,\n}\n\ndeclare interface Jupyter {\n  notebook: {\n    kernel: Kernel | undefined\n  }\n}\n\n\ndeclare var Jupyter: Jupyter | undefined\n\nexport const kernels: {[key: string]: Kernel} = {}\n\n// Matches Bokeh CSS class selector. Setting all Bokeh parent element class names\n// with this var prevents user configurations where css styling is unset.\nexport const BOKEH_ROOT = \"bk-root\"\n\nfunction _handle_notebook_comms(this: Document, receiver: Receiver, comm_msg: CommMessage): void {\n  if (comm_msg.buffers.length > 0)\n    receiver.consume(comm_msg.buffers[0].buffer)\n  else\n    receiver.consume(comm_msg.content.data)\n\n  const msg = receiver.message\n  if (msg != null)\n    this.apply_json_patch(msg.content, msg.buffers)\n}\n\nfunction _init_comms(target: string, doc: Document): void {\n  if (typeof Jupyter !== 'undefined' && Jupyter.notebook.kernel != null) {\n    logger.info(`Registering Jupyter comms for target ${target}`)\n    const comm_manager = Jupyter.notebook.kernel.comm_manager\n    try {\n      comm_manager.register_target(target, (comm: Comm) => {\n        logger.info(`Registering Jupyter comms for target ${target}`)\n        const r = new Receiver()\n        comm.on_msg(_handle_notebook_comms.bind(doc, r))\n      })\n    } catch (e) {\n      logger.warn(`Jupyter comms failed to register. push_notebook() will not function. (exception reported: ${e})`)\n    }\n  } else if (doc.roots()[0].id in kernels) {\n    logger.info(`Registering JupyterLab comms for target ${target}`)\n    const kernel = kernels[doc.roots()[0].id]\n    try {\n      kernel.registerCommTarget(target, (comm: Comm) => {\n        logger.info(`Registering JupyterLab comms for target ${target}`)\n        const r = new Receiver()\n        comm.onMsg = _handle_notebook_comms.bind(doc, r)\n      })\n    } catch (e) {\n      logger.warn(`Jupyter comms failed to register. push_notebook() will not function. (exception reported: ${e})`)\n    }\n  } else {\n    console.warn(`Jupyter notebooks comms not available. push_notebook() will not function. If running JupyterLab ensure the latest jupyterlab_bokeh extension is installed. In an exported notebook this warning is expected.`);\n  }\n}\n\nfunction _create_view(model: HasProps): DOMView {\n  const view = new model.default_view({model: model, parent: null}) as DOMView\n  base.index[model.id] = view\n  return view\n}\n\nfunction _get_element(item: RenderItem): HTMLElement {\n  const element_id = item.elementid\n  let elem = document.getElementById(element_id)\n\n  if (elem == null)\n    throw new Error(`Error rendering Bokeh model: could not find tag with id: ${element_id}`)\n  if (!document.body.contains(elem))\n    throw new Error(`Error rendering Bokeh model: element with id '${element_id}' must be under <body>`)\n\n  // if autoload script, replace script tag with div for embedding\n  if (elem.tagName == \"SCRIPT\") {\n    fill_render_item_from_script_tag(elem, item)\n    const container = div({class: BOKEH_ROOT})\n    replaceWith(elem, container)\n    const child = div()\n    container.appendChild(child)\n    elem = child\n  }\n\n  return elem\n}\n\n// Replace element with a view of model_id from document\nexport function add_model_standalone(model_id: string, element: HTMLElement, doc: Document): DOMView {\n  const model = doc.get_model_by_id(model_id)\n  if (model == null)\n    throw new Error(`Model ${model_id} was not in document ${doc}`)\n  const view = _create_view(model)\n  view.renderTo(element, true)\n  return view\n}\n\n// Fill element with the roots from doc\nexport function add_document_standalone(document: Document, element: HTMLElement, use_for_title: boolean = false): {[key: string]: DOMView} {\n  // this is a LOCAL index of views used only by this particular rendering\n  // call, so we can remove the views we create.\n  const views: {[key: string]: DOMView} = {}\n\n  function render_model(model: HasProps): void {\n    const view = _create_view(model)\n    view.renderTo(element)\n    views[model.id] = view\n  }\n\n  function unrender_model(model: HasProps): void {\n    if (model.id in views) {\n      const view = views[model.id]\n      element.removeChild(view.el)\n      delete views[model.id]\n      delete base.index[model.id]\n    }\n  }\n\n  for (const model of document.roots())\n    render_model(model)\n\n  if (use_for_title)\n    window.document.title = document.title()\n\n  document.on_change((event: DocumentChangedEvent): void => {\n    if (event instanceof RootAddedEvent)\n      render_model(event.model)\n    else if (event instanceof RootRemovedEvent)\n      unrender_model(event.model)\n    else if (use_for_title && event instanceof TitleChangedEvent)\n      window.document.title = event.title\n  })\n\n  return views\n}\n\n// map { websocket url to map { session id to promise of ClientSession } }\nconst _sessions: {[key: string]: {[key: string]: Promise<ClientSession>}} = {}\n\nfunction _get_session(websocket_url: string, session_id: string, args_string: string): Promise<ClientSession> {\n  if (!(websocket_url in _sessions))\n    _sessions[websocket_url] = {}\n\n  const subsessions = _sessions[websocket_url]\n  if (!(session_id in subsessions))\n    subsessions[session_id] = pull_session(websocket_url, session_id, args_string)\n\n  return subsessions[session_id]\n}\n\n// Fill element with the roots from session_id\nexport function add_document_from_session(element: HTMLElement,\n    websocket_url: string, session_id: string, use_for_title: boolean): Promise<{[key: string]: DOMView}> {\n  const args_string = window.location.search.substr(1)\n  const promise = _get_session(websocket_url, session_id, args_string)\n  return promise.then(\n    (session: ClientSession) => {\n      return add_document_standalone(session.document, element, use_for_title)\n    },\n    (error) => {\n      logger.error(`Failed to load Bokeh session ${session_id}: ${error}`)\n      throw error\n    },\n  )\n}\n\n// Replace element with a view of model_id from the given session\nexport function add_model_from_session(element: HTMLElement,\n    websocket_url: string, model_id: string, session_id: string): Promise<DOMView> {\n  const args_string = window.location.search.substr(1)\n  const promise = _get_session(websocket_url, session_id, args_string)\n  return promise.then(\n    (session: ClientSession) => {\n      const model = session.document.get_model_by_id(model_id)\n      if (model == null)\n        throw new Error(`Did not find model ${model_id} in session`)\n      const view = _create_view(model)\n      view.renderTo(element, true)\n      return view\n    },\n    (error: Error) => {\n      logger.error(`Failed to load Bokeh session ${session_id}: ${error}`)\n      throw error\n    },\n  )\n}\n\nexport function inject_css(url: string): void {\n  const element = link({href: url, rel: \"stylesheet\", type: \"text/css\"})\n  document.body.appendChild(element)\n}\n\nexport function inject_raw_css(css: string): void {\n  const element = style({}, css)\n  document.body.appendChild(element)\n}\n\n// pull missing render item fields from data- attributes\nfunction fill_render_item_from_script_tag(script: HTMLElement, item: RenderItem): void {\n  const {bokehLogLevel, bokehDocId, bokehModelId, bokehSessionId} = script.dataset\n\n  // length checks are because we put all the attributes on the tag\n  // but sometimes set them to empty string\n  if (bokehLogLevel != null && bokehLogLevel.length > 0)\n    set_log_level(bokehLogLevel)\n  if (bokehDocId != null && bokehDocId.length > 0)\n    item.docid = bokehDocId\n  if (bokehModelId != null && bokehModelId.length > 0)\n    item.modelid = bokehModelId\n  if (bokehSessionId != null && bokehSessionId.length > 0)\n    item.sessionid = bokehSessionId\n\n  logger.info(`Will inject Bokeh script tag with params ${JSON.stringify(item)}`)\n}\n\nexport function embed_items_notebook(docs_json: DocsJson, render_items: RenderItem[]): void {\n  if (size(docs_json) != 1)\n    throw new Error(\"embed_items_notebook expects exactly one document in docs_json\")\n\n  const doc = Document.from_json(values(docs_json)[0])\n\n  for (const item of render_items) {\n    if (item.notebook_comms_target != null)\n      _init_comms(item.notebook_comms_target, doc)\n\n    const elem = _get_element(item)\n\n    if (item.modelid != null)\n      add_model_standalone(item.modelid, elem, doc)\n    else\n      add_document_standalone(doc, elem, false)\n  }\n}\n\nfunction _get_ws_url(app_path: string | undefined, absolute_url: string | undefined): string {\n  let protocol = 'ws:'\n  if (window.location.protocol == 'https:')\n    protocol = 'wss:'\n\n  let loc: HTMLAnchorElement | Location\n  if (absolute_url != null) {\n    loc = document.createElement('a')\n    loc.href = absolute_url\n  } else\n    loc = window.location\n\n  if (app_path != null) {\n    if (app_path == \"/\")\n      app_path = \"\"\n  } else\n    app_path = loc.pathname.replace(/\\/+$/, '')\n\n  return protocol + '//' + loc.host + app_path + '/ws'\n}\n\n// TODO (bev) this is currently clunky. Standalone embeds only provide\n// the first two args, whereas server provide the app_app, and *may* prove and\n// absolute_url as well if non-relative links are needed for resources. This function\n// should probably be split in to two pieces to reflect the different usage patterns\nexport function embed_items(docs_json: string | DocsJson, render_items: RenderItem[], app_path?: string, absolute_url?: string): void {\n  defer(() => _embed_items(docs_json, render_items, app_path, absolute_url))\n}\n\nfunction _embed_items(docs_json: string | DocsJson, render_items: RenderItem[], app_path?: string, absolute_url?: string): void {\n  if (isString(docs_json))\n    docs_json = JSON.parse(unescape(docs_json)) as DocsJson\n\n  const docs: {[key: string]: Document} = {}\n  for (const docid in docs_json) {\n    const doc_json = docs_json[docid]\n    docs[docid] = Document.from_json(doc_json)\n  }\n\n  for (const item of render_items) {\n    const elem = _get_element(item)\n    const use_for_title = item.use_for_title != null && item.use_for_title\n\n    // handle server session cases\n    if (item.sessionid != null) {\n      const websocket_url = _get_ws_url(app_path, absolute_url)\n      logger.debug(`embed: computed ws url: ${websocket_url}`)\n      let promise: Promise<any>\n      if (item.modelid != null)\n        promise = add_model_from_session(elem, websocket_url, item.modelid, item.sessionid)\n      else\n        promise = add_document_from_session(elem, websocket_url, item.sessionid, use_for_title)\n\n      promise.then(\n        () => {\n          console.log(\"Bokeh items were rendered successfully\")\n        },\n        (error: Error) => {\n          console.log(\"Error rendering Bokeh items \", error)\n        },\n      )\n\n    // handle standalone document cases\n    } else if (item.docid != null) {\n      if (item.modelid != null)\n        add_model_standalone(item.modelid, elem, docs[item.docid])\n      else\n        add_document_standalone(docs[item.docid], elem, use_for_title)\n    } else\n       throw new Error(`Error rendering Bokeh items to element ${item.elementid}: no document ID or session ID specified`)\n  }\n}\n"]}
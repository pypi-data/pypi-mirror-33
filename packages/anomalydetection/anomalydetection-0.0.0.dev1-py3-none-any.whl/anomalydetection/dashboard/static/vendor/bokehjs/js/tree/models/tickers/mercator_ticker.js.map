{"version":3,"sources":["models/tickers/mercator_ticker.ts"],"names":[],"mappings":";;;AACA,+CAA0C;AAE1C,mCAAoC;AACpC,qDAA8E;AAY9E;IAAoC,0CAAW;IAI7C,wBAAY,KAAqC;eAC/C,kBAAM,KAAK,CAAC;IACd,CAAC;IAEM,wBAAS,GAAhB;QACE,IAAI,CAAC,SAAS,CAAC,IAAI,GAAG,gBAAgB,CAAA;QAEtC,IAAI,CAAC,MAAM,CAAC;YACV,SAAS,EAAE,CAAE,CAAC,CAAC,MAAM,CAAE;SACxB,CAAC,CAAA;IACJ,CAAC;IAED,8CAAqB,GAArB,UAAsB,QAAgB,EAAE,SAAiB,EAAE,SAAc,EAAE,eAAuB;QAChG,IAAI,IAAI,CAAC,SAAS,IAAI,IAAI,EAAE;YAC1B,MAAM,IAAI,KAAK,CAAC,yCAAyC,CAAC,CAAA;SAC3D;QAED,qEAA0E,EAAzE,gBAAQ,EAAE,iBAAS,CAAsD;QAC1E,IAAI,QAAgB,EAAE,SAAiB,EAAE,cAAmB,CAAA;QAE5D,IAAI,IAAI,CAAC,SAAS,KAAK,KAAK,EAAE;YAC5B,gEAA4E,EAA3E,gBAAQ,EAAG,sBAAc,CAAmD;YAC7E,iEAA4E,EAA3E,iBAAS,EAAE,sBAAc,CAAkD;SAC7E;aAAM;YACL,gEAA4E,EAA3E,sBAAc,EAAE,gBAAQ,CAAoD;YAC7E,iEAA4E,EAA3E,sBAAc,EAAE,iBAAS,CAAkD;SAC7E;QAED,IAAM,UAAU,GAAG,iBAAM,qBAAqB,YAAC,QAAQ,EAAE,SAAS,EAAE,SAAS,EAAE,eAAe,CAAC,CAAA;QAE/F,IAAM,KAAK,GAAa,EAAE,CAAA;QAC1B,IAAM,KAAK,GAAa,EAAE,CAAA;QAE1B,IAAI,IAAI,CAAC,SAAS,KAAK,KAAK,EAAE;YAC5B,KAAmB,UAAgB,EAAhB,KAAA,UAAU,CAAC,KAAK,EAAhB,cAAgB,EAAhB,IAAgB;gBAA9B,IAAM,IAAI,SAAA;gBACb,IAAI,uBAAS,CAAC,IAAI,EAAE,KAAK,CAAC,EAAE;oBACnB,IAAA,qEAAG,CAAkD;oBAC5D,KAAK,CAAC,IAAI,CAAC,GAAG,CAAC,CAAA;iBAChB;aACF;YACD,KAAmB,UAAgB,EAAhB,KAAA,UAAU,CAAC,KAAK,EAAhB,cAAgB,EAAhB,IAAgB;gBAA9B,IAAM,IAAI,SAAA;gBACb,IAAI,uBAAS,CAAC,IAAI,EAAE,KAAK,CAAC,EAAE;oBACnB,IAAA,qEAAG,CAAkD;oBAC5D,KAAK,CAAC,IAAI,CAAC,GAAG,CAAC,CAAA;iBAChB;aACF;SACF;aAAM;YACL,KAAmB,UAAgB,EAAhB,KAAA,UAAU,CAAC,KAAK,EAAhB,cAAgB,EAAhB,IAAgB;gBAA9B,IAAM,IAAI,SAAA;gBACb,IAAI,uBAAS,CAAC,IAAI,EAAE,KAAK,CAAC,EAAE;oBACpB,IAAA,iEAAwD,EAArD,WAAG,CAAkD;oBAC9D,KAAK,CAAC,IAAI,CAAC,GAAG,CAAC,CAAA;iBAChB;aACF;YACD,KAAmB,UAAgB,EAAhB,KAAA,UAAU,CAAC,KAAK,EAAhB,cAAgB,EAAhB,IAAgB;gBAA9B,IAAM,IAAI,SAAA;gBACb,IAAI,uBAAS,CAAC,IAAI,EAAE,KAAK,CAAC,EAAE;oBACpB,IAAA,iEAAwD,EAArD,WAAG,CAAkD;oBAC9D,KAAK,CAAC,IAAI,CAAC,GAAG,CAAC,CAAA;iBAChB;aACF;SACF;QAED,OAAO;YACL,KAAK,EAAE,KAAK;YACZ,KAAK,EAAE,KAAK;SACb,CAAA;;IACH,CAAC;IACH,qBAAC;AAAD,CAtEA,AAsEC,CAtEmC,0BAAW,GAsE9C;AAtEY,wCAAc;AAwE3B,cAAc,CAAC,SAAS,EAAE,CAAA","file":"mercator_ticker.js","sourcesContent":["import {TickSpec} from \"./ticker\"\nimport {BasicTicker} from \"./basic_ticker\"\nimport {LatLon} from \"core/enums\"\nimport * as p from \"core/properties\"\nimport {wgs84_mercator, clip_mercator, in_bounds} from \"core/util/projections\"\n\nexport namespace MercatorTicker {\n  export interface Attrs extends BasicTicker.Attrs {\n    dimension: LatLon | null | undefined\n  }\n\n  export interface Props extends BasicTicker.Props {}\n}\n\nexport interface MercatorTicker extends MercatorTicker.Attrs {}\n\nexport class MercatorTicker extends BasicTicker {\n\n  properties: MercatorTicker.Props\n\n  constructor(attrs?: Partial<MercatorTicker.Attrs>) {\n    super(attrs)\n  }\n\n  static initClass(): void {\n    this.prototype.type = \"MercatorTicker\"\n\n    this.define({\n      dimension: [ p.LatLon ],\n    })\n  }\n\n  get_ticks_no_defaults(data_low: number, data_high: number, cross_loc: any, desired_n_ticks: number): TickSpec<number> {\n    if (this.dimension == null) {\n      throw new Error(\"MercatorTicker.dimension not configured\")\n    }\n\n    [data_low, data_high] = clip_mercator(data_low, data_high, this.dimension)\n    let proj_low: number, proj_high: number, proj_cross_loc: any\n\n    if (this.dimension === \"lon\") {\n      [proj_low,  proj_cross_loc] = wgs84_mercator.inverse([data_low,  cross_loc]);\n      [proj_high, proj_cross_loc] = wgs84_mercator.inverse([data_high, cross_loc])\n    } else {\n      [proj_cross_loc, proj_low ] = wgs84_mercator.inverse([cross_loc, data_low ]);\n      [proj_cross_loc, proj_high] = wgs84_mercator.inverse([cross_loc, data_high])\n    }\n\n    const proj_ticks = super.get_ticks_no_defaults(proj_low, proj_high, cross_loc, desired_n_ticks)\n\n    const major: number[] = []\n    const minor: number[] = []\n\n    if (this.dimension === \"lon\") {\n      for (const tick of proj_ticks.major) {\n        if (in_bounds(tick, 'lon')) {\n          const [lon] = wgs84_mercator.forward([tick, proj_cross_loc])\n          major.push(lon)\n        }\n      }\n      for (const tick of proj_ticks.minor) {\n        if (in_bounds(tick, 'lon')) {\n          const [lon] = wgs84_mercator.forward([tick, proj_cross_loc])\n          minor.push(lon)\n        }\n      }\n    } else {\n      for (const tick of proj_ticks.major) {\n        if (in_bounds(tick, 'lat')) {\n          const [, lat] = wgs84_mercator.forward([proj_cross_loc, tick])\n          major.push(lat)\n        }\n      }\n      for (const tick of proj_ticks.minor) {\n        if (in_bounds(tick, 'lat')) {\n          const [, lat] = wgs84_mercator.forward([proj_cross_loc, tick])\n          minor.push(lat)\n        }\n      }\n    }\n\n    return {\n      major: major,\n      minor: minor,\n    }\n  }\n}\n\nMercatorTicker.initClass()\n"]}
{"version":3,"sources":["models/annotations/tooltip.ts"],"names":[],"mappings":"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","file":"tooltip.js","sourcesContent":["import {Annotation, AnnotationView} from \"./annotation\"\nimport {TooltipAttachment} from \"core/enums\"\nimport {div, show, hide, empty} from \"core/dom\"\nimport * as p from \"core/properties\"\n\nexport function compute_side(attachment: TooltipAttachment, sx: number, sy: number, hcenter: number, vcenter: number) {\n  let side\n  switch (attachment) {\n    case \"horizontal\":\n      side = sx < hcenter ? 'right' : 'left'\n      break\n    case \"vertical\":\n      side = sy < vcenter ? 'below' : 'above'\n      break\n    default:\n      side = attachment\n  }\n  return side\n}\n\nexport class TooltipView extends AnnotationView {\n  model: Tooltip\n\n  initialize(options: any): void {\n    super.initialize(options)\n    // TODO (bev) really probably need multiple divs\n    this.plot_view.canvas_overlays.appendChild(this.el)\n    hide(this.el)\n  }\n\n  connect_signals(): void {\n    super.connect_signals()\n    this.connect(this.model.properties.data.change, () => this._draw_tips())\n  }\n\n  css_classes(): string[] {\n    return super.css_classes().concat(\"bk-tooltip\")\n  }\n\n  render(): void {\n    if (!this.model.visible)\n      return\n\n    this._draw_tips()\n  }\n\n  protected _draw_tips(): void {\n    const {data} = this.model\n    empty(this.el)\n    hide(this.el)\n\n    if (this.model.custom)\n      this.el.classList.add(\"bk-tooltip-custom\")\n    else\n      this.el.classList.remove(\"bk-tooltip-custom\")\n\n    if (data.length == 0)\n      return\n\n    const {frame} = this.plot_view\n\n    for (const [sx, sy, content] of data) {\n      if (this.model.inner_only && !frame.bbox.contains(sx, sy))\n          continue\n\n      const tip = div({}, content)\n      this.el.appendChild(tip)\n    }\n\n    const [sx, sy] = data[data.length - 1] // XXX: this previously depended on {sx, sy} leaking from the for-loop\n\n    const side = compute_side(this.model.attachment, sx, sy, frame._hcenter.value, frame._vcenter.value)\n\n    this.el.classList.remove(\"bk-right\")\n    this.el.classList.remove(\"bk-left\")\n    this.el.classList.remove(\"bk-above\")\n    this.el.classList.remove(\"bk-below\")\n\n    const arrow_size = 10  // XXX: keep in sync with less\n\n    show(this.el)  // XXX: {offset,client}Width() gives 0 when display=\"none\"\n\n    // slightly confusing: side \"left\" (for example) is relative to point that\n    // is being annotated but CS class \"bk-left\" is relative to the tooltip itself\n    let left: number, top: number\n    switch (side) {\n      case \"right\":\n        this.el.classList.add(\"bk-left\")\n        left = sx + (this.el.offsetWidth - this.el.clientWidth) + arrow_size\n        top = sy - this.el.offsetHeight/2\n        break\n      case \"left\":\n        this.el.classList.add(\"bk-right\")\n        left = sx - this.el.offsetWidth - arrow_size\n        top = sy - this.el.offsetHeight/2\n        break\n      case \"below\":\n        this.el.classList.add(\"bk-above\")\n        top = sy + (this.el.offsetHeight - this.el.clientHeight) + arrow_size\n        left = Math.round(sx - this.el.offsetWidth/2)\n        break\n      case \"above\":\n        this.el.classList.add(\"bk-below\")\n        top = sy - this.el.offsetHeight - arrow_size\n        left = Math.round(sx - this.el.offsetWidth/2)\n        break\n      default:\n        throw new Error(\"unreachable code\")\n    }\n\n    if (this.model.show_arrow)\n      this.el.classList.add(\"bk-tooltip-arrow\")\n\n    // TODO (bev) this is not currently bulletproof. If there are\n    // two hits, not colocated and one is off the screen, that can\n    // be problematic\n    if (this.el.childNodes.length > 0) {\n      this.el.style.top = `${top}px`\n      this.el.style.left = `${left}px`\n    } else\n      hide(this.el)\n  }\n}\n\nexport namespace Tooltip {\n  export interface Attrs extends Annotation.Attrs {\n    attachment: TooltipAttachment\n    inner_only: boolean\n    show_arrow: boolean\n    data: [number, number, HTMLElement][]\n    custom: boolean\n  }\n\n  export interface Props extends Annotation.Props {\n    attachment: p.Property<TooltipAttachment>\n    inner_only: p.Property<boolean>\n    show_arrow: p.Property<boolean>\n    data: p.Property<[number, number, HTMLElement][]>\n    custom: p.Property<boolean>\n  }\n}\n\nexport interface Tooltip extends Tooltip.Attrs {}\n\nexport class Tooltip extends Annotation {\n\n  properties: Tooltip.Props\n\n  constructor(attrs?: Partial<Tooltip.Attrs>) {\n    super(attrs)\n  }\n\n  static initClass(): void {\n    this.prototype.type = 'Tooltip'\n    this.prototype.default_view = TooltipView\n\n    this.define({\n      attachment: [ p.String, 'horizontal' ], // TODO enum: \"horizontal\" | \"vertical\" | \"left\" | \"right\" | \"above\" | \"below\"\n      inner_only: [ p.Bool,   true         ],\n      show_arrow: [ p.Bool,   true         ],\n    })\n\n    this.override({\n      level: 'overlay',\n    })\n\n    this.internal({\n      data:   [ p.Any, [] ],\n      custom: [ p.Any     ],\n    })\n  }\n\n  clear(): void {\n    this.data = []\n  }\n\n  add(sx: number, sy: number, content: HTMLElement): void {\n    this.data = this.data.concat([[sx, sy, content]])\n  }\n}\nTooltip.initClass()\n"]}
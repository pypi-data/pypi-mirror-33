{"version":3,"sources":["model.ts"],"names":[],"mappings":"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","file":"model.js","sourcesContent":["import {HasProps} from \"./core/has_props\"\nimport {Class} from \"./core/class\"\nimport {BokehEvent} from \"./core/bokeh_events\"\nimport * as p from \"./core/properties\"\nimport {isString} from \"./core/util/types\"\nimport {isEmpty} from \"./core/util/object\"\nimport {logger} from \"./core/logging\"\nimport {CustomJS} from \"./models/callbacks/customjs\"\n\nexport namespace Model {\n  export interface Attrs extends HasProps.Attrs {\n    tags: string[]\n    name: string | null\n    js_property_callbacks: {[key: string]: CustomJS[]}\n    js_event_callbacks: {[key: string]: CustomJS[]}\n    subscribed_events: string[]\n  }\n\n  export interface Props extends HasProps.Props {\n    tags: p.Array\n    name: p.String\n    js_property_callbacks: p.Any\n    js_event_callbacks: p.Any\n    subscribed_events: p.Array\n  }\n}\n\nexport interface Model extends Model.Attrs {}\n\nexport class Model extends HasProps {\n\n  properties: Model.Props\n\n  constructor(attrs?: Partial<Model.Attrs>) {\n    super(attrs)\n  }\n\n  static initClass(): void {\n    this.prototype.type = \"Model\"\n\n    this.define({\n      tags:                  [ p.Array, [] ],\n      name:                  [ p.String    ],\n      js_property_callbacks: [ p.Any,   {} ],\n      js_event_callbacks:    [ p.Any,   {} ],\n      subscribed_events:     [ p.Array, [] ],\n    })\n  }\n\n  connect_signals(): void {\n    super.connect_signals()\n\n    for (const base_evt in this.js_property_callbacks) {\n      const callbacks = this.js_property_callbacks[base_evt]\n      const [evt, attr=null] = base_evt.split(':')\n      for (const cb of callbacks) {\n        const signal = attr != null ? (this.properties as any)[attr][evt] : (this as any)[evt]\n        this.connect(signal, () => cb.execute(this, {}))\n      }\n    }\n\n    this.connect(this.properties.js_event_callbacks.change, () => this._update_event_callbacks)\n    this.connect(this.properties.subscribed_events.change, () => this._update_event_callbacks)\n  }\n\n  /*protected*/ _process_event(event: BokehEvent): void {\n    if (event.is_applicable_to(this)) {\n      event = event._customize_event(this)\n\n      for (const callback of this.js_event_callbacks[event.event_name] || [])\n        callback.execute(event, {})\n\n      if (this.document != null) {\n        if (this.subscribed_events.some((m) => m == event.event_name))\n          this.document.event_manager.send_event(event)\n      }\n    }\n  }\n\n  trigger_event(event: BokehEvent): void {\n    if (this.document != null)\n      this.document.event_manager.trigger(event.set_model_id(this.id))\n  }\n\n  protected _update_event_callbacks(): void {\n    if (this.document == null) {\n      // File an issue: SidePanel in particular seems to have this issue\n      logger.warn('WARNING: Document not defined for updating event callbacks')\n      return\n    }\n    this.document.event_manager.subscribed_models.push(this.id)\n  }\n\n  protected _doc_attached(): void {\n    if (!isEmpty(this.js_event_callbacks) || !isEmpty(this.subscribed_events))\n      this._update_event_callbacks()\n  }\n\n  select<T extends HasProps>(selector: Class<T> | string): T[] {\n    if (isString(selector))\n      return this.references().filter((ref): ref is T => ref instanceof Model && ref.name === selector)\n    else if (selector.prototype instanceof HasProps)\n      return this.references().filter((ref): ref is T => ref instanceof selector)\n    else\n      throw new Error(\"invalid selector\")\n  }\n\n  select_one<T extends HasProps>(selector: Class<T> | string): T | null {\n    const result = this.select(selector)\n    switch (result.length) {\n      case 0:\n        return null\n      case 1:\n        return result[0]\n      default:\n        throw new Error(\"found more than one object matching given selector\")\n    }\n  }\n}\nModel.initClass()\n"]}
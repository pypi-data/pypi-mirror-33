<div metal:use-macro="layout.base" i18n:domain="onegov.gazette">
    <tal:block metal:fill-slot="content">

        <h2 i18n:translate>Search</h2>

        <div class="search-filters">
            <form action="" method="GET">

                <div class="row">
                    <div class="small-12 columns">
                        <div class="search-filter">
                            <label for="term" i18n:translate>Term</label>
                            <input type="text" name="term" value="${term}"/>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="small-12 large-6 columns">
                        <div class="search-filter">
                            <label for="organizations" i18n:translate>Organization</label>
                            <select name="organizations" multiple class="chosen-select">
                                <tal:block tal:repeat="(group, options) organizations">
                                    <optgroup tal:condition="group" label="${group}">
                                        <tal:block tal:repeat="(value, title) options">
                                            <option value="${value}" tal:attributes="selected (value in selected_organizations)">${title}</option>
                                        </tal:block>
                                    </optgroup>
                                    <tal:block tal:condition="not group" tal:repeat="(value, title) options">
                                        <option value="${value}" tal:attributes="selected (value in selected_organizations)">${title}</option>
                                    </tal:block>
                                </tal:block>
                            </select>
                        </div>
                    </div>
                    <div class="small-12 large-6 columns">
                        <div class="search-filter">
                            <label for="categories" i18n:translate>Category</label>
                            <select name="categories" multiple class="chosen-select">
                                <tal:block tal:repeat="(value, title) categories">
                                    <option value="${value}" tal:attributes="selected (value in selected_categories)">${title}</option>
                                </tal:block>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="small-12 large-6 columns">
                        <div class="search-filter">
                            <label for="term" i18n:translate>From</label>
                            <input type="date" name="from_date" value="${from_date}" placeholder="">
                        </div>
                    </div>
                    <div class="small-12 large-6 columns">
                        <div class="search-filter">
                            <label for="to" i18n:translate>To</label>
                            <input type="date" name="to_date" value="${to_date}" placeholder="">
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="small-12 large-6 columns">
                        <div class="search-filter">
                            <label for="import_source" i18n:translate>SOGC</label>
                            <select name="import_source" class="chosen-select">
                                <option value="any" i18n:translate>All publications</option>
                                <option value="unblank" tal:attributes="selected import_source=='unblank'" i18n:translate>Only publications from the SOGC</option>
                                <option value="blank" tal:attributes="selected import_source=='blank'" i18n:translate>Exclude publications from the SOGC</option>
                            </select>
                        </div>
                    </div>
                </div>

                <dl class="sub-nav">
                    <dd>
                        <button type="submit" class="button" aria-label="Submit" i18n:attributes="aria-label">
                            <i class="fa fa-search"></i> <tal:block i18n:translate>Search</tal:block>
                        </button>
                    </dd>
                    <dd tal:condition="clear">
                        <a href="${clear}"><i class="fa fa-close" aria-hidden="true"></i> <tal:block i18n:translate>Reset</tal:block></a>
                    </dd>
                </dl>

            </form>
        </div>

        <h3 i18n:translate>Search Results</h3>
        <dl class="sub-nav" tal:condition="notices">
            <dt><tal:block i18n:translate>Ordering</tal:block>:</dt>
            <dd tal:repeat="key orderings">
                <tal:block metal:use-macro="layout.macros['order_link']"></tal:block>
            </dd>
        </dl>
        <dl class="sub-nav">
            <dd>
                <a href="${subscribe}" class="dt button"><i class="fa fa-envelope-o" aria-hidden="true"></i> <tal:block i18n:translate>Subscribe to the current search query</tal:block></a>
            </dd>
            <dd tal:condition="notices">
                <a href="${pdf}" class="button"><i class="fa fa-file-pdf-o" aria-hidden="true"></i> <tal:block i18n:translate>Download the search results as PDF</tal:block></a>
            </dd>
        </dl>
        <div tal:condition="not:notices">
            <hr>
            <p i18n:translate>No official notices.</p>
        </div>
        <tal:block tal:condition="notices">
            <div tal:repeat="notice notices" class="notice-published">
                <hr>
                <div class="preview">
                    <h4>${notice.title}</h4>
                    <div>
                        <tal:block metal:use-macro="layout.macros['notice_text']" />
                    </div>
                    <div tal:condition="notice.files">
                        <p tal:repeat="file notice.files"><a href="${request.link(file)}" i18n:translate>Attachment</a></p>
                    </div>
                </div>
                <div>
                    <span class="blank-label">${notice.organization}</span>
                    <span class="blank-label">${notice.category}</span>
                    <span class="blank-label" tal:repeat="issue notice.issue_objects">${layout.format_issue(issue, notice=notice)}</span>
                </div>
            </div>
            <div class="pagination-centered">
                <div metal:use-macro="layout.macros['pagination']" tal:define="collection layout.model; current_page layout.model;" />
            </div>
        </tal:block>

    </tal:block>
</div>

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Очередь заданий &mdash; Grab 0.6.30 documentation</title>
    
    <link rel="stylesheet" href="../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.6.30',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="Grab 0.6.30 documentation" href="../index.html" />
    <link rel="next" title="Обработка ошибок" href="error_handling.html" />
    <link rel="prev" title="Задания" href="task.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="error_handling.html" title="Обработка ошибок"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="task.html" title="Задания"
             accesskey="P">previous</a> |</li>
        <li><a href="../index.html">Grab 0.6.30 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="spider-task-queue">
<span id="id1"></span><h1>Очередь заданий<a class="headerlink" href="#spider-task-queue" title="Permalink to this headline">¶</a></h1>
<div class="section" id="id2">
<h2>Приоритеты заданий<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h2>
<p>Все задания помещаются в очередь, откуда они ивзлекаются по мере освобождения сетевых ресурсов и выполняются. У каждого задания есть приоритет, обозначаемый положительным целым числом. Чем меньше это число, тем выше приоритет. Если приоритет не указан явно при создании задания, он назначается автоматически. Есть два алгоритма автоматического задания приоритетов:</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">random:</th><td class="field-body">случайные приоритеты</td>
</tr>
<tr class="field-even field"><th class="field-name">const:</th><td class="field-body">один и тот же приоритет для всех заданий.</td>
</tr>
</tbody>
</table>
<p>По умолчанию используются случайные приоритеты. Способ выбора приоритетов задаётся аргументом <cite>priority_mode</cite> при создании Spider-объекта:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">bot</span> <span class="o">=</span> <span class="n">SomeSpider</span><span class="p">(</span><span class="n">priority_mode</span><span class="o">=</span><span class="s">&#39;const&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="id3">
<h2>Бэкенды хранилищ<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h2>
<p>Очередь заданий в Grab выделена в отдельный слой, это позволяет писать реализации очереди для различных систем хранения данных. Из коробки доступны две реализации: хранение заданий в памяти и хранение заданий в mongodb. По умолчанию задания хранятся в памяти. Если объёма вашей памяти не хватает, чтобы хранить все задания, то рекомендуется использовать очередь в mongodb:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">bot</span> <span class="o">=</span> <span class="n">SomeSpider</span><span class="p">()</span>
<span class="n">bot</span><span class="o">.</span><span class="n">setup_queue</span><span class="p">()</span> <span class="c"># очередь в памяти</span>
<span class="n">bot</span><span class="o">.</span><span class="n">setup_queue</span><span class="p">(</span><span class="n">backend</span><span class="o">=</span><span class="s">&#39;mongo&#39;</span><span class="p">,</span> <span class="n">database</span><span class="o">=</span><span class="s">&#39;database-name&#39;</span><span class="p">)</span> <span class="c"># очередь в монго</span>
</pre></div>
</div>
</div>
<div class="section" id="id4">
<h2>Генератор заданий<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h2>
<p>Также для сокращения потребления памяти очередью заданий вы можете воспользоваться методом <a class="reference internal" href="task_building.html#spider-task-generator"><em>task_generator</em></a>, задания из которого будут браться только по мере опустошения очереди заданий.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Очередь заданий</a><ul>
<li><a class="reference internal" href="#id2">Приоритеты заданий</a></li>
<li><a class="reference internal" href="#id3">Бэкенды хранилищ</a></li>
<li><a class="reference internal" href="#id4">Генератор заданий</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="task.html"
                        title="previous chapter">Задания</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="error_handling.html"
                        title="next chapter">Обработка ошибок</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../_sources/spider/task_queue.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="error_handling.html" title="Обработка ошибок"
             >next</a> |</li>
        <li class="right" >
          <a href="task.html" title="Задания"
             >previous</a> |</li>
        <li><a href="../index.html">Grab 0.6.30 documentation</a> &raquo;</li> 
      </ul>
    </div>

    <div class="footer">
        &copy; Copyright 2011, Grigoriy Petukhov.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.3.
    </div>

<div style="margin: 0.5em; text-align: right">
<!-- Yandex.Metrika informer --><a href="http://metrika.yandex.ru/stat/?id=13841917&amp;from=informer" target="_blank" rel="nofollow"><img src="//bs.yandex.ru/informer/13841917/1_1_FFFFFFFF_EFEFEFFF_0_pageviews" style="width:80px; height:15px; border:0;" alt="Яндекс.Метрика" title="Яндекс.Метрика: данные за сегодня (просмотры)" /></a><!-- /Yandex.Metrika informer --><!-- Yandex.Metrika counter --><script type="text/javascript">(function (d, w, c) { (w[c] = w[c] || []).push(function() { try { w.yaCounter13841917 = new Ya.Metrika({id:13841917, enableAll: true, webvisor:true}); } catch(e) {} }); var n = d.getElementsByTagName("script")[0], s = d.createElement("script"), f = function () { n.parentNode.insertBefore(s, n); }; s.type = "text/javascript"; s.async = true; s.src = (d.location.protocol == "https:" ? "https:" : "http:") + "//mc.yandex.ru/metrika/watch.js"; if (w.opera == "[object Opera]") { d.addEventListener("DOMContentLoaded", f); } else { f(); } })(document, window, "yandex_metrika_callbacks");</script><noscript><div><img src="//mc.yandex.ru/watch/13841917" style="position:absolute; left:-9999px;" alt="" /></div></noscript><!-- /Yandex.Metrika counter -->
</div>


  </body>
</html>

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>15.3.18. crate_anon.crateweb.consent.models &#8212; CRATE  documentation</title>
    <link rel="stylesheet" href="../../../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/css/crate_docs.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="15.3.19. crate_anon.crateweb.consent.storage" href="storage.html" />
    <link rel="prev" title="15.3.17. crate_anon.crateweb.consent.lookup_rio" href="lookup_rio.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="storage.html" title="15.3.19. crate_anon.crateweb.consent.storage"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="lookup_rio.html" title="15.3.17. crate_anon.crateweb.consent.lookup_rio"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">CRATE  documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" >15. Automatic documentation of source code</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="../_index.html" accesskey="U">15.3. crate_anon.crateweb</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="module-crate_anon.crateweb.consent.models">
<span id="crate-anon-crateweb-consent-models"></span><h1>15.3.18. crate_anon.crateweb.consent.models<a class="headerlink" href="#module-crate_anon.crateweb.consent.models" title="Permalink to this headline">¶</a></h1>
<hr class="docutils" />
<blockquote>
<div><p>Copyright (C) 2015-2018 Rudolf Cardinal (<a class="reference external" href="mailto:rudolf&#37;&#52;&#48;pobox&#46;com">rudolf<span>&#64;</span>pobox<span>&#46;</span>com</a>).</p>
<p>This file is part of CRATE.</p>
<p>CRATE is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.</p>
<p>CRATE is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
GNU General Public License for more details.</p>
<p>You should have received a copy of the GNU General Public License
along with CRATE. If not, see &lt;<a class="reference external" href="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</a>&gt;.</p>
</div></blockquote>
<hr class="docutils" />
<dl class="class">
<dt id="crate_anon.crateweb.consent.models.CharityPaymentRecord">
<em class="property">class </em><code class="descclassname">crate_anon.crateweb.consent.models.</code><code class="descname">CharityPaymentRecord</code><span class="sig-paren">(</span><em>id</em>, <em>created_at</em>, <em>payee</em>, <em>amount</em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/crate_anon/crateweb/consent/models.html#CharityPaymentRecord"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#crate_anon.crateweb.consent.models.CharityPaymentRecord" title="Permalink to this definition">¶</a></dt>
<dd><dl class="exception">
<dt id="crate_anon.crateweb.consent.models.CharityPaymentRecord.DoesNotExist">
<em class="property">exception </em><code class="descname">DoesNotExist</code><a class="headerlink" href="#crate_anon.crateweb.consent.models.CharityPaymentRecord.DoesNotExist" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="exception">
<dt id="crate_anon.crateweb.consent.models.CharityPaymentRecord.MultipleObjectsReturned">
<em class="property">exception </em><code class="descname">MultipleObjectsReturned</code><a class="headerlink" href="#crate_anon.crateweb.consent.models.CharityPaymentRecord.MultipleObjectsReturned" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="class">
<dt id="crate_anon.crateweb.consent.models.ClinicianResponse">
<em class="property">class </em><code class="descclassname">crate_anon.crateweb.consent.models.</code><code class="descname">ClinicianResponse</code><span class="sig-paren">(</span><em>id</em>, <em>created_at</em>, <em>contact_request</em>, <em>token</em>, <em>responded</em>, <em>responded_at</em>, <em>response_route</em>, <em>email_choice</em>, <em>response</em>, <em>veto_reason</em>, <em>ineligible_reason</em>, <em>pt_uncontactable_reason</em>, <em>clinician_confirm_name</em>, <em>charity_amount_due</em>, <em>processed</em>, <em>processed_at</em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/crate_anon/crateweb/consent/models.html#ClinicianResponse"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#crate_anon.crateweb.consent.models.ClinicianResponse" title="Permalink to this definition">¶</a></dt>
<dd><dl class="exception">
<dt id="crate_anon.crateweb.consent.models.ClinicianResponse.DoesNotExist">
<em class="property">exception </em><code class="descname">DoesNotExist</code><a class="headerlink" href="#crate_anon.crateweb.consent.models.ClinicianResponse.DoesNotExist" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="exception">
<dt id="crate_anon.crateweb.consent.models.ClinicianResponse.MultipleObjectsReturned">
<em class="property">exception </em><code class="descname">MultipleObjectsReturned</code><a class="headerlink" href="#crate_anon.crateweb.consent.models.ClinicianResponse.MultipleObjectsReturned" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="crate_anon.crateweb.consent.models.ClinicianResponse.finalize_a">
<code class="descname">finalize_a</code><span class="sig-paren">(</span><span class="sig-paren">)</span> &#x2192; None<a class="reference internal" href="../../../_modules/crate_anon/crateweb/consent/models.html#ClinicianResponse.finalize_a"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#crate_anon.crateweb.consent.models.ClinicianResponse.finalize_a" title="Permalink to this definition">¶</a></dt>
<dd><p>Call this when the clinician completes their response.
Part A: immediate, for acknowledgement.</p>
</dd></dl>

<dl class="method">
<dt id="crate_anon.crateweb.consent.models.ClinicianResponse.finalize_b">
<code class="descname">finalize_b</code><span class="sig-paren">(</span><span class="sig-paren">)</span> &#x2192; None<a class="reference internal" href="../../../_modules/crate_anon/crateweb/consent/models.html#ClinicianResponse.finalize_b"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#crate_anon.crateweb.consent.models.ClinicianResponse.finalize_b" title="Permalink to this definition">¶</a></dt>
<dd><p>Call this when the clinician completes their response.
Part B: background.</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="crate_anon.crateweb.consent.models.ConsentMode">
<em class="property">class </em><code class="descclassname">crate_anon.crateweb.consent.models.</code><code class="descname">ConsentMode</code><span class="sig-paren">(</span><em>id</em>, <em>decision_signed_by_patient</em>, <em>decision_otherwise_directly_authorized_by_patient</em>, <em>decision_under16_signed_by_parent</em>, <em>decision_under16_signed_by_clinician</em>, <em>decision_lack_capacity_signed_by_representative</em>, <em>decision_lack_capacity_signed_by_clinician</em>, <em>nhs_number</em>, <em>current</em>, <em>created_at</em>, <em>created_by</em>, <em>exclude_entirely</em>, <em>consent_mode</em>, <em>consent_after_discharge</em>, <em>max_approaches_per_year</em>, <em>other_requests</em>, <em>prefers_email</em>, <em>changed_by_clinician_override</em>, <em>source</em>, <em>skip_letter_to_patient</em>, <em>needs_processing</em>, <em>processed</em>, <em>processed_at</em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/crate_anon/crateweb/consent/models.html#ConsentMode"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#crate_anon.crateweb.consent.models.ConsentMode" title="Permalink to this definition">¶</a></dt>
<dd><dl class="exception">
<dt id="crate_anon.crateweb.consent.models.ConsentMode.DoesNotExist">
<em class="property">exception </em><code class="descname">DoesNotExist</code><a class="headerlink" href="#crate_anon.crateweb.consent.models.ConsentMode.DoesNotExist" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="exception">
<dt id="crate_anon.crateweb.consent.models.ConsentMode.MultipleObjectsReturned">
<em class="property">exception </em><code class="descname">MultipleObjectsReturned</code><a class="headerlink" href="#crate_anon.crateweb.consent.models.ConsentMode.MultipleObjectsReturned" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="crate_anon.crateweb.consent.models.ConsentMode.consider_withdrawal">
<code class="descname">consider_withdrawal</code><span class="sig-paren">(</span><span class="sig-paren">)</span> &#x2192; None<a class="reference internal" href="../../../_modules/crate_anon/crateweb/consent/models.html#ConsentMode.consider_withdrawal"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#crate_anon.crateweb.consent.models.ConsentMode.consider_withdrawal" title="Permalink to this definition">¶</a></dt>
<dd><p>If required, withdraw consent for other studies.</p>
<p>Note that as per Major Amendment 1 to 12/EE/0407, this happens
automatically, rather than having a special flag to control it.</p>
</dd></dl>

<dl class="method">
<dt id="crate_anon.crateweb.consent.models.ConsentMode.get_confirm_traffic_to_patient_letter_html">
<code class="descname">get_confirm_traffic_to_patient_letter_html</code><span class="sig-paren">(</span><span class="sig-paren">)</span> &#x2192; str<a class="reference internal" href="../../../_modules/crate_anon/crateweb/consent/models.html#ConsentMode.get_confirm_traffic_to_patient_letter_html"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#crate_anon.crateweb.consent.models.ConsentMode.get_confirm_traffic_to_patient_letter_html" title="Permalink to this definition">¶</a></dt>
<dd><p>REC DOCUMENT 07. Confirming patient’s traffic-light choice.</p>
</dd></dl>

<dl class="classmethod">
<dt id="crate_anon.crateweb.consent.models.ConsentMode.get_or_create">
<em class="property">classmethod </em><code class="descname">get_or_create</code><span class="sig-paren">(</span><em>nhs_number: int</em>, <em>created_by: auth.User</em><span class="sig-paren">)</span> &#x2192; ConsentMode<a class="reference internal" href="../../../_modules/crate_anon/crateweb/consent/models.html#ConsentMode.get_or_create"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#crate_anon.crateweb.consent.models.ConsentMode.get_or_create" title="Permalink to this definition">¶</a></dt>
<dd><p>Fetches the current ConsentMode for this patient.
If there isn’t one, creates a default one and returns that.</p>
</dd></dl>

<dl class="classmethod">
<dt id="crate_anon.crateweb.consent.models.ConsentMode.get_or_none">
<em class="property">classmethod </em><code class="descname">get_or_none</code><span class="sig-paren">(</span><em>nhs_number: int</em><span class="sig-paren">)</span> &#x2192; Union[ConsentMode, NoneType]<a class="reference internal" href="../../../_modules/crate_anon/crateweb/consent/models.html#ConsentMode.get_or_none"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#crate_anon.crateweb.consent.models.ConsentMode.get_or_none" title="Permalink to this definition">¶</a></dt>
<dd><p>Fetches the current ConsentMode for this patient.
If there isn’t one, returns None</p>
</dd></dl>

<dl class="method">
<dt id="crate_anon.crateweb.consent.models.ConsentMode.process_change">
<code class="descname">process_change</code><span class="sig-paren">(</span><span class="sig-paren">)</span> &#x2192; None<a class="reference internal" href="../../../_modules/crate_anon/crateweb/consent/models.html#ConsentMode.process_change"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#crate_anon.crateweb.consent.models.ConsentMode.process_change" title="Permalink to this definition">¶</a></dt>
<dd><p>Called upon saving.
Will create a letter to patient.
May create a withdrawal-of-consent letter to researcher.</p>
<p><strong>Major Amendment 1 (Oct 2014) to 12/EE/0407:</strong> always withdraw consent
and tell researchers, i.e. “active cancellation” of ongoing permission,
where the researchers have not yet made contact.</p>
</dd></dl>

<dl class="classmethod">
<dt id="crate_anon.crateweb.consent.models.ConsentMode.refresh_from_primary_clinical_record">
<em class="property">classmethod </em><code class="descname">refresh_from_primary_clinical_record</code><span class="sig-paren">(</span><em>nhs_number: int</em>, <em>created_by: auth.User</em>, <em>source_db: str = None</em><span class="sig-paren">)</span> &#x2192; List[str]<a class="reference internal" href="../../../_modules/crate_anon/crateweb/consent/models.html#ConsentMode.refresh_from_primary_clinical_record"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#crate_anon.crateweb.consent.models.ConsentMode.refresh_from_primary_clinical_record" title="Permalink to this definition">¶</a></dt>
<dd><p>Checks the primary clinical record and CRATE’s own records for consent
modes for this patient. If the most recent one is in the external
database, copies it to CRATE’s database and marks that one as current.</p>
<p>This has the effect that external primary clinical records (e.g. RiO)
take priority, but if there’s no record in RiO, we can still proceed.</p>
<p>Returns a list of human-readable decisions.</p>
<p>Internally, we do this:</p>
<ul class="simple">
<li>Fetch the most recent record.</li>
<li>If its date is later than the most recent CRATE record:<ul>
<li>create a new ConsentMode with (…, source=source_db)</li>
<li>save it</li>
</ul>
</li>
</ul>
<div class="admonition-todo admonition" id="index-0">
<p class="first admonition-title">Todo</p>
<p class="last">also: use celery beat to refresh regularly +/- trigger
withdrawal of consent if consent mode changed;
<a class="reference external" href="http://docs.celeryproject.org/en/latest/userguide/periodic-tasks.html">http://docs.celeryproject.org/en/latest/userguide/periodic-tasks.html</a></p>
</div>
<div class="admonition-todo admonition" id="index-1">
<p class="first admonition-title">Todo</p>
<p class="last">also make automatic opt-out list</p>
</div>
</dd></dl>

<dl class="method">
<dt id="crate_anon.crateweb.consent.models.ConsentMode.save">
<code class="descname">save</code><span class="sig-paren">(</span><em>*args</em>, <em>**kwargs</em><span class="sig-paren">)</span> &#x2192; None<a class="reference internal" href="../../../_modules/crate_anon/crateweb/consent/models.html#ConsentMode.save"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#crate_anon.crateweb.consent.models.ConsentMode.save" title="Permalink to this definition">¶</a></dt>
<dd><p>Custom save method.
Ensures that only one ConsentMode has current == True for a given
patient.</p>
<p>Better than a get_latest_by clause, because with a flag like this, we
can have a simple query that says “get the current records for all
patients” – harder if done by date (group by patient, order by
patient/date, pick last one for each patient…).</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="crate_anon.crateweb.consent.models.ContactRequest">
<em class="property">class </em><code class="descclassname">crate_anon.crateweb.consent.models.</code><code class="descname">ContactRequest</code><span class="sig-paren">(</span><em>id</em>, <em>created_at</em>, <em>request_by</em>, <em>study</em>, <em>request_direct_approach</em>, <em>lookup_nhs_number</em>, <em>lookup_rid</em>, <em>lookup_mrid</em>, <em>processed</em>, <em>processed_at</em>, <em>nhs_number</em>, <em>patient_lookup</em>, <em>consent_mode</em>, <em>approaches_in_past_year</em>, <em>decisions</em>, <em>decided_no_action</em>, <em>decided_send_to_researcher</em>, <em>decided_send_to_clinician</em>, <em>clinician_involvement</em>, <em>consent_withdrawn</em>, <em>consent_withdrawn_at</em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/crate_anon/crateweb/consent/models.html#ContactRequest"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#crate_anon.crateweb.consent.models.ContactRequest" title="Permalink to this definition">¶</a></dt>
<dd><dl class="exception">
<dt id="crate_anon.crateweb.consent.models.ContactRequest.DoesNotExist">
<em class="property">exception </em><code class="descname">DoesNotExist</code><a class="headerlink" href="#crate_anon.crateweb.consent.models.ContactRequest.DoesNotExist" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="exception">
<dt id="crate_anon.crateweb.consent.models.ContactRequest.MultipleObjectsReturned">
<em class="property">exception </em><code class="descname">MultipleObjectsReturned</code><a class="headerlink" href="#crate_anon.crateweb.consent.models.ContactRequest.MultipleObjectsReturned" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="classmethod">
<dt id="crate_anon.crateweb.consent.models.ContactRequest.create">
<em class="property">classmethod </em><code class="descname">create</code><span class="sig-paren">(</span><em>request: django.http.request.HttpRequest</em>, <em>study: crate_anon.crateweb.consent.models.Study</em>, <em>request_direct_approach: bool</em>, <em>lookup_nhs_number: int = None</em>, <em>lookup_rid: str = None</em>, <em>lookup_mrid: str = None</em><span class="sig-paren">)</span> &#x2192; crate_anon.crateweb.consent.models.ContactRequest<a class="reference internal" href="../../../_modules/crate_anon/crateweb/consent/models.html#ContactRequest.create"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#crate_anon.crateweb.consent.models.ContactRequest.create" title="Permalink to this definition">¶</a></dt>
<dd><p>Create a contact request and act on it.</p>
</dd></dl>

<dl class="method">
<dt id="crate_anon.crateweb.consent.models.ContactRequest.get_approval_email_html">
<code class="descname">get_approval_email_html</code><span class="sig-paren">(</span><span class="sig-paren">)</span> &#x2192; str<a class="reference internal" href="../../../_modules/crate_anon/crateweb/consent/models.html#ContactRequest.get_approval_email_html"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#crate_anon.crateweb.consent.models.ContactRequest.get_approval_email_html" title="Permalink to this definition">¶</a></dt>
<dd><p>Simple e-mail to researcher attaching letter.</p>
</dd></dl>

<dl class="method">
<dt id="crate_anon.crateweb.consent.models.ContactRequest.get_approval_letter_html">
<code class="descname">get_approval_letter_html</code><span class="sig-paren">(</span><span class="sig-paren">)</span> &#x2192; str<a class="reference internal" href="../../../_modules/crate_anon/crateweb/consent/models.html#ContactRequest.get_approval_letter_html"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#crate_anon.crateweb.consent.models.ContactRequest.get_approval_letter_html" title="Permalink to this definition">¶</a></dt>
<dd><p>REC DOCUMENT 15.
Letter to researcher approving contact.</p>
</dd></dl>

<dl class="method">
<dt id="crate_anon.crateweb.consent.models.ContactRequest.get_clinician_email_html">
<code class="descname">get_clinician_email_html</code><span class="sig-paren">(</span><em>save: bool = True</em><span class="sig-paren">)</span> &#x2192; str<a class="reference internal" href="../../../_modules/crate_anon/crateweb/consent/models.html#ContactRequest.get_clinician_email_html"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#crate_anon.crateweb.consent.models.ContactRequest.get_clinician_email_html" title="Permalink to this definition">¶</a></dt>
<dd><p>REC DOCUMENTS 09, 11, 13 (A): E-mail to clinician
E-mail to clinician asking them to pass on contact request.</p>
<p>URL method (path, querystring, both?): see notes in core/utils.py</p>
<p>In this case, decision: since we are creating a ClinicianResponse, we
should use its ModelForm.</p>
<ul class="simple">
<li>URL path for PK</li>
<li>querystring for other parameters, with form-based validation</li>
</ul>
</dd></dl>

<dl class="method">
<dt id="crate_anon.crateweb.consent.models.ContactRequest.get_letter_clinician_to_pt_re_study">
<code class="descname">get_letter_clinician_to_pt_re_study</code><span class="sig-paren">(</span><span class="sig-paren">)</span> &#x2192; str<a class="reference internal" href="../../../_modules/crate_anon/crateweb/consent/models.html#ContactRequest.get_letter_clinician_to_pt_re_study"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#crate_anon.crateweb.consent.models.ContactRequest.get_letter_clinician_to_pt_re_study" title="Permalink to this definition">¶</a></dt>
<dd><p>REC DOCUMENTS 10, 12, 14: draft letters from clinician to patient, with
decision form.</p>
</dd></dl>

<dl class="method">
<dt id="crate_anon.crateweb.consent.models.ContactRequest.get_permission_date">
<code class="descname">get_permission_date</code><span class="sig-paren">(</span><span class="sig-paren">)</span> &#x2192; Union[datetime.datetime, NoneType]<a class="reference internal" href="../../../_modules/crate_anon/crateweb/consent/models.html#ContactRequest.get_permission_date"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#crate_anon.crateweb.consent.models.ContactRequest.get_permission_date" title="Permalink to this definition">¶</a></dt>
<dd><p>When was the researcher given permission? Used for the letter
withdrawing permission.</p>
</dd></dl>

<dl class="method">
<dt id="crate_anon.crateweb.consent.models.ContactRequest.get_withdrawal_email_html">
<code class="descname">get_withdrawal_email_html</code><span class="sig-paren">(</span><span class="sig-paren">)</span> &#x2192; str<a class="reference internal" href="../../../_modules/crate_anon/crateweb/consent/models.html#ContactRequest.get_withdrawal_email_html"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#crate_anon.crateweb.consent.models.ContactRequest.get_withdrawal_email_html" title="Permalink to this definition">¶</a></dt>
<dd><p>Simple e-mail to researcher attaching letter.</p>
</dd></dl>

<dl class="method">
<dt id="crate_anon.crateweb.consent.models.ContactRequest.get_withdrawal_letter_html">
<code class="descname">get_withdrawal_letter_html</code><span class="sig-paren">(</span><span class="sig-paren">)</span> &#x2192; str<a class="reference internal" href="../../../_modules/crate_anon/crateweb/consent/models.html#ContactRequest.get_withdrawal_letter_html"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#crate_anon.crateweb.consent.models.ContactRequest.get_withdrawal_letter_html" title="Permalink to this definition">¶</a></dt>
<dd><p>REC DOCUMENT 16.
Letter to researcher notifying them of withdrawal of consent.</p>
</dd></dl>

<dl class="method">
<dt id="crate_anon.crateweb.consent.models.ContactRequest.process_request_main">
<code class="descname">process_request_main</code><span class="sig-paren">(</span><span class="sig-paren">)</span> &#x2192; None<a class="reference internal" href="../../../_modules/crate_anon/crateweb/consent/models.html#ContactRequest.process_request_main"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#crate_anon.crateweb.consent.models.ContactRequest.process_request_main" title="Permalink to this definition">¶</a></dt>
<dd><p>Act on a contact request and store the decisions made.
<strong>CORE DECISION-MAKING FUNCTION FOR THE CONSENT-TO-CONTACT PROCESS.</strong></p>
<p>The decisions parameter is a list that’s appended to.</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="crate_anon.crateweb.consent.models.DummyPatientSourceInfo">
<em class="property">class </em><code class="descclassname">crate_anon.crateweb.consent.models.</code><code class="descname">DummyPatientSourceInfo</code><span class="sig-paren">(</span><em>id</em>, <em>pt_local_id_description</em>, <em>pt_local_id_number</em>, <em>pt_dob</em>, <em>pt_dod</em>, <em>pt_dead</em>, <em>pt_discharged</em>, <em>pt_discharge_date</em>, <em>pt_sex</em>, <em>pt_title</em>, <em>pt_first_name</em>, <em>pt_last_name</em>, <em>pt_address_1</em>, <em>pt_address_2</em>, <em>pt_address_3</em>, <em>pt_address_4</em>, <em>pt_address_5</em>, <em>pt_address_6</em>, <em>pt_address_7</em>, <em>pt_telephone</em>, <em>pt_email</em>, <em>gp_title</em>, <em>gp_first_name</em>, <em>gp_last_name</em>, <em>gp_address_1</em>, <em>gp_address_2</em>, <em>gp_address_3</em>, <em>gp_address_4</em>, <em>gp_address_5</em>, <em>gp_address_6</em>, <em>gp_address_7</em>, <em>gp_telephone</em>, <em>gp_email</em>, <em>clinician_title</em>, <em>clinician_first_name</em>, <em>clinician_last_name</em>, <em>clinician_address_1</em>, <em>clinician_address_2</em>, <em>clinician_address_3</em>, <em>clinician_address_4</em>, <em>clinician_address_5</em>, <em>clinician_address_6</em>, <em>clinician_address_7</em>, <em>clinician_telephone</em>, <em>clinician_email</em>, <em>clinician_is_consultant</em>, <em>clinician_signatory_title</em>, <em>nhs_number</em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/crate_anon/crateweb/consent/models.html#DummyPatientSourceInfo"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#crate_anon.crateweb.consent.models.DummyPatientSourceInfo" title="Permalink to this definition">¶</a></dt>
<dd><dl class="exception">
<dt id="crate_anon.crateweb.consent.models.DummyPatientSourceInfo.DoesNotExist">
<em class="property">exception </em><code class="descname">DoesNotExist</code><a class="headerlink" href="#crate_anon.crateweb.consent.models.DummyPatientSourceInfo.DoesNotExist" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="exception">
<dt id="crate_anon.crateweb.consent.models.DummyPatientSourceInfo.MultipleObjectsReturned">
<em class="property">exception </em><code class="descname">MultipleObjectsReturned</code><a class="headerlink" href="#crate_anon.crateweb.consent.models.DummyPatientSourceInfo.MultipleObjectsReturned" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="class">
<dt id="crate_anon.crateweb.consent.models.Email">
<em class="property">class </em><code class="descclassname">crate_anon.crateweb.consent.models.</code><code class="descname">Email</code><span class="sig-paren">(</span><em>id</em>, <em>created_at</em>, <em>sender</em>, <em>recipient</em>, <em>subject</em>, <em>msg_text</em>, <em>msg_html</em>, <em>to_clinician</em>, <em>to_researcher</em>, <em>to_patient</em>, <em>study</em>, <em>contact_request</em>, <em>letter</em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/crate_anon/crateweb/consent/models.html#Email"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#crate_anon.crateweb.consent.models.Email" title="Permalink to this definition">¶</a></dt>
<dd><dl class="exception">
<dt id="crate_anon.crateweb.consent.models.Email.DoesNotExist">
<em class="property">exception </em><code class="descname">DoesNotExist</code><a class="headerlink" href="#crate_anon.crateweb.consent.models.Email.DoesNotExist" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="exception">
<dt id="crate_anon.crateweb.consent.models.Email.MultipleObjectsReturned">
<em class="property">exception </em><code class="descname">MultipleObjectsReturned</code><a class="headerlink" href="#crate_anon.crateweb.consent.models.Email.MultipleObjectsReturned" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="crate_anon.crateweb.consent.models.Email.send">
<code class="descname">send</code><span class="sig-paren">(</span><em>user: auth.User = None</em>, <em>resend: bool = False</em><span class="sig-paren">)</span> &#x2192; Union[EmailTransmission, NoneType]<a class="reference internal" href="../../../_modules/crate_anon/crateweb/consent/models.html#Email.send"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#crate_anon.crateweb.consent.models.Email.send" title="Permalink to this definition">¶</a></dt>
<dd><p>Sends the e-mail.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>user</strong> – the sender.</li>
<li><strong>resend</strong> – say that it’s OK to resend one that’s already been sent.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">an EmailTransmission object.</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="crate_anon.crateweb.consent.models.EmailAttachment">
<em class="property">class </em><code class="descclassname">crate_anon.crateweb.consent.models.</code><code class="descname">EmailAttachment</code><span class="sig-paren">(</span><em>*args</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/crate_anon/crateweb/consent/models.html#EmailAttachment"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#crate_anon.crateweb.consent.models.EmailAttachment" title="Permalink to this definition">¶</a></dt>
<dd><p>E-mail attachment class that does NOT manage its own files, i.e. if
the attachment object is deleted, the files won’t be. Use this for
referencing files already stored elsewhere in the database.</p>
<dl class="exception">
<dt id="crate_anon.crateweb.consent.models.EmailAttachment.DoesNotExist">
<em class="property">exception </em><code class="descname">DoesNotExist</code><a class="headerlink" href="#crate_anon.crateweb.consent.models.EmailAttachment.DoesNotExist" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="exception">
<dt id="crate_anon.crateweb.consent.models.EmailAttachment.MultipleObjectsReturned">
<em class="property">exception </em><code class="descname">MultipleObjectsReturned</code><a class="headerlink" href="#crate_anon.crateweb.consent.models.EmailAttachment.MultipleObjectsReturned" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="class">
<dt id="crate_anon.crateweb.consent.models.EmailTransmission">
<em class="property">class </em><code class="descclassname">crate_anon.crateweb.consent.models.</code><code class="descname">EmailTransmission</code><span class="sig-paren">(</span><em>id</em>, <em>email</em>, <em>at</em>, <em>by</em>, <em>sent</em>, <em>failure_reason</em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/crate_anon/crateweb/consent/models.html#EmailTransmission"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#crate_anon.crateweb.consent.models.EmailTransmission" title="Permalink to this definition">¶</a></dt>
<dd><dl class="exception">
<dt id="crate_anon.crateweb.consent.models.EmailTransmission.DoesNotExist">
<em class="property">exception </em><code class="descname">DoesNotExist</code><a class="headerlink" href="#crate_anon.crateweb.consent.models.EmailTransmission.DoesNotExist" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="exception">
<dt id="crate_anon.crateweb.consent.models.EmailTransmission.MultipleObjectsReturned">
<em class="property">exception </em><code class="descname">MultipleObjectsReturned</code><a class="headerlink" href="#crate_anon.crateweb.consent.models.EmailTransmission.MultipleObjectsReturned" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="class">
<dt id="crate_anon.crateweb.consent.models.Leaflet">
<em class="property">class </em><code class="descclassname">crate_anon.crateweb.consent.models.</code><code class="descname">Leaflet</code><span class="sig-paren">(</span><em>id</em>, <em>name</em>, <em>pdf</em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/crate_anon/crateweb/consent/models.html#Leaflet"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#crate_anon.crateweb.consent.models.Leaflet" title="Permalink to this definition">¶</a></dt>
<dd><dl class="exception">
<dt id="crate_anon.crateweb.consent.models.Leaflet.DoesNotExist">
<em class="property">exception </em><code class="descname">DoesNotExist</code><a class="headerlink" href="#crate_anon.crateweb.consent.models.Leaflet.DoesNotExist" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="exception">
<dt id="crate_anon.crateweb.consent.models.Leaflet.MultipleObjectsReturned">
<em class="property">exception </em><code class="descname">MultipleObjectsReturned</code><a class="headerlink" href="#crate_anon.crateweb.consent.models.Leaflet.MultipleObjectsReturned" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="class">
<dt id="crate_anon.crateweb.consent.models.Letter">
<em class="property">class </em><code class="descclassname">crate_anon.crateweb.consent.models.</code><code class="descname">Letter</code><span class="sig-paren">(</span><em>id</em>, <em>created_at</em>, <em>pdf</em>, <em>to_clinician</em>, <em>to_researcher</em>, <em>to_patient</em>, <em>rdbm_may_view</em>, <em>study</em>, <em>contact_request</em>, <em>sent_manually_at</em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/crate_anon/crateweb/consent/models.html#Letter"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#crate_anon.crateweb.consent.models.Letter" title="Permalink to this definition">¶</a></dt>
<dd><dl class="exception">
<dt id="crate_anon.crateweb.consent.models.Letter.DoesNotExist">
<em class="property">exception </em><code class="descname">DoesNotExist</code><a class="headerlink" href="#crate_anon.crateweb.consent.models.Letter.DoesNotExist" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="exception">
<dt id="crate_anon.crateweb.consent.models.Letter.MultipleObjectsReturned">
<em class="property">exception </em><code class="descname">MultipleObjectsReturned</code><a class="headerlink" href="#crate_anon.crateweb.consent.models.Letter.MultipleObjectsReturned" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="class">
<dt id="crate_anon.crateweb.consent.models.PatientLookup">
<em class="property">class </em><code class="descclassname">crate_anon.crateweb.consent.models.</code><code class="descname">PatientLookup</code><span class="sig-paren">(</span><em>*args</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/crate_anon/crateweb/consent/models.html#PatientLookup"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#crate_anon.crateweb.consent.models.PatientLookup" title="Permalink to this definition">¶</a></dt>
<dd><p>Represents a moment of lookup up identifiable data about patient, GP,
and clinician from the relevant clinical database.</p>
<p>Inherits from PatientLookupBase so it has the same fields, and more.</p>
<dl class="exception">
<dt id="crate_anon.crateweb.consent.models.PatientLookup.DoesNotExist">
<em class="property">exception </em><code class="descname">DoesNotExist</code><a class="headerlink" href="#crate_anon.crateweb.consent.models.PatientLookup.DoesNotExist" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="exception">
<dt id="crate_anon.crateweb.consent.models.PatientLookup.MultipleObjectsReturned">
<em class="property">exception </em><code class="descname">MultipleObjectsReturned</code><a class="headerlink" href="#crate_anon.crateweb.consent.models.PatientLookup.MultipleObjectsReturned" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="crate_anon.crateweb.consent.models.PatientLookup.get_first_traffic_light_letter_html">
<code class="descname">get_first_traffic_light_letter_html</code><span class="sig-paren">(</span><span class="sig-paren">)</span> &#x2192; str<a class="reference internal" href="../../../_modules/crate_anon/crateweb/consent/models.html#PatientLookup.get_first_traffic_light_letter_html"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#crate_anon.crateweb.consent.models.PatientLookup.get_first_traffic_light_letter_html" title="Permalink to this definition">¶</a></dt>
<dd><p>REC DOCUMENT 06. Covering letter to patient for first enquiry about
research preference</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="crate_anon.crateweb.consent.models.PatientLookupBase">
<em class="property">class </em><code class="descclassname">crate_anon.crateweb.consent.models.</code><code class="descname">PatientLookupBase</code><span class="sig-paren">(</span><em>*args</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/crate_anon/crateweb/consent/models.html#PatientLookupBase"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#crate_anon.crateweb.consent.models.PatientLookupBase" title="Permalink to this definition">¶</a></dt>
<dd><p>Base class for PatientLookup and DummyPatientSourceInfo.
Must be able to be instantiate with defaults, for the “not found”
situation.</p>
<dl class="method">
<dt id="crate_anon.crateweb.consent.models.PatientLookupBase.days_since_discharge">
<code class="descname">days_since_discharge</code><span class="sig-paren">(</span><span class="sig-paren">)</span> &#x2192; Union[int, NoneType]<a class="reference internal" href="../../../_modules/crate_anon/crateweb/consent/models.html#PatientLookupBase.days_since_discharge"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#crate_anon.crateweb.consent.models.PatientLookupBase.days_since_discharge" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns days since discharge, or None if the patient is not
discharged (or unknown).</p>
</dd></dl>

<dl class="method">
<dt id="crate_anon.crateweb.consent.models.PatientLookupBase.set_gp_name_components">
<code class="descname">set_gp_name_components</code><span class="sig-paren">(</span><em>name: str, decisions: List[str], secret_decisions: List[str]</em><span class="sig-paren">)</span> &#x2192; None<a class="reference internal" href="../../../_modules/crate_anon/crateweb/consent/models.html#PatientLookupBase.set_gp_name_components"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#crate_anon.crateweb.consent.models.PatientLookupBase.set_gp_name_components" title="Permalink to this definition">¶</a></dt>
<dd><p>Takes name, and stores it in the gp_title, gp_first_name, and
gp_last_name fields.</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="crate_anon.crateweb.consent.models.PatientResponse">
<em class="property">class </em><code class="descclassname">crate_anon.crateweb.consent.models.</code><code class="descname">PatientResponse</code><span class="sig-paren">(</span><em>id</em>, <em>decision_signed_by_patient</em>, <em>decision_otherwise_directly_authorized_by_patient</em>, <em>decision_under16_signed_by_parent</em>, <em>decision_under16_signed_by_clinician</em>, <em>decision_lack_capacity_signed_by_representative</em>, <em>decision_lack_capacity_signed_by_clinician</em>, <em>created_at</em>, <em>contact_request</em>, <em>recorded_by</em>, <em>response</em>, <em>processed</em>, <em>processed_at</em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/crate_anon/crateweb/consent/models.html#PatientResponse"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#crate_anon.crateweb.consent.models.PatientResponse" title="Permalink to this definition">¶</a></dt>
<dd><dl class="exception">
<dt id="crate_anon.crateweb.consent.models.PatientResponse.DoesNotExist">
<em class="property">exception </em><code class="descname">DoesNotExist</code><a class="headerlink" href="#crate_anon.crateweb.consent.models.PatientResponse.DoesNotExist" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="exception">
<dt id="crate_anon.crateweb.consent.models.PatientResponse.MultipleObjectsReturned">
<em class="property">exception </em><code class="descname">MultipleObjectsReturned</code><a class="headerlink" href="#crate_anon.crateweb.consent.models.PatientResponse.MultipleObjectsReturned" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="class">
<dt id="crate_anon.crateweb.consent.models.Study">
<em class="property">class </em><code class="descclassname">crate_anon.crateweb.consent.models.</code><code class="descname">Study</code><span class="sig-paren">(</span><em>id</em>, <em>institutional_id</em>, <em>title</em>, <em>lead_researcher</em>, <em>registered_at</em>, <em>summary</em>, <em>search_methods_planned</em>, <em>patient_contact</em>, <em>include_under_16s</em>, <em>include_lack_capacity</em>, <em>clinical_trial</em>, <em>include_discharged</em>, <em>request_direct_approach</em>, <em>approved_by_rec</em>, <em>rec_reference</em>, <em>approved_locally</em>, <em>local_approval_at</em>, <em>study_details_pdf</em>, <em>subject_form_template_pdf</em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/crate_anon/crateweb/consent/models.html#Study"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#crate_anon.crateweb.consent.models.Study" title="Permalink to this definition">¶</a></dt>
<dd><dl class="exception">
<dt id="crate_anon.crateweb.consent.models.Study.DoesNotExist">
<em class="property">exception </em><code class="descname">DoesNotExist</code><a class="headerlink" href="#crate_anon.crateweb.consent.models.Study.DoesNotExist" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="exception">
<dt id="crate_anon.crateweb.consent.models.Study.MultipleObjectsReturned">
<em class="property">exception </em><code class="descname">MultipleObjectsReturned</code><a class="headerlink" href="#crate_anon.crateweb.consent.models.Study.MultipleObjectsReturned" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="class">
<dt id="crate_anon.crateweb.consent.models.TeamInfo">
<em class="property">class </em><code class="descclassname">crate_anon.crateweb.consent.models.</code><code class="descname">TeamInfo</code><a class="reference internal" href="../../../_modules/crate_anon/crateweb/consent/models.html#TeamInfo"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#crate_anon.crateweb.consent.models.TeamInfo" title="Permalink to this definition">¶</a></dt>
<dd><p>Class only exists to be able to use &#64;cached_property.</p>
</dd></dl>

<dl class="class">
<dt id="crate_anon.crateweb.consent.models.TeamRep">
<em class="property">class </em><code class="descclassname">crate_anon.crateweb.consent.models.</code><code class="descname">TeamRep</code><span class="sig-paren">(</span><em>*args</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/crate_anon/crateweb/consent/models.html#TeamRep"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#crate_anon.crateweb.consent.models.TeamRep" title="Permalink to this definition">¶</a></dt>
<dd><p>Clinical team representatives are recorded in CRATE.</p>
<dl class="exception">
<dt id="crate_anon.crateweb.consent.models.TeamRep.DoesNotExist">
<em class="property">exception </em><code class="descname">DoesNotExist</code><a class="headerlink" href="#crate_anon.crateweb.consent.models.TeamRep.DoesNotExist" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="exception">
<dt id="crate_anon.crateweb.consent.models.TeamRep.MultipleObjectsReturned">
<em class="property">exception </em><code class="descname">MultipleObjectsReturned</code><a class="headerlink" href="#crate_anon.crateweb.consent.models.TeamRep.MultipleObjectsReturned" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="function">
<dt id="crate_anon.crateweb.consent.models.auto_delete_emailattachment_files_on_change">
<code class="descclassname">crate_anon.crateweb.consent.models.</code><code class="descname">auto_delete_emailattachment_files_on_change</code><span class="sig-paren">(</span><em>sender: Type[crate_anon.crateweb.consent.models.EmailAttachment], instance: crate_anon.crateweb.consent.models.EmailAttachment, **kwargs</em><span class="sig-paren">)</span> &#x2192; None<a class="reference internal" href="../../../_modules/crate_anon/crateweb/consent/models.html#auto_delete_emailattachment_files_on_change"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#crate_anon.crateweb.consent.models.auto_delete_emailattachment_files_on_change" title="Permalink to this definition">¶</a></dt>
<dd><p>Deletes files from filesystem when EmailAttachment object is changed.</p>
</dd></dl>

<dl class="function">
<dt id="crate_anon.crateweb.consent.models.auto_delete_emailattachment_files_on_delete">
<code class="descclassname">crate_anon.crateweb.consent.models.</code><code class="descname">auto_delete_emailattachment_files_on_delete</code><span class="sig-paren">(</span><em>sender: Type[crate_anon.crateweb.consent.models.EmailAttachment], instance: crate_anon.crateweb.consent.models.EmailAttachment, **kwargs</em><span class="sig-paren">)</span> &#x2192; None<a class="reference internal" href="../../../_modules/crate_anon/crateweb/consent/models.html#auto_delete_emailattachment_files_on_delete"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#crate_anon.crateweb.consent.models.auto_delete_emailattachment_files_on_delete" title="Permalink to this definition">¶</a></dt>
<dd><p>Deletes files from filesystem when EmailAttachment object is deleted.</p>
</dd></dl>

<dl class="function">
<dt id="crate_anon.crateweb.consent.models.auto_delete_leaflet_files_on_change">
<code class="descclassname">crate_anon.crateweb.consent.models.</code><code class="descname">auto_delete_leaflet_files_on_change</code><span class="sig-paren">(</span><em>sender: Type[crate_anon.crateweb.consent.models.Leaflet], instance: crate_anon.crateweb.consent.models.Leaflet, **kwargs</em><span class="sig-paren">)</span> &#x2192; None<a class="reference internal" href="../../../_modules/crate_anon/crateweb/consent/models.html#auto_delete_leaflet_files_on_change"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#crate_anon.crateweb.consent.models.auto_delete_leaflet_files_on_change" title="Permalink to this definition">¶</a></dt>
<dd><p>Deletes files from filesystem when Leaflet object is changed.</p>
</dd></dl>

<dl class="function">
<dt id="crate_anon.crateweb.consent.models.auto_delete_leaflet_files_on_delete">
<code class="descclassname">crate_anon.crateweb.consent.models.</code><code class="descname">auto_delete_leaflet_files_on_delete</code><span class="sig-paren">(</span><em>sender: Type[crate_anon.crateweb.consent.models.Leaflet], instance: crate_anon.crateweb.consent.models.Leaflet, **kwargs</em><span class="sig-paren">)</span> &#x2192; None<a class="reference internal" href="../../../_modules/crate_anon/crateweb/consent/models.html#auto_delete_leaflet_files_on_delete"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#crate_anon.crateweb.consent.models.auto_delete_leaflet_files_on_delete" title="Permalink to this definition">¶</a></dt>
<dd><p>Deletes files from filesystem when Leaflet object is deleted.</p>
</dd></dl>

<dl class="function">
<dt id="crate_anon.crateweb.consent.models.auto_delete_letter_files_on_change">
<code class="descclassname">crate_anon.crateweb.consent.models.</code><code class="descname">auto_delete_letter_files_on_change</code><span class="sig-paren">(</span><em>sender: Type[crate_anon.crateweb.consent.models.Letter], instance: crate_anon.crateweb.consent.models.Letter, **kwargs</em><span class="sig-paren">)</span> &#x2192; None<a class="reference internal" href="../../../_modules/crate_anon/crateweb/consent/models.html#auto_delete_letter_files_on_change"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#crate_anon.crateweb.consent.models.auto_delete_letter_files_on_change" title="Permalink to this definition">¶</a></dt>
<dd><p>Deletes files from filesystem when Letter object is changed.</p>
</dd></dl>

<dl class="function">
<dt id="crate_anon.crateweb.consent.models.auto_delete_letter_files_on_delete">
<code class="descclassname">crate_anon.crateweb.consent.models.</code><code class="descname">auto_delete_letter_files_on_delete</code><span class="sig-paren">(</span><em>sender: Type[crate_anon.crateweb.consent.models.Letter], instance: crate_anon.crateweb.consent.models.Letter, **kwargs</em><span class="sig-paren">)</span> &#x2192; None<a class="reference internal" href="../../../_modules/crate_anon/crateweb/consent/models.html#auto_delete_letter_files_on_delete"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#crate_anon.crateweb.consent.models.auto_delete_letter_files_on_delete" title="Permalink to this definition">¶</a></dt>
<dd><p>Deletes files from filesystem when Letter object is deleted.</p>
</dd></dl>

<dl class="function">
<dt id="crate_anon.crateweb.consent.models.auto_delete_study_files_on_change">
<code class="descclassname">crate_anon.crateweb.consent.models.</code><code class="descname">auto_delete_study_files_on_change</code><span class="sig-paren">(</span><em>sender: Type[crate_anon.crateweb.consent.models.Study], instance: crate_anon.crateweb.consent.models.Study, **kwargs</em><span class="sig-paren">)</span> &#x2192; None<a class="reference internal" href="../../../_modules/crate_anon/crateweb/consent/models.html#auto_delete_study_files_on_change"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#crate_anon.crateweb.consent.models.auto_delete_study_files_on_change" title="Permalink to this definition">¶</a></dt>
<dd><p>Deletes files from filesystem when Study object is changed.</p>
</dd></dl>

<dl class="function">
<dt id="crate_anon.crateweb.consent.models.auto_delete_study_files_on_delete">
<code class="descclassname">crate_anon.crateweb.consent.models.</code><code class="descname">auto_delete_study_files_on_delete</code><span class="sig-paren">(</span><em>sender: Type[crate_anon.crateweb.consent.models.Study], instance: crate_anon.crateweb.consent.models.Study, **kwargs</em><span class="sig-paren">)</span> &#x2192; None<a class="reference internal" href="../../../_modules/crate_anon/crateweb/consent/models.html#auto_delete_study_files_on_delete"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#crate_anon.crateweb.consent.models.auto_delete_study_files_on_delete" title="Permalink to this definition">¶</a></dt>
<dd><p>Deletes files from filesystem when Study object is deleted.</p>
</dd></dl>

<dl class="function">
<dt id="crate_anon.crateweb.consent.models.leaflet_upload_to">
<code class="descclassname">crate_anon.crateweb.consent.models.</code><code class="descname">leaflet_upload_to</code><span class="sig-paren">(</span><em>instance: crate_anon.crateweb.consent.models.Leaflet</em>, <em>filename: str</em><span class="sig-paren">)</span> &#x2192; str<a class="reference internal" href="../../../_modules/crate_anon/crateweb/consent/models.html#leaflet_upload_to"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#crate_anon.crateweb.consent.models.leaflet_upload_to" title="Permalink to this definition">¶</a></dt>
<dd><p>Determines the filename used for leaflet uploads.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>instance</strong> – instance of Leaflet (potentially unsaved)
… and you can’t call save(); it goes into infinite recursion</li>
<li><strong>filename</strong> – uploaded filename</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="crate_anon.crateweb.consent.models.make_dummy_objects">
<code class="descclassname">crate_anon.crateweb.consent.models.</code><code class="descname">make_dummy_objects</code><span class="sig-paren">(</span><em>request: django.http.request.HttpRequest</em><span class="sig-paren">)</span> &#x2192; crate_anon.crateweb.consent.models.DummyObjectCollection<a class="reference internal" href="../../../_modules/crate_anon/crateweb/consent/models.html#make_dummy_objects"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#crate_anon.crateweb.consent.models.make_dummy_objects" title="Permalink to this definition">¶</a></dt>
<dd><p>We want to create these objects in memory, without saving to the DB.
However, Django  is less good at SQLAlchemy for this, and saves.</p>
<ul class="simple">
<li><a class="reference external" href="http://stackoverflow.com/questions/7908349/django-making-relationships-in-memory-without-saving-to-db">http://stackoverflow.com/questions/7908349/django-making-relationships-in-memory-without-saving-to-db</a>  # noqa</li>
<li><a class="reference external" href="https://code.djangoproject.com/ticket/17253">https://code.djangoproject.com/ticket/17253</a></li>
<li><a class="reference external" href="http://stackoverflow.com/questions/23372786/django-models-assigning-foreignkey-object-without-saving-to-database">http://stackoverflow.com/questions/23372786/django-models-assigning-foreignkey-object-without-saving-to-database</a>  # noqa</li>
<li><a class="reference external" href="http://stackoverflow.com/questions/7121341/django-adding-objects-to-a-related-set-without-saving-to-db">http://stackoverflow.com/questions/7121341/django-adding-objects-to-a-related-set-without-saving-to-db</a>  # noqa</li>
</ul>
<p>A simple method works for an SQLite backend database but fails with
an IntegrityError for MySQL/SQL Server. For example:</p>
<blockquote>
<div>IntegrityError at /draft_traffic_light_decision_form/-1/html/
(1452, ‘Cannot add or update a child row: a foreign key constraint
fails (<cite>crate_django</cite>.`consent_study_researchers`, CONSTRAINT
<cite>consent_study_researchers_study_id_19bb255f_fk_consent_study_id</cite>
FOREIGN KEY (<cite>study_id</cite>) REFERENCES <cite>consent_study</cite> (<cite>id</cite>))’)</div></blockquote>
<p>This occurs in the first creation, of a Study, and only if you specify
‘researchers’.</p>
<p>The reason for the crash is that ‘researchers’ is a ManyToManyField, and
Django is trying to set the user.studies_as_researcher back-reference, but
can’t do so because the Study doesn’t have a PK yet.</p>
<p>Since this is a minor thing, and templates are unaffected, and this is only
for debugging, let’s ignore it.</p>
</dd></dl>

<dl class="function">
<dt id="crate_anon.crateweb.consent.models.study_details_upload_to">
<code class="descclassname">crate_anon.crateweb.consent.models.</code><code class="descname">study_details_upload_to</code><span class="sig-paren">(</span><em>instance: crate_anon.crateweb.consent.models.Study</em>, <em>filename: str</em><span class="sig-paren">)</span> &#x2192; str<a class="reference internal" href="../../../_modules/crate_anon/crateweb/consent/models.html#study_details_upload_to"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#crate_anon.crateweb.consent.models.study_details_upload_to" title="Permalink to this definition">¶</a></dt>
<dd><p>Determines the filename used for study information PDF uploads.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>instance</strong> – instance of Study (potentially unsaved)
… and you can’t call save(); it goes into infinite recursion</li>
<li><strong>filename</strong> – uploaded filename</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="crate_anon.crateweb.consent.models.study_form_upload_to">
<code class="descclassname">crate_anon.crateweb.consent.models.</code><code class="descname">study_form_upload_to</code><span class="sig-paren">(</span><em>instance: crate_anon.crateweb.consent.models.Study</em>, <em>filename: str</em><span class="sig-paren">)</span> &#x2192; str<a class="reference internal" href="../../../_modules/crate_anon/crateweb/consent/models.html#study_form_upload_to"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#crate_anon.crateweb.consent.models.study_form_upload_to" title="Permalink to this definition">¶</a></dt>
<dd><p>Determines the filename used for study clinician-form PDF uploads.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>instance</strong> – instance of Study (potentially unsaved)</li>
<li><strong>filename</strong> – uploaded filename</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h3><a href="../../../index.html">Table Of Contents</a></h3>
<p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../introduction/overview.html">1. Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../introduction/package_elements.html">2. Package elements in brief</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../introduction/publications.html">3. Reference publications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../installation/installation.html">4. Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../installation/database_drivers.html">5. Databases and database drivers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../anonymisation/index.html">6. Anonymisation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../nlp/index.html">7. Natural language processing (NLP)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../website_config/index.html">8. Configuring the CRATE web interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../website_using/index.html">9. Using the CRATE web interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../misc/ancillary_tools.html">10. Ancillary tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../misc/troubleshooting.html">11. Troubleshooting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../misc/technical_notes.html">12. Technical notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../misc/upgrading.html">13. Upgrading CRATE</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../misc/tcpip_ports.html">14. Common relevant TCP/IP ports</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../index.html">15. Automatic documentation of source code</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../anonymise/_index.html">15.1. crate_anon.anonymise</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../common/_index.html">15.2. crate_anon.common</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../_index.html">15.3. crate_anon.crateweb</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../nlp_manager/_index.html">15.4. crate_anon.nlp_manager</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../preprocess/_index.html">15.5. crate_anon.preprocess</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tools/_index.html">15.6. crate_anon.tools</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../changelog.html">16. Change log/history</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../to_do.html">17. Things to do</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../glossary.html">18. Abbreviations and glossary</a></li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="lookup_rio.html"
                        title="previous chapter">15.3.17. crate_anon.crateweb.consent.lookup_rio</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="storage.html"
                        title="next chapter">15.3.19. crate_anon.crateweb.consent.storage</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../../../_sources/autodoc/crateweb/consent/models.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="storage.html" title="15.3.19. crate_anon.crateweb.consent.storage"
             >next</a> |</li>
        <li class="right" >
          <a href="lookup_rio.html" title="15.3.17. crate_anon.crateweb.consent.lookup_rio"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">CRATE  documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" >15. Automatic documentation of source code</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="../_index.html" >15.3. crate_anon.crateweb</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2018, Rudolf Cardinal.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.7.5.
    </div>
  </body>
</html>
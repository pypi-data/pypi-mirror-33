
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>4. Installation &#8212; CRATE  documentation</title>
    <link rel="stylesheet" href="../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/css/crate_docs.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="5. Databases and database drivers" href="database_drivers.html" />
    <link rel="prev" title="&lt;no title&gt;" href="index.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="database_drivers.html" title="5. Databases and database drivers"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="index.html" title="&lt;no title&gt;"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">CRATE  documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">&lt;no title&gt;</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="installation">
<h1>4. Installation<a class="headerlink" href="#installation" title="Permalink to this headline">¶</a></h1>
<div class="section" id="urls-for-crate-source-code">
<h2>4.1. URLs for CRATE source code<a class="headerlink" href="#urls-for-crate-source-code" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><a class="reference external" href="https://github.com/RudolfCardinal/crate">https://github.com/RudolfCardinal/crate</a> (for source)</li>
<li><a class="reference external" href="https://pypi.io/project/crate-anon/">https://pypi.io/project/crate-anon/</a> (for <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">crate-anon</span></code>)</li>
</ul>
</div>
<div class="section" id="ubuntu-linux-from-debian-package">
<h2>4.2. Ubuntu Linux, from Debian package<a class="headerlink" href="#ubuntu-linux-from-debian-package" title="Permalink to this headline">¶</a></h2>
<p>To install CRATE and all its dependencies, download the Debian package and use
<code class="docutils literal notranslate"><span class="pre">gdebi</span></code>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo gdebi crate-VERSION.deb
</pre></div>
</div>
<p>(If you don’t have <code class="docutils literal notranslate"><span class="pre">gdebi</span></code>, install it with <code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">apt-get</span> <span class="pre">install</span> <span class="pre">gdebi</span></code>.)</p>
</div>
<div class="section" id="manual-installation">
<h2>4.3. Manual installation<a class="headerlink" href="#manual-installation" title="Permalink to this headline">¶</a></h2>
<div class="section" id="python">
<h3>4.3.1. Python<a class="headerlink" href="#python" title="Permalink to this headline">¶</a></h3>
<p>Install Python 3.4 or higher. If it’s not already installed:</p>
<p><strong>Linux</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo apt-get install python3.4-dev
</pre></div>
</div>
<p><strong>Windows</strong></p>
<ul class="simple">
<li><a class="reference external" href="https://www.python.org/">https://www.python.org/</a> → Downloads</li>
</ul>
</div>
<div class="section" id="rabbitmq">
<h3>4.3.2. RabbitMQ<a class="headerlink" href="#rabbitmq" title="Permalink to this headline">¶</a></h3>
<p>Install RabbitMQ, required by the CRATE web site.</p>
<p><strong>Linux</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo apt-get install rabbitmq
<span class="c1"># Check it&#39;s working:</span>
sudo rabbitmqctl status
</pre></div>
</div>
<p><strong>Windows</strong></p>
<ul class="simple">
<li>Download/install Erlang from <a class="reference external" href="http://www.erlang.org/downloads">http://www.erlang.org/downloads</a>. The 32-bit
Windows download (Erlang/OTP 18.3) does not work on Windows XP, so everything
that follows has been tested on Windows 10, 64-bit.</li>
<li>Download/install RabbitMQ from <a class="reference external" href="https://www.rabbitmq.com/">https://www.rabbitmq.com/</a> → Download. (If you
use the default installer, it will find Erlang automatically.)</li>
<li>Check it’s working: <span class="menuselection">Start ‣ RabbitMQ Server ‣ RabbitMQ
Command Prompt (sbin dir)</span>. Then type <code class="docutils literal notranslate"><span class="pre">rabbitmqctl</span> <span class="pre">status</span></code>. It’s helpful to
do this, because you need to tell Windows to allow the various bits of
RabbitMQ/Erlang to communicate over internal networks, and (under Windows 10)
this triggers the appropriate prompts.</li>
<li>For additional RabbitMQ help see
<a class="reference external" href="https://cmatskas.com/getting-started-with-rabbitmq-on-windows/">https://cmatskas.com/getting-started-with-rabbitmq-on-windows/</a>.</li>
</ul>
</div>
<div class="section" id="java">
<h3>4.3.3. Java<a class="headerlink" href="#java" title="Permalink to this headline">¶</a></h3>
<p>Install a Java development kit, to compile support for GATE natural language
processing (NLP).</p>
<p><strong>Linux</strong></p>
<ul class="simple">
<li>Usually built in.</li>
</ul>
<p><strong>Windows</strong></p>
<ul class="simple">
<li>Download/run the Java Development Kit installer from Oracle.</li>
</ul>
</div>
<div class="section" id="gate">
<h3>4.3.4. GATE<a class="headerlink" href="#gate" title="Permalink to this headline">¶</a></h3>
<p>Install GATE, for NLP.</p>
<ul class="simple">
<li>Download and install GATE from <a class="reference external" href="https://gate.ac.uk/download/">https://gate.ac.uk/download/</a></li>
</ul>
</div>
<div class="section" id="python-virtual-environment">
<h3>4.3.5. Python virtual environment<a class="headerlink" href="#python-virtual-environment" title="Permalink to this headline">¶</a></h3>
<p>Create a Python virtual environment (an isolated set of Python programs
that won’t interfere with any other Python things) and install CRATE.
Choose your own directory names.</p>
<p><strong>Linux</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python3.4 -m virtualenv ~/venvs/crate
<span class="nb">source</span> ~/venvs/crate/bin/activate
python -m pip install --upgrade pip
pip install crate-anon
</pre></div>
</div>
<p><strong>Windows</strong></p>
<div class="highlight-bat notranslate"><div class="highlight"><pre><span></span>C<span class="p">:</span><span class="nl">\Python34\python.exe</span><span class="c1"> -m ensurepip</span>
C<span class="p">:</span><span class="nl">\Python34\python.exe</span><span class="c1"> -m pip install --upgrade pip</span>
C<span class="p">:</span><span class="nl">\Python34\python.exe</span><span class="c1"> -m pip install --upgrade virtualenv</span>
C<span class="p">:</span><span class="nl">\Python34\python.exe</span><span class="c1"> -m virtualenv C:\venvs\crate</span>
C<span class="p">:</span><span class="nl">\venvs\crate\Scripts\activate</span>
pip install crate-anon
</pre></div>
</div>
</div>
<div class="section" id="activating-your-virtual-environment">
<span id="activate-venv"></span><h3>4.3.6. Activating your virtual environment<a class="headerlink" href="#activating-your-virtual-environment" title="Permalink to this headline">¶</a></h3>
<p><strong>Every time you want to work within your virtual environment, you should
activate it, by running (Windows) or sourcing (Linux) the ``activate`` script
within it, as above.</strong></p>
<p>Once activated,</p>
<ul class="simple">
<li>the PATHs are set up for the programs in the virtual environment;</li>
<li>when you run Python, you will run the copy in the virtual environment;</li>
<li>the Python package installation tool, <code class="docutils literal notranslate"><span class="pre">pip</span></code>, will be the one in the virtual
environment and will modify the virtual environment (not the whole system).</li>
</ul>
<p>See:</p>
<ul class="simple">
<li><a class="reference external" href="https://docs.python.org/3/tutorial/venv.html">https://docs.python.org/3/tutorial/venv.html</a></li>
<li><a class="reference external" href="https://realpython.com/python-virtual-environments-a-primer/">https://realpython.com/python-virtual-environments-a-primer/</a></li>
</ul>
</div>
<div class="section" id="third-party-text-extractors">
<h3>4.3.7. Third-party text extractors<a class="headerlink" href="#third-party-text-extractors" title="Permalink to this headline">¶</a></h3>
<p>Ensure any necessary third-party text extractor tools are installed and on the
PATH.</p>
<p>Good extractors are built into CRATE for:</p>
<ul class="simple">
<li>Office Open XML (DOCX, DOCM), for Microsoft Word 2007 onwards;</li>
<li>HTM(L), XML;</li>
<li>Open Document text format (ODT), for OpenOffice/LibreOffice;</li>
<li>plain text (LOG, TXT).</li>
</ul>
<p>For some, there is a fallback converter built in, but third-party tools are
faster:</p>
<ul class="simple">
<li>PDF: speed improves by installing <code class="docutils literal notranslate"><span class="pre">pdftotext</span></code> <a class="footnote-reference" href="#pdftotext" id="id1">[1]</a></li>
<li>Rich Text Format (RTF): speed improves by installing <code class="docutils literal notranslate"><span class="pre">unrtf</span></code> <a class="footnote-reference" href="#unrtf" id="id2">[2]</a></li>
</ul>
<p>For some, you will need an external tool:</p>
<ul class="simple">
<li>For Microsoft Word 97–2003 binary (DOC) files, you will need <code class="docutils literal notranslate"><span class="pre">antiword</span></code>
<a class="footnote-reference" href="#antiword" id="id3">[3]</a></li>
<li>As a fallback tool (“extract text from anything”), CRATE will use <code class="docutils literal notranslate"><span class="pre">strings</span></code>
or <code class="docutils literal notranslate"><span class="pre">strings2</span></code> <a class="footnote-reference" href="#strings" id="id4">[4]</a>, whichever it finds first.</li>
</ul>
<p>If you install any manually, check they run, as follows.</p>
<p>Check that your text extractors are available and visible to CRATE via the
PATH. Pass any extensions for which you want to see a report.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>crate_anonymise --checkextractor .doc .docx .odt .pdf .rtf .txt None
</pre></div>
</div>
</div>
<div class="section" id="c-c-compiler">
<h3>4.3.8. C/C++ compiler<a class="headerlink" href="#c-c-compiler" title="Permalink to this headline">¶</a></h3>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This is optional. If you want to install C-based Python libraries, you’ll
need a C/C++ compiler for Python 3.4.</p>
</div>
<p><strong>Linux</strong></p>
<p>Built in.</p>
<p><strong>Windows</strong></p>
<p>Tricky as the official compiler for Python 3.4 is Visual Studio 2010 <a class="footnote-reference" href="#vs2010" id="id5">[5]</a>
<a class="footnote-reference" href="#python34vstudio" id="id6">[7]</a> <a class="footnote-reference" href="#vstudiogeneral" id="id7">[8]</a>. Essentially, this can be hard (e.g. on
64-bit Windows or with later compilers).</p>
<p>FUTURE PLANS: use Python 3.5, which supports Visual C++ 14.0 <a class="footnote-reference" href="#vs2015" id="id8">[6]</a>. At
present the necessary dependencies do not work cleanly.</p>
<p class="rubric">Footnotes</p>
<table class="docutils footnote" frame="void" id="pdftotext" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id1">[1]</a></td><td><code class="docutils literal notranslate"><span class="pre">pdftotext</span></code>: Ubuntu: <code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">apt-get</span> <span class="pre">install</span> <span class="pre">poppler-utils</span></code>.
Windows: see <a class="reference external" href="http://blog.alivate.com.au/poppler-windows/">http://blog.alivate.com.au/poppler-windows/</a>, then install it
and add it to the PATH.</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="unrtf" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id2">[2]</a></td><td><code class="docutils literal notranslate"><span class="pre">unrtf</span></code>: Ubuntu: <code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">apt-get</span> <span class="pre">install</span> <span class="pre">unrtf</span></code>.
Windows: see <a class="reference external" href="http://gnuwin32.sourceforge.net/packages/unrtf.htm">http://gnuwin32.sourceforge.net/packages/unrtf.htm</a>, then
install it and add it to the PATH.</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="antiword" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id3">[3]</a></td><td><code class="docutils literal notranslate"><span class="pre">antiword</span></code>: Ubuntu: <code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">apt-get</span> <span class="pre">install</span> <span class="pre">antiword</span></code>.
Windows: see <a class="reference external" href="http://www.winfield.demon.nl/">http://www.winfield.demon.nl/</a>, then install it and add it to
the PATH.</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="strings" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id4">[4]</a></td><td><code class="docutils literal notranslate"><span class="pre">strings</span></code> and <code class="docutils literal notranslate"><span class="pre">strings2</span></code>: <code class="docutils literal notranslate"><span class="pre">strings</span></code> is part of Linux by default;
for Windows, see
<a class="reference external" href="https://technet.microsoft.com/en-us/sysinternals/strings.aspx">https://technet.microsoft.com/en-us/sysinternals/strings.aspx</a> or
<a class="reference external" href="http://split-code.com/strings2.html">http://split-code.com/strings2.html</a> (then install it and add it to the
PATH.</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="vs2010" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id5">[5]</a></td><td>Visual Studio 2010; VC++ 10.0; MSC_VER=1600</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="vs2015" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id8">[6]</a></td><td>Visual Studio 2015; VC++ 14.0; MSC_VER=1900</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="python34vstudio" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id6">[7]</a></td><td>See <a class="reference external" href="http://stackoverflow.com/questions/29909330">http://stackoverflow.com/questions/29909330</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="vstudiogeneral" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id7">[8]</a></td><td>To map Visual C++/Studio versions to compiler numbers, see
<a class="reference external" href="http://stackoverflow.com/questions/2676763">http://stackoverflow.com/questions/2676763</a>. For more detail see
<a class="reference external" href="http://stackoverflow.com/questions/2817869">http://stackoverflow.com/questions/2817869</a>.</td></tr>
</tbody>
</table>
</div>
<div class="section" id="fast-murmurhash3">
<h3>4.3.9. Fast MurmurHash3<a class="headerlink" href="#fast-murmurhash3" title="Permalink to this headline">¶</a></h3>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This is optional (CRATE contains a pure-Python version), but it makes
hashing faster.</p>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pip install mmh3  <span class="c1"># C version of MurmurHash3</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="database-and-database-drivers">
<h2>4.4. Database and database drivers<a class="headerlink" href="#database-and-database-drivers" title="Permalink to this headline">¶</a></h2>
<p>You’ll want drivers for at least one database. See <a class="reference internal" href="database_drivers.html#recommended-database-drivers"><span class="std std-ref">Recommended database
drivers</span></a>.</p>
</div>
<div class="section" id="build-the-crate-java-nlp-interfaces">
<h2>4.5. Build the CRATE Java NLP interfaces<a class="headerlink" href="#build-the-crate-java-nlp-interfaces" title="Permalink to this headline">¶</a></h2>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>crate_nlp_build_gate_java_interface --help
crate_nlp_build_gate_java_interface --javac JAVA_COMPILER_FILENAME --gatedir GATE_DIRECTORY
</pre></div>
</div>
<p>For example, on Windows:</p>
<div class="highlight-bat notranslate"><div class="highlight"><pre><span></span>crate_nlp_build_gate_java_interface <span class="se">^</span>
<span class="se"> </span>   --javac <span class="s2">&quot;C:\Program Files\Java\jdk1.8.0_91\bin\javac.exe&quot;</span> <span class="se">^</span>
<span class="se"> </span>   --gatedir <span class="s2">&quot;C:\Program Files\GATE_Developer_8.1&quot;</span>
</pre></div>
</div>
<p>Once built, you can run the script again with an additional <code class="docutils literal notranslate"><span class="pre">--launch</span></code>
parameter to launch the GATE framework in an interactive demonstration mode
(using GATE’s supplied “people and places” app).</p>
</div>
<div class="section" id="configure-crate-for-your-system">
<h2>4.6. Configure CRATE for your system<a class="headerlink" href="#configure-crate-for-your-system" title="Permalink to this headline">¶</a></h2>
<p>The anonymiser and NLP manager are run on an ad-hoc or regularly scheduled
basis, and do not need to be kept running continuously.</p>
<p>For the anonymiser, you will need a .INI-style configuration file (see
<a class="reference internal" href="../anonymisation/anon_config.html#anon-config-file"><span class="std std-ref">the anonymiser config file</span></a> that the
<cite>CRATE_ANON_CONFIG</cite> environment variable points to when the anonymiser is run
(and a .TSV format data dictionary that the configuration file points to – see
<a class="reference internal" href="../anonymisation/data_dictionary.html#data-dictionary"><span class="std std-ref">data dictionary</span></a>).</p>
<p>For the NLP manager, you will need another .INI-style configuration file (see
<a class="reference internal" href="../nlp/nlp_config.html#nlp-config"><span class="std std-ref">NLP config file</span></a>) that the <cite>CRATE_NLP_CONFIG</cite> environment
variable points to when the NLP manager is run.</p>
<p>For the web service, which you will want to run continuously, you will need a
Python (Django) configuration file (see <a class="reference internal" href="../website_config/web_config_file.html#web-config-file"><span class="std std-ref">web config file</span></a>) that the <cite>CRATE_WEB_LOCAL_SETTINGS</cite> environment variable
points to when the web server processes are run. Use
<code class="docutils literal notranslate"><span class="pre">crate_print_demo_crateweb_config</span></code> to make a new one, and edit it for your
own settings.</p>
</div>
<div class="section" id="set-up-the-web-site-infrastructure">
<h2>4.7. Set up the web site infrastructure<a class="headerlink" href="#set-up-the-web-site-infrastructure" title="Permalink to this headline">¶</a></h2>
<p>Create the database yourself using your normal database management tool. Make
sure that the config file pointed to by the <cite>CRATE_WEB_LOCAL_SETTINGS</cite>
environment variable is set up to point to the database. From the activated
Python virtual environment, you want to build the admin database, collect
static files, populate relevant parts of the database, and create a superuser:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>crate_django_manage migrate
crate_django_manage collectstatic
crate_django_manage populate
crate_django_manage createsuperuser
</pre></div>
</div>
</div>
<div class="section" id="test-the-web-server-and-message-queue">
<h2>4.8. Test the web server and message queue<a class="headerlink" href="#test-the-web-server-and-message-queue" title="Permalink to this headline">¶</a></h2>
<p>In two separate command windows, with the virtual environment activated in
each, run the following two programs:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>crate_launch_cherrypy_server
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>crate_launch_celery --debug
</pre></div>
</div>
<p>Browse to the web site. Choose ‘Test message queue by sending an e-mail to the
RDBM’. If an e-mail arrives, that’s good. If you can’t see the web site,
there’s a configuration problem. If you can see the web site but no e-mail
arrives, check:</p>
<ul class="simple">
<li>that e-mail server and the RDBM e-mail destination are correctly configured
in the Django config file (as per the <cite>CRATE_WEB_LOCAL_SETTINGS</cite> environment
variable);</li>
<li>check the Django log;</li>
<li>check the Celery log;</li>
<li>from the RabbitMQ administrative command prompt, run <code class="docutils literal notranslate"><span class="pre">rabbitmqctl</span>
<span class="pre">list_queues</span> <span class="pre">name</span> <span class="pre">messages</span> <span class="pre">consumers</span></code>; this shows each queue’s name along
with the number of messages in the queue and the number of consumers. If the
number of messages is stuck at &gt;0, they’re not being consumed properly.</li>
<li>run <code class="docutils literal notranslate"><span class="pre">crate_launch_flower</span></code> and browse to <a class="reference external" href="http://localhost:5555/">http://localhost:5555/</a> to explore
the messaging system.</li>
</ul>
</div>
<div class="section" id="configure-the-crate-web-service-to-run-automatically">
<h2>4.9. Configure the CRATE web service to run automatically<a class="headerlink" href="#configure-the-crate-web-service-to-run-automatically" title="Permalink to this headline">¶</a></h2>
<p>CRATE’s web service has two parts: the web site itself runs Django, and the
offline message handling part (e.g. to send emails) runs Celery.</p>
<p><strong>Linux</strong></p>
<p>Try to avoid managing this by hand! That’s what the <cite>.deb</cite> file is there for.</p>
<p><strong>Windows: service method</strong></p>
<p>Using a privileged command prompt [e.g. on Windows 10: <span class="menuselection">Winkey+X
‣ Command Prompt (Admin)</span>], activate the virtual environment and install
the service:</p>
<div class="highlight-bat notranslate"><div class="highlight"><pre><span></span>C<span class="p">:</span><span class="nl">\venvs\crate\Scripts\activate</span>
crate_windows_service install
</pre></div>
</div>
<p>Set the following system (not user!) environment variables (if you can’t find
the Environment Variables part of Control Panel, use the command
<code class="docutils literal notranslate"><span class="pre">sysdm.cpl</span></code>):</p>
<ul class="simple">
<li><cite>CRATE_ANON_CONFIG</cite> – to your main database’s CRATE anonymisation config file</li>
<li><cite>CRATE_CHERRYPY_ARGS</cite> – e.g. to <code class="docutils literal notranslate"><span class="pre">--port</span> <span class="pre">8999</span> <span class="pre">--root_path</span> <span class="pre">/</span></code> (for relevant
options, see <code class="docutils literal notranslate"><span class="pre">crate_django_manage</span> <span class="pre">runcpserver</span> <span class="pre">--help</span></code>)</li>
<li><cite>CRATE_WEB_LOCAL_SETTINGS</cite> – to your Django site-specific Python
configuration file.</li>
<li><cite>CRATE_WINSERVICE_LOGDIR</cite> – to a writable directory.</li>
</ul>
<p>In older versions of Windows you had to reboot or the service manager wouldn’t
see it, but Windows 10 seems to cope happily. You can start the CRATE service
manually, or configure it to start automatically on boot, with the Automatic or
Automatic (Delayed Start) option <a class="footnote-reference" href="#servicedelayedstart" id="id9">[9]</a>, or (with the virtual
environment activated) with <code class="docutils literal notranslate"><span class="pre">crate_windows_service</span> <span class="pre">start</span></code>. Any messages will
appear in the Windows ‘Application’ event log.</p>
<p><strong>Windows: task scheduler method</strong></p>
<p>In principle you could also run the scripts via the Windows Task Scheduler,
rather than as a service <a class="footnote-reference" href="#taskscheduler" id="id10">[10]</a>, e.g. with tasks like</p>
<div class="highlight-bat notranslate"><div class="highlight"><pre><span></span>cmd /c C:\venvs\crate\Scripts\crate_launch_cherrypy_server <span class="p">&gt;&gt;</span>C:\crate_logs\djangolog.txt <span class="mi">2</span><span class="p">&gt;&amp;</span><span class="mi">1</span>
</pre></div>
</div>
<div class="highlight-bat notranslate"><div class="highlight"><pre><span></span>cmd /c C:\venvs\crate\Scripts\crate_launch_celery <span class="p">&gt;&gt;</span>C:\crate_logs\celerylog.txt <span class="mi">2</span><span class="p">&gt;&amp;</span><span class="mi">1</span>
</pre></div>
</div>
<p>… but I’ve not bothered to test this, as the Service method works fine.</p>
</div>
<div class="section" id="retest-the-web-server-and-message-queue">
<h2>4.10. Retest the web server and message queue<a class="headerlink" href="#retest-the-web-server-and-message-queue" title="Permalink to this headline">¶</a></h2>
<p>Going to a “behind-the-scenes” (service) mode of operation has the potential to
go wrong, so retest that the web server and the e-mail transmission task work.</p>
<p class="rubric">Footnotes</p>
<table class="docutils footnote" frame="void" id="servicedelayedstart" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id9">[9]</a></td><td><a class="reference external" href="http://stackoverflow.com/questions/11015189/automatic-vs-automatic-delayed-start">http://stackoverflow.com/questions/11015189/automatic-vs-automatic-delayed-start</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="taskscheduler" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id10">[10]</a></td><td>See
<a class="reference external" href="https://www.calazan.com/windows-tip-run-applications-in-the-background-using-task-scheduler/">https://www.calazan.com/windows-tip-run-applications-in-the-background-using-task-scheduler/</a></td></tr>
</tbody>
</table>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h3><a href="../index.html">Table Of Contents</a></h3>
<p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../introduction/overview.html">1. Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../introduction/package_elements.html">2. Package elements in brief</a></li>
<li class="toctree-l1"><a class="reference internal" href="../introduction/publications.html">3. Reference publications</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">4. Installation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#urls-for-crate-source-code">4.1. URLs for CRATE source code</a></li>
<li class="toctree-l2"><a class="reference internal" href="#ubuntu-linux-from-debian-package">4.2. Ubuntu Linux, from Debian package</a></li>
<li class="toctree-l2"><a class="reference internal" href="#manual-installation">4.3. Manual installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#database-and-database-drivers">4.4. Database and database drivers</a></li>
<li class="toctree-l2"><a class="reference internal" href="#build-the-crate-java-nlp-interfaces">4.5. Build the CRATE Java NLP interfaces</a></li>
<li class="toctree-l2"><a class="reference internal" href="#configure-crate-for-your-system">4.6. Configure CRATE for your system</a></li>
<li class="toctree-l2"><a class="reference internal" href="#set-up-the-web-site-infrastructure">4.7. Set up the web site infrastructure</a></li>
<li class="toctree-l2"><a class="reference internal" href="#test-the-web-server-and-message-queue">4.8. Test the web server and message queue</a></li>
<li class="toctree-l2"><a class="reference internal" href="#configure-the-crate-web-service-to-run-automatically">4.9. Configure the CRATE web service to run automatically</a></li>
<li class="toctree-l2"><a class="reference internal" href="#retest-the-web-server-and-message-queue">4.10. Retest the web server and message queue</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="database_drivers.html">5. Databases and database drivers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../anonymisation/index.html">6. Anonymisation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../nlp/index.html">7. Natural language processing (NLP)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../website_config/index.html">8. Configuring the CRATE web interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../website_using/index.html">9. Using the CRATE web interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc/ancillary_tools.html">10. Ancillary tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc/troubleshooting.html">11. Troubleshooting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc/technical_notes.html">12. Technical notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc/upgrading.html">13. Upgrading CRATE</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc/tcpip_ports.html">14. Common relevant TCP/IP ports</a></li>
<li class="toctree-l1"><a class="reference internal" href="../autodoc/index.html">15. Automatic documentation of source code</a></li>
<li class="toctree-l1"><a class="reference internal" href="../changelog.html">16. Change log/history</a></li>
<li class="toctree-l1"><a class="reference internal" href="../to_do.html">17. Things to do</a></li>
<li class="toctree-l1"><a class="reference internal" href="../glossary.html">18. Abbreviations and glossary</a></li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="index.html"
                        title="previous chapter">&lt;no title&gt;</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="database_drivers.html"
                        title="next chapter">5. Databases and database drivers</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/installation/installation.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="database_drivers.html" title="5. Databases and database drivers"
             >next</a> |</li>
        <li class="right" >
          <a href="index.html" title="&lt;no title&gt;"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">CRATE  documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" >&lt;no title&gt;</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2018, Rudolf Cardinal.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.7.5.
    </div>
  </body>
</html>
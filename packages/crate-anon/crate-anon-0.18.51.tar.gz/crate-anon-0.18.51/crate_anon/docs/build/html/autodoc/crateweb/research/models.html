
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>15.3.39. crate_anon.crateweb.research.models &#8212; CRATE  documentation</title>
    <link rel="stylesheet" href="../../../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/css/crate_docs.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="15.3.40. crate_anon.crateweb.research.research_db_info" href="research_db_info.html" />
    <link rel="prev" title="15.3.38. crate_anon.crateweb.research.html_functions" href="html_functions.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="research_db_info.html" title="15.3.40. crate_anon.crateweb.research.research_db_info"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="html_functions.html" title="15.3.38. crate_anon.crateweb.research.html_functions"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">CRATE  documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" >15. Automatic documentation of source code</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="../_index.html" accesskey="U">15.3. crate_anon.crateweb</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="module-crate_anon.crateweb.research.models">
<span id="crate-anon-crateweb-research-models"></span><h1>15.3.39. crate_anon.crateweb.research.models<a class="headerlink" href="#module-crate_anon.crateweb.research.models" title="Permalink to this headline">¶</a></h1>
<hr class="docutils" />
<blockquote>
<div><p>Copyright (C) 2015-2018 Rudolf Cardinal (<a class="reference external" href="mailto:rudolf&#37;&#52;&#48;pobox&#46;com">rudolf<span>&#64;</span>pobox<span>&#46;</span>com</a>).</p>
<p>This file is part of CRATE.</p>
<p>CRATE is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.</p>
<p>CRATE is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
GNU General Public License for more details.</p>
<p>You should have received a copy of the GNU General Public License
along with CRATE. If not, see &lt;<a class="reference external" href="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</a>&gt;.</p>
</div></blockquote>
<hr class="docutils" />
<dl class="class">
<dt id="crate_anon.crateweb.research.models.Highlight">
<em class="property">class </em><code class="descclassname">crate_anon.crateweb.research.models.</code><code class="descname">Highlight</code><span class="sig-paren">(</span><em>*args</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/crate_anon/crateweb/research/models.html#Highlight"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#crate_anon.crateweb.research.models.Highlight" title="Permalink to this definition">¶</a></dt>
<dd><p>Represents the highlighting of a query.</p>
<dl class="exception">
<dt id="crate_anon.crateweb.research.models.Highlight.DoesNotExist">
<em class="property">exception </em><code class="descname">DoesNotExist</code><a class="headerlink" href="#crate_anon.crateweb.research.models.Highlight.DoesNotExist" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="exception">
<dt id="crate_anon.crateweb.research.models.Highlight.MultipleObjectsReturned">
<em class="property">exception </em><code class="descname">MultipleObjectsReturned</code><a class="headerlink" href="#crate_anon.crateweb.research.models.Highlight.MultipleObjectsReturned" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="class">
<dt id="crate_anon.crateweb.research.models.PatientExplorer">
<em class="property">class </em><code class="descclassname">crate_anon.crateweb.research.models.</code><code class="descname">PatientExplorer</code><span class="sig-paren">(</span><em>*args</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/crate_anon/crateweb/research/models.html#PatientExplorer"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#crate_anon.crateweb.research.models.PatientExplorer" title="Permalink to this definition">¶</a></dt>
<dd><p>Class to explore the research database on a per-patient basis.</p>
<dl class="exception">
<dt id="crate_anon.crateweb.research.models.PatientExplorer.DoesNotExist">
<em class="property">exception </em><code class="descname">DoesNotExist</code><a class="headerlink" href="#crate_anon.crateweb.research.models.PatientExplorer.DoesNotExist" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="exception">
<dt id="crate_anon.crateweb.research.models.PatientExplorer.MultipleObjectsReturned">
<em class="property">exception </em><code class="descname">MultipleObjectsReturned</code><a class="headerlink" href="#crate_anon.crateweb.research.models.PatientExplorer.MultipleObjectsReturned" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="crate_anon.crateweb.research.models.PatientExplorer.data_finder_excel">
<code class="descname">data_finder_excel</code><a class="headerlink" href="#crate_anon.crateweb.research.models.PatientExplorer.data_finder_excel" title="Permalink to this definition">¶</a></dt>
<dd><p>Performs a SELECT COUNT(*)
Returns (fieldnames, rows).</p>
</dd></dl>

<dl class="method">
<dt id="crate_anon.crateweb.research.models.PatientExplorer.delete_if_permitted">
<code class="descname">delete_if_permitted</code><span class="sig-paren">(</span><span class="sig-paren">)</span> &#x2192; None<a class="reference internal" href="../../../_modules/crate_anon/crateweb/research/models.html#PatientExplorer.delete_if_permitted"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#crate_anon.crateweb.research.models.PatientExplorer.delete_if_permitted" title="Permalink to this definition">¶</a></dt>
<dd><p>If a PE has been audited, it isn’t properly deleted.</p>
</dd></dl>

<dl class="staticmethod">
<dt id="crate_anon.crateweb.research.models.PatientExplorer.get_executed_cursor">
<em class="property">static </em><code class="descname">get_executed_cursor</code><span class="sig-paren">(</span><em>sql: str</em>, <em>args: List[Any] = None</em><span class="sig-paren">)</span> &#x2192; django.db.backends.utils.CursorWrapper<a class="reference internal" href="../../../_modules/crate_anon/crateweb/research/models.html#PatientExplorer.get_executed_cursor"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#crate_anon.crateweb.research.models.PatientExplorer.get_executed_cursor" title="Permalink to this definition">¶</a></dt>
<dd><p>Get cursor with a query executed</p>
</dd></dl>

<dl class="method">
<dt id="crate_anon.crateweb.research.models.PatientExplorer.get_xlsx_binary">
<code class="descname">get_xlsx_binary</code><span class="sig-paren">(</span><span class="sig-paren">)</span> &#x2192; bytes<a class="reference internal" href="../../../_modules/crate_anon/crateweb/research/models.html#PatientExplorer.get_xlsx_binary"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#crate_anon.crateweb.research.models.PatientExplorer.get_xlsx_binary" title="Permalink to this definition">¶</a></dt>
<dd><p>Other notes:</p>
<ul class="simple">
<li>cell size:
<a class="reference external" href="http://stackoverflow.com/questions/13197574/python-openpyxl-column-width-size-adjust">http://stackoverflow.com/questions/13197574/python-openpyxl-column-width-size-adjust</a>
… and the “auto_size” / “bestFit” options don’t really do the job,
according to the interweb</li>
</ul>
</dd></dl>

<dl class="method">
<dt id="crate_anon.crateweb.research.models.PatientExplorer.save">
<code class="descname">save</code><span class="sig-paren">(</span><em>*args</em>, <em>**kwargs</em><span class="sig-paren">)</span> &#x2192; None<a class="reference internal" href="../../../_modules/crate_anon/crateweb/research/models.html#PatientExplorer.save"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#crate_anon.crateweb.research.models.PatientExplorer.save" title="Permalink to this definition">¶</a></dt>
<dd><p>Custom save method. Ensures that only one PatientExplorer has
active == True for a given user.
Also sets the hash.</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="crate_anon.crateweb.research.models.PatientExplorerAudit">
<em class="property">class </em><code class="descclassname">crate_anon.crateweb.research.models.</code><code class="descname">PatientExplorerAudit</code><span class="sig-paren">(</span><em>*args</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/crate_anon/crateweb/research/models.html#PatientExplorerAudit"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#crate_anon.crateweb.research.models.PatientExplorerAudit" title="Permalink to this definition">¶</a></dt>
<dd><p>Audit log for a PatientExplorer.</p>
<dl class="exception">
<dt id="crate_anon.crateweb.research.models.PatientExplorerAudit.DoesNotExist">
<em class="property">exception </em><code class="descname">DoesNotExist</code><a class="headerlink" href="#crate_anon.crateweb.research.models.PatientExplorerAudit.DoesNotExist" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="exception">
<dt id="crate_anon.crateweb.research.models.PatientExplorerAudit.MultipleObjectsReturned">
<em class="property">exception </em><code class="descname">MultipleObjectsReturned</code><a class="headerlink" href="#crate_anon.crateweb.research.models.PatientExplorerAudit.MultipleObjectsReturned" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="class">
<dt id="crate_anon.crateweb.research.models.PidLookup">
<em class="property">class </em><code class="descclassname">crate_anon.crateweb.research.models.</code><code class="descname">PidLookup</code><span class="sig-paren">(</span><em>*args</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/crate_anon/crateweb/research/models.html#PidLookup"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#crate_anon.crateweb.research.models.PidLookup" title="Permalink to this definition">¶</a></dt>
<dd><p>Lookup class for secret RID-to-PID conversion.
Used via one or other of the ‘secret’ database connections.
Intended for READ-ONLY access to that table.</p>
<p>Since we have fixed the tablenames for the anonymiser, we remove the
settings.SECRET_MAP option. See PatientInfo in
crate_anon/anonymise/models.py. Moreover, we fix the maximum length,
regardless of the specifics of the config used.</p>
<p>Use as e.g. Lookup(pid=XXX)</p>
<dl class="exception">
<dt id="crate_anon.crateweb.research.models.PidLookup.DoesNotExist">
<em class="property">exception </em><code class="descname">DoesNotExist</code><a class="headerlink" href="#crate_anon.crateweb.research.models.PidLookup.DoesNotExist" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="exception">
<dt id="crate_anon.crateweb.research.models.PidLookup.MultipleObjectsReturned">
<em class="property">exception </em><code class="descname">MultipleObjectsReturned</code><a class="headerlink" href="#crate_anon.crateweb.research.models.PidLookup.MultipleObjectsReturned" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="crate_anon.crateweb.research.models.PidLookup.save">
<code class="descname">save</code><span class="sig-paren">(</span><em>*args</em>, <em>**kwargs</em><span class="sig-paren">)</span> &#x2192; None<a class="reference internal" href="../../../_modules/crate_anon/crateweb/research/models.html#PidLookup.save"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#crate_anon.crateweb.research.models.PidLookup.save" title="Permalink to this definition">¶</a></dt>
<dd><p>Save the current instance. Override this in a subclass if you want to
control the saving process.</p>
<p>The ‘force_insert’ and ‘force_update’ parameters can be used to insist
that the “save” must be an SQL insert or update (or equivalent for
non-SQL backends), respectively. Normally, they should not be set.</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="crate_anon.crateweb.research.models.Query">
<em class="property">class </em><code class="descclassname">crate_anon.crateweb.research.models.</code><code class="descname">Query</code><span class="sig-paren">(</span><em>*args</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/crate_anon/crateweb/research/models.html#Query"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#crate_anon.crateweb.research.models.Query" title="Permalink to this definition">¶</a></dt>
<dd><p>Class to query the research database.</p>
<dl class="exception">
<dt id="crate_anon.crateweb.research.models.Query.DoesNotExist">
<em class="property">exception </em><code class="descname">DoesNotExist</code><a class="headerlink" href="#crate_anon.crateweb.research.models.Query.DoesNotExist" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="exception">
<dt id="crate_anon.crateweb.research.models.Query.MultipleObjectsReturned">
<em class="property">exception </em><code class="descname">MultipleObjectsReturned</code><a class="headerlink" href="#crate_anon.crateweb.research.models.Query.MultipleObjectsReturned" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="crate_anon.crateweb.research.models.Query.delete_if_permitted">
<code class="descname">delete_if_permitted</code><span class="sig-paren">(</span><span class="sig-paren">)</span> &#x2192; None<a class="reference internal" href="../../../_modules/crate_anon/crateweb/research/models.html#Query.delete_if_permitted"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#crate_anon.crateweb.research.models.Query.delete_if_permitted" title="Permalink to this definition">¶</a></dt>
<dd><p>If a query has been audited, it isn’t properly deleted.</p>
</dd></dl>

<dl class="method">
<dt id="crate_anon.crateweb.research.models.Query.dictfetchall">
<code class="descname">dictfetchall</code><span class="sig-paren">(</span><span class="sig-paren">)</span> &#x2192; List[Dict[str, Any]]<a class="reference internal" href="../../../_modules/crate_anon/crateweb/research/models.html#Query.dictfetchall"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#crate_anon.crateweb.research.models.Query.dictfetchall" title="Permalink to this definition">¶</a></dt>
<dd><p>Generates all results as a list of OrderedDicts.</p>
</dd></dl>

<dl class="method">
<dt id="crate_anon.crateweb.research.models.Query.get_executed_cursor">
<code class="descname">get_executed_cursor</code><span class="sig-paren">(</span><em>sql_append_raw: str = None</em><span class="sig-paren">)</span> &#x2192; django.db.backends.utils.CursorWrapper<a class="reference internal" href="../../../_modules/crate_anon/crateweb/research/models.html#Query.get_executed_cursor"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#crate_anon.crateweb.research.models.Query.get_executed_cursor" title="Permalink to this definition">¶</a></dt>
<dd><p>Get cursor with a query executed</p>
</dd></dl>

<dl class="method">
<dt id="crate_anon.crateweb.research.models.Query.get_sql_args_for_django">
<code class="descname">get_sql_args_for_django</code><span class="sig-paren">(</span><span class="sig-paren">)</span> &#x2192; Tuple[str, Union[List[Any], NoneType]]<a class="reference internal" href="../../../_modules/crate_anon/crateweb/research/models.html#Query.get_sql_args_for_django"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#crate_anon.crateweb.research.models.Query.get_sql_args_for_django" title="Permalink to this definition">¶</a></dt>
<dd><p>Get sql/args in a format suitable for Django, with %s placeholders,
or as escaped raw SQL.</p>
</dd></dl>

<dl class="method">
<dt id="crate_anon.crateweb.research.models.Query.save">
<code class="descname">save</code><span class="sig-paren">(</span><em>*args</em>, <em>**kwargs</em><span class="sig-paren">)</span> &#x2192; None<a class="reference internal" href="../../../_modules/crate_anon/crateweb/research/models.html#Query.save"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#crate_anon.crateweb.research.models.Query.save" title="Permalink to this definition">¶</a></dt>
<dd><p>Custom save method.
Ensures that only one Query has active == True for a given user.
Also sets the hash.</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="crate_anon.crateweb.research.models.QueryAudit">
<em class="property">class </em><code class="descclassname">crate_anon.crateweb.research.models.</code><code class="descname">QueryAudit</code><span class="sig-paren">(</span><em>*args</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="../../../_modules/crate_anon/crateweb/research/models.html#QueryAudit"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#crate_anon.crateweb.research.models.QueryAudit" title="Permalink to this definition">¶</a></dt>
<dd><p>Audit log for a query.</p>
<dl class="exception">
<dt id="crate_anon.crateweb.research.models.QueryAudit.DoesNotExist">
<em class="property">exception </em><code class="descname">DoesNotExist</code><a class="headerlink" href="#crate_anon.crateweb.research.models.QueryAudit.DoesNotExist" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="exception">
<dt id="crate_anon.crateweb.research.models.QueryAudit.MultipleObjectsReturned">
<em class="property">exception </em><code class="descname">MultipleObjectsReturned</code><a class="headerlink" href="#crate_anon.crateweb.research.models.QueryAudit.MultipleObjectsReturned" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="function">
<dt id="crate_anon.crateweb.research.models.gen_excel_row_elements">
<code class="descclassname">crate_anon.crateweb.research.models.</code><code class="descname">gen_excel_row_elements</code><span class="sig-paren">(</span><em>worksheet: openpyxl.worksheet.worksheet.Worksheet</em>, <em>row: Iterable</em><span class="sig-paren">)</span> &#x2192; Generator[[Any, NoneType], NoneType]<a class="reference internal" href="../../../_modules/crate_anon/crateweb/research/models.html#gen_excel_row_elements"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#crate_anon.crateweb.research.models.gen_excel_row_elements" title="Permalink to this definition">¶</a></dt>
<dd><p>Given an Excel worksheet row, generate individual cell contents, cell by
cell.</p>
<p>Reasons for this function:</p>
<ol class="arabic simple">
<li>Need a tuple/list/generator, as openpyxl checks its types manually.</li>
</ol>
<blockquote>
<div><ul>
<li><p class="first">We want to have a Worksheet object from openpyxl, and say something
like</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">ws</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
</pre></div>
</div>
<p>where “row” has come from a database query.</p>
</li>
<li><p class="first">However, openpyxl doesn’t believe in duck-typing; see
<code class="docutils literal notranslate"><span class="pre">Worksheet.append()</span></code> in <code class="docutils literal notranslate"><span class="pre">openpyxl/worksheet/worksheet.py</span></code>. So
sometimes the plain append works (e.g. from MySQL results), but
sometimes it fails, e.g. when the row is of type <code class="docutils literal notranslate"><span class="pre">pyodbc.Row</span></code>.</p>
</li>
<li><p class="first">So we must coerce it to a tuple, list, or generator.</p>
</li>
<li><p class="first">A generator will be the most efficient.</p>
</li>
</ul>
</div></blockquote>
<ol class="arabic" start="2">
<li><p class="first">If a string fails certain checks, openpyxl will raise an
IllegalCharacterError exception. We need to work around that. We’ll use
the “forgiveness, not permission” maxim.
Specifically, it dislikes strings matching its ILLEGAL_CHARACTERS_RE,
which contains unprintable low characters matching this:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="sa">r</span><span class="s1">&#39;[\000-\010]|[\013-\014]|[\016-\037]&#39;</span>
</pre></div>
</div>
<p>Note the use of octal; <code class="docutils literal notranslate"><span class="pre">\037</span></code> is decimal 31.</p>
<p>openpyxl gets to its Cell.check_string() function for these types:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">STRING_TYPES</span> <span class="o">=</span> <span class="p">(</span><span class="nb">basestring</span><span class="p">,</span> <span class="nb">unicode</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">)</span>
</pre></div>
</div>
<p>In Python 3, this means (str, str, bytes).
So we should check str and bytes. (For bytes, we’ll follow its method
of converting to str in the encoding of the worksheet’s choice.)</p>
</li>
</ol>
</dd></dl>

<dl class="function">
<dt id="crate_anon.crateweb.research.models.hack_django_pyodbc_azure_cursorwrapper">
<code class="descclassname">crate_anon.crateweb.research.models.</code><code class="descname">hack_django_pyodbc_azure_cursorwrapper</code><span class="sig-paren">(</span><span class="sig-paren">)</span> &#x2192; None<a class="reference internal" href="../../../_modules/crate_anon/crateweb/research/models.html#hack_django_pyodbc_azure_cursorwrapper"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#crate_anon.crateweb.research.models.hack_django_pyodbc_azure_cursorwrapper" title="Permalink to this definition">¶</a></dt>
<dd><p>Monkey-patch part of the <code class="docutils literal notranslate"><span class="pre">sql_server.pyodbc</span></code> library from
<code class="docutils literal notranslate"><span class="pre">django-pyodbc-azure</span></code>. It replaces the <code class="docutils literal notranslate"><span class="pre">fetchone()</span></code> method with a
version that doesn’t call <code class="docutils literal notranslate"><span class="pre">cursor.nextset()</span></code> automatically.</p>
<p><strong>It looks like this becomes unnecessary in django-pyodbc-azure==2.0.6.1
or similar, because the call to ``cursor.nextset()`` is now only performed
``if not self.connection.supports_mars``.</strong></p>
<p><em>Notes</em></p>
<ul class="simple">
<li>I thought I wanted to modify an <em>instance</em>, not a <em>class</em>
(<a class="reference external" href="https://tryolabs.com/blog/2013/07/05/run-time-method-patching-python/">https://tryolabs.com/blog/2013/07/05/run-time-method-patching-python/</a>).</li>
<li>To modify a class, we do <code class="docutils literal notranslate"><span class="pre">SomeClass.method</span> <span class="pre">=</span> <span class="pre">newmethod</span></code>.</li>
<li>But to modify an instance, we use <code class="docutils literal notranslate"><span class="pre">instance.method</span> <span class="pre">=</span>
<span class="pre">types.MethodType(newmethod,</span> <span class="pre">instance)</span></code>.</li>
<li>However, it turned out the instance was actually part of a long chain
of cursor wrappers, including the Django debug toolbar. Classes included
<code class="docutils literal notranslate"><span class="pre">debug_toolbar.panels.sql.tracking.NormalCursorWrapper</span></code>;
<code class="docutils literal notranslate"><span class="pre">django.db.backends.utils.CursorDebugWrapper</span></code>.
And in any case, modifying the class is a sensible thing.</li>
</ul>
</dd></dl>

<dl class="function">
<dt id="crate_anon.crateweb.research.models.replacement_sqlserver_pyodbc_cursorwrapper_fetchone">
<code class="descclassname">crate_anon.crateweb.research.models.</code><code class="descname">replacement_sqlserver_pyodbc_cursorwrapper_fetchone</code><span class="sig-paren">(</span><em>self</em><span class="sig-paren">)</span> &#x2192; List[Any]<a class="reference internal" href="../../../_modules/crate_anon/crateweb/research/models.html#replacement_sqlserver_pyodbc_cursorwrapper_fetchone"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#crate_anon.crateweb.research.models.replacement_sqlserver_pyodbc_cursorwrapper_fetchone" title="Permalink to this definition">¶</a></dt>
<dd><p>A function to replace <code class="docutils literal notranslate"><span class="pre">CursorWrapper.fetchone()</span></code> in
<code class="docutils literal notranslate"><span class="pre">sql_server/pyodbc/base.py</span></code> from <code class="docutils literal notranslate"><span class="pre">django-pyodbc-azure</span></code>.
This replacement function does not call <code class="docutils literal notranslate"><span class="pre">cursor.nextset()</span></code>.</p>
</dd></dl>

</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h3><a href="../../../index.html">Table Of Contents</a></h3>
<p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../introduction/overview.html">1. Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../introduction/package_elements.html">2. Package elements in brief</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../introduction/publications.html">3. Reference publications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../installation/installation.html">4. Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../installation/database_drivers.html">5. Databases and database drivers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../anonymisation/index.html">6. Anonymisation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../nlp/index.html">7. Natural language processing (NLP)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../website_config/index.html">8. Configuring the CRATE web interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../website_using/index.html">9. Using the CRATE web interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../misc/ancillary_tools.html">10. Ancillary tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../misc/troubleshooting.html">11. Troubleshooting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../misc/technical_notes.html">12. Technical notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../misc/upgrading.html">13. Upgrading CRATE</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../misc/tcpip_ports.html">14. Common relevant TCP/IP ports</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../index.html">15. Automatic documentation of source code</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../anonymise/_index.html">15.1. crate_anon.anonymise</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../common/_index.html">15.2. crate_anon.common</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../_index.html">15.3. crate_anon.crateweb</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../nlp_manager/_index.html">15.4. crate_anon.nlp_manager</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../preprocess/_index.html">15.5. crate_anon.preprocess</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tools/_index.html">15.6. crate_anon.tools</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../changelog.html">16. Change log/history</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../to_do.html">17. Things to do</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../glossary.html">18. Abbreviations and glossary</a></li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="html_functions.html"
                        title="previous chapter">15.3.38. crate_anon.crateweb.research.html_functions</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="research_db_info.html"
                        title="next chapter">15.3.40. crate_anon.crateweb.research.research_db_info</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../../../_sources/autodoc/crateweb/research/models.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="research_db_info.html" title="15.3.40. crate_anon.crateweb.research.research_db_info"
             >next</a> |</li>
        <li class="right" >
          <a href="html_functions.html" title="15.3.38. crate_anon.crateweb.research.html_functions"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">CRATE  documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" >15. Automatic documentation of source code</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="../_index.html" >15.3. crate_anon.crateweb</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2018, Rudolf Cardinal.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.7.5.
    </div>
  </body>
</html>
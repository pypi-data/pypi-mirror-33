
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>7.2. NLP config file &#8212; CRATE  documentation</title>
    <link rel="stylesheet" href="../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/css/crate_docs.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="7.3. Run the NLP" href="run_nlp.html" />
    <link rel="prev" title="7.1. Overview of NLP" href="overview.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="run_nlp.html" title="7.3. Run the NLP"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="overview.html" title="7.1. Overview of NLP"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">CRATE  documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">7. Natural language processing (NLP)</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="nlp-config-file">
<span id="nlp-config"></span><h1>7.2. NLP config file<a class="headerlink" href="#nlp-config-file" title="Permalink to this headline">¶</a></h1>
<p>This file controls the behaviour of the NLP manager. It defines source and
destination databases, and one or more <strong>NLP definitions</strong>.</p>
<p>You can generate a specimen config file with</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>crate_nlp --democonfig &gt; test_nlp_config.ini
</pre></div>
</div>
<p>You should save this, then edit it to your own needs.</p>
<p>Make it point to other necessary things, like your GATE installation if you
want to use GATE NLP.</p>
<p>For convenience, you may want the <cite>CRATE_NLP_CONFIG</cite> environment variable to
point to this file. (Otherwise you must specify it each time.)</p>
<div class="section" id="detail">
<h2>7.2.1. Detail<a class="headerlink" href="#detail" title="Permalink to this headline">¶</a></h2>
<p>The config file describes NLP definitions, such as ‘people_and_places’,
‘drugs_and_doses’, or ‘haematology_white_cell_differential’. You choose the
names of these NLP definitions as you define them. You select one when you run
the NLP manager (using the <code class="docutils literal notranslate"><span class="pre">--nlpdef</span></code> argument) <a class="footnote-reference" href="#nlpdefinitionclass" id="id1">[1]</a>.</p>
<p>The NLP definition sets out the following things.</p>
<ul class="simple">
<li><em>“Where am I going to find my source text?”</em> You specify this by giving one
or more <code class="docutils literal notranslate"><span class="pre">inputfielddefs</span></code>. Each one of those specifies (via its own config
section) a database/table/field combination, such as the ‘Notes’ field of the
‘Progress Notes’ table in the ‘RiO’ database, or the ‘text_content’ field of
the ‘Clinical_Documents’ table in the ‘CDL’ database, or some such
<a class="footnote-reference" href="#inputfieldconfig" id="id2">[2]</a>.<ul>
<li>CRATE will always store minimal source information (database, table,
integer PK) with the NLP output. However, for convenience you are also
likely to want to copy some other key information over to the output, such
as patients’ research identifiers (RIDs). You can specify these via the
<code class="docutils literal notranslate"><span class="pre">copyfields</span></code> option to the input field definitions. For validation
purposes, you might even choose to copy the full source text (just for
convenience), but it’s unlikely you’d want to do this routinely (because it
wastes space).</li>
</ul>
</li>
<li><em>“Which NLP processor will run, and where will it store its output?”</em> This
might be an external GATE program specializing in finding drug names, or one
of CRATE’s built-in regular expression (regex) parsers, such as for
inflammatory markers from blood tests. The choice of NLP processor also
determines the fields that will appear in the output; for example, a
drug-detecting NLP program might provide fields such as ‘drug’, ‘dose’,
‘units’, and ‘route’, while a white-cell differential processor might provide
output such as ‘cell type’, ‘value_in_billion_per_litre’, and so on
<a class="footnote-reference" href="#nlpparser" id="id3">[3]</a>.<ul>
<li>In fact, GATE applications can simultaneously provide <em>more than one type</em>
of output; for example, GATE’s demonstration people-and-places application
yields both ‘person’ information (rule, firstname, surname, gender…) and
‘location’ information (rule, loctype…), and it can be computationally
more efficient to run them together. Therefore, CRATE supports multiple
types of output from ‘single’ NLP processors.</li>
<li>Each NLP processor may have its own set of options. For example, the GATE
controller requires information about the specific external GATE app to
run, and about any necessary environment variables. Others, such as CRATE’s
build-in regular expression parsers, are simpler.</li>
<li>You might want all of your “drugs and doses” information to be stored in a
single table (such that drugs found in your Progress_Notes and drugs found
in your Clinical_Documents get stored together); this would be common and
sensible (and CRATE will keep a record of where the information came from).
However, it’s possible that you might want to segregate them (e.g. having
C-reactive protein information extracted from your Progress_Notes stored in
a different table to C-reactive protein information extracted from your
High_Sensitivity_CRP_Notes_For_Bobs_Project table).</li>
<li>For GATE apps that provide more than one type of output structure, you will
need to specify more than one output table.</li>
<li>You can batch different NLP processors together. For example, the demo
config batches up CRATE’s internal regular expression NLP processors
together. This is more efficient, because one record fetched from the
source database can then be sent to multiple NLP processors. However, it’s
less helpful if you are developing new NLP tools and want to be able to
re-run just one NLP tool frequently.</li>
</ul>
</li>
</ul>
<p>All NLP configuration ‘chunks’ are sections within the NLP config file, which
is in standard .INI format. For example, an input field definition is a
section; a database definition is a section; an environment variable section
for use with external programs is a section; and so on.</p>
<p>To allow incremental updates, CRATE will keep a master progress table, storing
a reference to the source information (database, table, PK), a hash of the
source information (to work out later on if the source has changed), and a
date/time when the NLP was last run, and the name of the NLP definition that
was run.</p>
<p>It’s definitely better if your source table has integer PKs, but you might not
have a choice in the matter (and be unable to add one to a read-only source
database), so CRATE also supports string PKs. In this instance it will create
an integer by hashing the string and store that along with the string PK
itself. (That integer is not guaranteed to be unique, because of <em>hash
collisions</em> <a class="footnote-reference" href="#hashcollisions" id="id4">[4]</a>, but it allows some efficiency to be added.)</p>
</div>
<div class="section" id="parallel-processing">
<h2>7.2.2. Parallel processing<a class="headerlink" href="#parallel-processing" title="Permalink to this headline">¶</a></h2>
<p>There are two ways to parallelize CRATE NLP.</p>
<ol class="arabic">
<li><p class="first">You can run multiple NLP processors at the same time, by specifying multiple
NLP processors in a single NLP definition within your configuration file.</p>
<p>There can be different source of bottlenecks. One is if database access is
limiting. Specifying multiple NLP processors means that text is fetched once
(for a given set of input fields) and then run through multiple NLP
processors in one go.</p>
<p>However, GATE apps can take e.g. 1 Gb RAM per process, so be careful if
trying to run several of those! CRATE’s regular expression parsers use very
little RAM (and can go quite fast: e.g. 2 CPUs processing about 15,000
records through 10 regex parsers in about 166 s, or of the order of 1 kHz).</p>
</li>
<li><p class="first">You can run multiple simultaneous copies of CRATE’s NLP manager.</p>
<p>This will divide up the work across the copies (by dividing up the records
retrieved from the database).</p>
</li>
</ol>
<p>You can use both strategies simultaneously.</p>
</div>
<div class="section" id="specimen-config">
<span id="specimen-nlp-config"></span><h2>7.2.3. Specimen config<a class="headerlink" href="#specimen-config" title="Permalink to this headline">¶</a></h2>
<p>Here’s the specimen config as of 2017-02-08:</p>
<div class="highlight-ini notranslate"><div class="highlight"><pre><span></span><span class="c1"># Configuration file for CRATE NLP manager (crate_nlp).</span>
<span class="c1"># Version 0.18.51 (2018-06-29).</span>
<span class="c1">#</span>
<span class="c1"># PLEASE SEE THE HELP.</span>

<span class="c1"># =============================================================================</span>
<span class="c1"># A. Individual NLP definitions</span>
<span class="c1">#</span>
<span class="c1">#    These map from INPUTS FROM YOUR DATABASE to PROCESSORS and a PROGRESS-</span>
<span class="c1">#    TRACKING DATABASE, and give names to those mappings.</span>
<span class="c1"># =============================================================================</span>
<span class="c1"># - referred to by the nlp_manager.py&#39;s command-line arguments</span>
<span class="c1"># - You are likely to need to alter these (particularly the bits in capital</span>
<span class="c1">#   letters) to refer to your own database(s).</span>

<span class="c1"># -----------------------------------------------------------------------------</span>
<span class="c1"># GATE people-and-places demo</span>
<span class="c1"># -----------------------------------------------------------------------------</span>

<span class="k">[MY_NLPDEF_NAME_LOCATION_NLP]</span>

    <span class="c1"># Input is from one or more source databases/tables/fields.</span>
    <span class="c1"># This list refers to config sections that define those fields in more</span>
    <span class="c1"># detail.</span>

<span class="na">inputfielddefs</span> <span class="o">=</span><span class="s"></span>
<span class="s">    INPUT_FIELD_CLINICAL_DOCUMENTS</span>
<span class="s">    INPUT_FIELD_PROGRESS_NOTES</span>

    <span class="c1"># Which NLP processors shall we use?</span>
    <span class="c1"># Specify these as a list of (processor_type, config_section) pairs.</span>
    <span class="c1"># For possible processor types, see &quot;crate_nlp --listprocessors&quot;.</span>

<span class="na">processors</span> <span class="o">=</span><span class="s"></span>
<span class="s">    GATE procdef_gate_name_location</span>

    <span class="c1"># To allow incremental updates, information is stored in a progress table.</span>
    <span class="c1"># The database name is a cross-reference to another section in this config</span>
    <span class="c1"># file. The table name is hard-coded to &#39;crate_nlp_progress&#39;.</span>

<span class="na">progressdb</span> <span class="o">=</span> <span class="s">DESTINATION_DATABASE</span>
<span class="na">hashphrase</span> <span class="o">=</span> <span class="s">doesnotmatter</span>
<span class="s">    # ... you should replace this with a hash phrase of your own, but it&#39;s not</span>
<span class="s">    # especially secret (it&#39;s only used for change detection and users are</span>
<span class="s">    # likely to have access to the source material anyway), and its specific</span>
<span class="s">    # value is unimportant.</span>

    <span class="c1"># Temporary tablename to use (in progress and destination databases).</span>
    <span class="c1"># Default is _crate_nlp_temptable</span>
<span class="c1"># temporary_tablename = _crate_nlp_temptable</span>

<span class="c1"># -----------------------------------------------------------------------------</span>
<span class="c1"># KConnect (Bio-YODIE) GATE app</span>
<span class="c1"># -----------------------------------------------------------------------------</span>

<span class="k">[MY_NLPDEF_KCONNECT]</span>

<span class="na">inputfielddefs</span> <span class="o">=</span><span class="s"></span>
<span class="s">    INPUT_FIELD_CLINICAL_DOCUMENTS</span>
<span class="s">    INPUT_FIELD_PROGRESS_NOTES</span>
<span class="na">processors</span> <span class="o">=</span><span class="s"></span>
<span class="s">    GATE procdef_gate_kconnect</span>
<span class="na">progressdb</span> <span class="o">=</span> <span class="s">DESTINATION_DATABASE</span>
<span class="na">hashphrase</span> <span class="o">=</span> <span class="s">doesnotmatter</span>

<span class="c1"># -----------------------------------------------------------------------------</span>
<span class="c1"># Medex-UIMA drug-finding app</span>
<span class="c1"># -----------------------------------------------------------------------------</span>

<span class="k">[MY_NLPDEF_MEDEX_DRUGS]</span>

<span class="na">inputfielddefs</span> <span class="o">=</span><span class="s"></span>
<span class="s">    INPUT_FIELD_CLINICAL_DOCUMENTS</span>
<span class="s">    INPUT_FIELD_PROGRESS_NOTES</span>
<span class="na">processors</span> <span class="o">=</span><span class="s"></span>
<span class="s">    Medex procdef_medex_drugs</span>
<span class="na">progressdb</span> <span class="o">=</span> <span class="s">DESTINATION_DATABASE</span>
<span class="na">hashphrase</span> <span class="o">=</span> <span class="s">doesnotmatter</span>

<span class="c1"># -----------------------------------------------------------------------------</span>
<span class="c1"># CRATE number-finding Python regexes</span>
<span class="c1"># -----------------------------------------------------------------------------</span>

<span class="k">[MY_NLPDEF_BIOMARKERS]</span>

<span class="na">inputfielddefs</span> <span class="o">=</span><span class="s"></span>
<span class="s">    INPUT_FIELD_CLINICAL_DOCUMENTS</span>
<span class="s">    INPUT_FIELD_PROGRESS_NOTES</span>

<span class="na">processors</span> <span class="o">=</span><span class="s"></span>
<span class="s">    # -------------------------------------------------------------------------</span>
<span class="s">    # Biochemistry</span>
<span class="s">    # -------------------------------------------------------------------------</span>
<span class="s">    CRP procdef_crp</span>
<span class="s">    CRPValidator procdef_validate_crp</span>
<span class="s">    Sodium procdef_sodium</span>
<span class="s">    SodiumValidator procdef_validate_sodium</span>
<span class="s">    TSH procdef_tsh</span>
<span class="s">    TSHValidator procdef_validate_tsh</span>
<span class="s">    # -------------------------------------------------------------------------</span>
<span class="s">    # Clinical</span>
<span class="s">    # -------------------------------------------------------------------------</span>
<span class="s">    Height procdef_height</span>
<span class="s">    HeightValidator procdef_validate_height</span>
<span class="s">    Weight procdef_weight</span>
<span class="s">    WeightValidator procdef_validate_weight</span>
<span class="s">    Bmi procdef_bmi</span>
<span class="s">    BmiValidator procdef_validate_bmi</span>
<span class="s">    Bp procdef_bp</span>
<span class="s">    BpValidator procdef_validate_bp</span>
<span class="s">    # -------------------------------------------------------------------------</span>
<span class="s">    # Cognitive</span>
<span class="s">    # -------------------------------------------------------------------------</span>
<span class="s">    MMSE procdef_mmse</span>
<span class="s">    MMSEValidator procdef_validate_mmse</span>
<span class="s">    ACE procdef_ace</span>
<span class="s">    ACEValidator procdef_validate_ace</span>
<span class="s">    MiniACE procdef_mini_ace</span>
<span class="s">    MiniACEValidator procdef_validate_mini_ace</span>
<span class="s">    MOCA procdef_moca</span>
<span class="s">    MOCAValidator procdef_validate_moca</span>
<span class="s">    # -------------------------------------------------------------------------</span>
<span class="s">    # Haematology</span>
<span class="s">    # -------------------------------------------------------------------------</span>
<span class="s">    ESR procdef_esr</span>
<span class="s">    ESRValidator procdef_validate_esr</span>
<span class="s">    WBC procdef_wbc</span>
<span class="s">    WBCValidator procdef_validate_wbc</span>
<span class="s">    Basophils procdef_basophils</span>
<span class="s">    BasophilsValidator procdef_validate_basophils</span>
<span class="s">    Eosinophils procdef_eosinophils</span>
<span class="s">    EosinophilsValidator procdef_validate_eosinophils</span>
<span class="s">    Lymphocytes procdef_lymphocytes</span>
<span class="s">    LymphocytesValidator procdef_validate_lymphocytes</span>
<span class="s">    Monocytes procdef_monocytes</span>
<span class="s">    MonocytesValidator procdef_validate_monocytes</span>
<span class="s">    Neutrophils procdef_neutrophils</span>
<span class="s">    NeutrophilsValidator procdef_validate_neutrophils</span>

<span class="na">progressdb</span> <span class="o">=</span> <span class="s">DESTINATION_DATABASE</span>
<span class="na">hashphrase</span> <span class="o">=</span> <span class="s">doesnotmatter</span>

    <span class="c1"># Specify the maximum number of rows to be processed before a COMMIT is</span>
    <span class="c1"># issued on the database transaction(s). This prevents the transaction(s)</span>
    <span class="c1"># growing too large.</span>
    <span class="c1"># Default is 1000.</span>
<span class="na">max_rows_before_commit</span> <span class="o">=</span> <span class="s">1000</span>

    <span class="c1"># Specify the maximum number of source-record bytes (approximately!) that</span>
    <span class="c1"># are processed before a COMMIT is issued on the database transaction(s).</span>
    <span class="c1"># This prevents the transaction(s) growing too large. The COMMIT will be</span>
    <span class="c1"># issued *after* this limit has been met/exceeded, so it may be exceeded if</span>
    <span class="c1"># the transaction just before the limit takes the cumulative total over the</span>
    <span class="c1"># limit.</span>
    <span class="c1"># Default is 83886080.</span>
<span class="na">max_bytes_before_commit</span> <span class="o">=</span> <span class="s">83886080</span>


<span class="c1"># =============================================================================</span>
<span class="c1"># B. NLP processor definitions</span>
<span class="c1">#</span>
<span class="c1">#    These control the behaviour of individual NLP processors.</span>
<span class="c1">#    In the case of CRATE&#39;s built-in processors, the only configuration needed</span>
<span class="c1">#    is the destination database/table, but for some, like GATE applications,</span>
<span class="c1">#    you need to define more -- such as how to run the external program, and</span>
<span class="c1">#    what sort of table structure should be created to receive the results.</span>
<span class="c1"># =============================================================================</span>
<span class="c1"># - You&#39;re likely to have to modify the destination databases these point to,</span>
<span class="c1">#   but otherwise you can probably leave them as they are.</span>

<span class="c1"># -----------------------------------------------------------------------------</span>
<span class="c1"># Specimen CRATE regular expression processor definitions</span>
<span class="c1"># -----------------------------------------------------------------------------</span>

    <span class="c1"># Most of these are very simple, and just require a destination database</span>
    <span class="c1"># (as a cross-reference to a database section within this file) and a</span>
    <span class="c1"># destination table.</span>

    <span class="c1"># Biochemistry</span>

<span class="k">[procdef_crp]</span>
<span class="na">destdb</span> <span class="o">=</span> <span class="s">DESTINATION_DATABASE</span>
<span class="na">desttable</span> <span class="o">=</span> <span class="s">crp</span>
<span class="k">[procdef_validate_crp]</span>
<span class="na">destdb</span> <span class="o">=</span> <span class="s">DESTINATION_DATABASE</span>
<span class="na">desttable</span> <span class="o">=</span> <span class="s">validate_crp</span>

<span class="k">[procdef_sodium]</span>
<span class="na">destdb</span> <span class="o">=</span> <span class="s">DESTINATION_DATABASE</span>
<span class="na">desttable</span> <span class="o">=</span> <span class="s">sodium</span>
<span class="k">[procdef_validate_sodium]</span>
<span class="na">destdb</span> <span class="o">=</span> <span class="s">DESTINATION_DATABASE</span>
<span class="na">desttable</span> <span class="o">=</span> <span class="s">validate_sodium</span>

<span class="k">[procdef_tsh]</span>
<span class="na">destdb</span> <span class="o">=</span> <span class="s">DESTINATION_DATABASE</span>
<span class="na">desttable</span> <span class="o">=</span> <span class="s">tsh</span>
<span class="k">[procdef_validate_tsh]</span>
<span class="na">destdb</span> <span class="o">=</span> <span class="s">DESTINATION_DATABASE</span>
<span class="na">desttable</span> <span class="o">=</span> <span class="s">validate_tsh</span>

    <span class="c1"># Clinical</span>

<span class="k">[procdef_height]</span>
<span class="na">destdb</span> <span class="o">=</span> <span class="s">DESTINATION_DATABASE</span>
<span class="na">desttable</span> <span class="o">=</span> <span class="s">height</span>
<span class="k">[procdef_validate_height]</span>
<span class="na">destdb</span> <span class="o">=</span> <span class="s">DESTINATION_DATABASE</span>
<span class="na">desttable</span> <span class="o">=</span> <span class="s">validate_height</span>

<span class="k">[procdef_weight]</span>
<span class="na">destdb</span> <span class="o">=</span> <span class="s">DESTINATION_DATABASE</span>
<span class="na">desttable</span> <span class="o">=</span> <span class="s">weight</span>
<span class="k">[procdef_validate_weight]</span>
<span class="na">destdb</span> <span class="o">=</span> <span class="s">DESTINATION_DATABASE</span>
<span class="na">desttable</span> <span class="o">=</span> <span class="s">validate_weight</span>

<span class="k">[procdef_bmi]</span>
<span class="na">destdb</span> <span class="o">=</span> <span class="s">DESTINATION_DATABASE</span>
<span class="na">desttable</span> <span class="o">=</span> <span class="s">bmi</span>
<span class="k">[procdef_validate_bmi]</span>
<span class="na">destdb</span> <span class="o">=</span> <span class="s">DESTINATION_DATABASE</span>
<span class="na">desttable</span> <span class="o">=</span> <span class="s">validate_bmi</span>

<span class="k">[procdef_bp]</span>
<span class="na">destdb</span> <span class="o">=</span> <span class="s">DESTINATION_DATABASE</span>
<span class="na">desttable</span> <span class="o">=</span> <span class="s">bp</span>
<span class="k">[procdef_validate_bp]</span>
<span class="na">destdb</span> <span class="o">=</span> <span class="s">DESTINATION_DATABASE</span>
<span class="na">desttable</span> <span class="o">=</span> <span class="s">validate_bp</span>

    <span class="c1"># Cognitive</span>

<span class="k">[procdef_mmse]</span>
<span class="na">destdb</span> <span class="o">=</span> <span class="s">DESTINATION_DATABASE</span>
<span class="na">desttable</span> <span class="o">=</span> <span class="s">mmse</span>
<span class="k">[procdef_validate_mmse]</span>
<span class="na">destdb</span> <span class="o">=</span> <span class="s">DESTINATION_DATABASE</span>
<span class="na">desttable</span> <span class="o">=</span> <span class="s">validate_mmse</span>

<span class="k">[procdef_ace]</span>
<span class="na">destdb</span> <span class="o">=</span> <span class="s">DESTINATION_DATABASE</span>
<span class="na">desttable</span> <span class="o">=</span> <span class="s">ace</span>
<span class="k">[procdef_validate_ace]</span>
<span class="na">destdb</span> <span class="o">=</span> <span class="s">DESTINATION_DATABASE</span>
<span class="na">desttable</span> <span class="o">=</span> <span class="s">validate_ace</span>

<span class="k">[procdef_mini_ace]</span>
<span class="na">destdb</span> <span class="o">=</span> <span class="s">DESTINATION_DATABASE</span>
<span class="na">desttable</span> <span class="o">=</span> <span class="s">mini_ace</span>
<span class="k">[procdef_validate_mini_ace]</span>
<span class="na">destdb</span> <span class="o">=</span> <span class="s">DESTINATION_DATABASE</span>
<span class="na">desttable</span> <span class="o">=</span> <span class="s">validate_mini_ace</span>

<span class="k">[procdef_moca]</span>
<span class="na">destdb</span> <span class="o">=</span> <span class="s">DESTINATION_DATABASE</span>
<span class="na">desttable</span> <span class="o">=</span> <span class="s">moca</span>
<span class="k">[procdef_validate_moca]</span>
<span class="na">destdb</span> <span class="o">=</span> <span class="s">DESTINATION_DATABASE</span>
<span class="na">desttable</span> <span class="o">=</span> <span class="s">validate_moca</span>

    <span class="c1"># Haematology</span>

<span class="k">[procdef_esr]</span>
<span class="na">destdb</span> <span class="o">=</span> <span class="s">DESTINATION_DATABASE</span>
<span class="na">desttable</span> <span class="o">=</span> <span class="s">esr</span>
<span class="k">[procdef_validate_esr]</span>
<span class="na">destdb</span> <span class="o">=</span> <span class="s">DESTINATION_DATABASE</span>
<span class="na">desttable</span> <span class="o">=</span> <span class="s">validate_esr</span>

<span class="k">[procdef_wbc]</span>
<span class="na">destdb</span> <span class="o">=</span> <span class="s">DESTINATION_DATABASE</span>
<span class="na">desttable</span> <span class="o">=</span> <span class="s">wbc</span>
<span class="k">[procdef_validate_wbc]</span>
<span class="na">destdb</span> <span class="o">=</span> <span class="s">DESTINATION_DATABASE</span>
<span class="na">desttable</span> <span class="o">=</span> <span class="s">validate_wbc</span>

<span class="k">[procdef_basophils]</span>
<span class="na">destdb</span> <span class="o">=</span> <span class="s">DESTINATION_DATABASE</span>
<span class="na">desttable</span> <span class="o">=</span> <span class="s">basophils</span>
<span class="k">[procdef_validate_basophils]</span>
<span class="na">destdb</span> <span class="o">=</span> <span class="s">DESTINATION_DATABASE</span>
<span class="na">desttable</span> <span class="o">=</span> <span class="s">validate_basophils</span>

<span class="k">[procdef_eosinophils]</span>
<span class="na">destdb</span> <span class="o">=</span> <span class="s">DESTINATION_DATABASE</span>
<span class="na">desttable</span> <span class="o">=</span> <span class="s">eosinophils</span>
<span class="k">[procdef_validate_eosinophils]</span>
<span class="na">destdb</span> <span class="o">=</span> <span class="s">DESTINATION_DATABASE</span>
<span class="na">desttable</span> <span class="o">=</span> <span class="s">validate_eosinophils</span>

<span class="k">[procdef_lymphocytes]</span>
<span class="na">destdb</span> <span class="o">=</span> <span class="s">DESTINATION_DATABASE</span>
<span class="na">desttable</span> <span class="o">=</span> <span class="s">lymphocytes</span>
<span class="k">[procdef_validate_lymphocytes]</span>
<span class="na">destdb</span> <span class="o">=</span> <span class="s">DESTINATION_DATABASE</span>
<span class="na">desttable</span> <span class="o">=</span> <span class="s">validate_lymphocytes</span>

<span class="k">[procdef_monocytes]</span>
<span class="na">destdb</span> <span class="o">=</span> <span class="s">DESTINATION_DATABASE</span>
<span class="na">desttable</span> <span class="o">=</span> <span class="s">monocytes</span>
<span class="k">[procdef_validate_monocytes]</span>
<span class="na">destdb</span> <span class="o">=</span> <span class="s">DESTINATION_DATABASE</span>
<span class="na">desttable</span> <span class="o">=</span> <span class="s">validate_monocytes</span>

<span class="k">[procdef_neutrophils]</span>
<span class="na">destdb</span> <span class="o">=</span> <span class="s">DESTINATION_DATABASE</span>
<span class="na">desttable</span> <span class="o">=</span> <span class="s">neutrophils</span>
<span class="k">[procdef_validate_neutrophils]</span>
<span class="na">destdb</span> <span class="o">=</span> <span class="s">DESTINATION_DATABASE</span>
<span class="na">desttable</span> <span class="o">=</span> <span class="s">validate_neutrophils</span>

<span class="c1"># -----------------------------------------------------------------------------</span>
<span class="c1"># Specimen GATE demo people/places processor definition</span>
<span class="c1"># -----------------------------------------------------------------------------</span>

    <span class="c1"># ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
    <span class="c1"># Define the processor</span>
    <span class="c1"># ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>

<span class="k">[procdef_gate_name_location]</span>

    <span class="c1"># Which database will this processor write to?</span>

<span class="na">destdb</span> <span class="o">=</span> <span class="s">DESTINATION_DATABASE</span>

    <span class="c1"># Map GATE &#39;_type&#39; parameters to possible destination tables (in</span>
    <span class="c1"># case-insensitive fashion). What follows is a list of pairs: the first</span>
    <span class="c1"># item is the annotation type coming out of the GATE system, and the second</span>
    <span class="c1"># is the output type section defined in this file (as a separate section).</span>
    <span class="c1"># Those sections (q.v.) define tables and columns (fields).</span>

<span class="na">outputtypemap</span> <span class="o">=</span><span class="s"></span>
<span class="s">    Person output_person</span>
<span class="s">    Location output_location</span>

    <span class="c1"># GATE NLP is done by an external program.</span>
    <span class="c1"># SEE THE MANUAL FOR DETAIL.</span>
    <span class="c1">#</span>
    <span class="c1"># Here we specify a program and associated arguments, and an optional</span>
    <span class="c1"># environment variable section.</span>
    <span class="c1"># The example shows how to use Java to launch a specific Java program</span>
    <span class="c1"># (CrateGatePipeline), having set a path to find other Java classes, and then to</span>
    <span class="c1"># pass arguments to the program itself.</span>
    <span class="c1">#</span>
    <span class="c1"># NOTE IN PARTICULAR:</span>
    <span class="c1"># - Use double quotes to encapsulate any filename that may have spaces</span>
    <span class="c1">#   within it (e.g. C:/Program Files/...).</span>
    <span class="c1">#   Use a forward slash director separator, even under Windows.</span>
    <span class="c1">#   ... ? If that doesn&#39;t work, use a double backslash, \.</span>
    <span class="c1"># - Under Windows, use a semicolon to separate parts of the Java classpath.</span>
    <span class="c1">#   Under Linux, use a colon.</span>
    <span class="c1"># - So a Linux Java classpath looks like</span>
    <span class="c1">#       /some/path:/some/other/path:/third/path</span>
    <span class="c1">#   and a Windows one looks like</span>
    <span class="c1">#       C:/some/path;C:/some/other/path;C:/third/path</span>
    <span class="c1"># - To make this simpler, we can define the environment variable OS_PATHSEP</span>
    <span class="c1">#   (by analogy to Python&#39;s os.pathsep), as below.</span>
    <span class="c1">#</span>
    <span class="c1"># You can use substitutable parameters:</span>
    <span class="c1">#</span>
    <span class="c1">#   {X}</span>
    <span class="c1">#       Substitutes variable X from the environment you specify (see</span>
    <span class="c1">#       below).</span>
    <span class="c1">#   {NLPLOGTAG}</span>
    <span class="c1">#       Additional environment variable that indicates the process being</span>
    <span class="c1">#       run; used to label the output from CrateGatePipeline.</span>

<span class="na">progargs</span> <span class="o">=</span> <span class="s">java</span>
<span class="s">    -classpath &quot;{NLPPROGDIR}&quot;{OS_PATHSEP}&quot;{GATEDIR}/bin/gate.jar&quot;{OS_PATHSEP}&quot;{GATEDIR}/lib/*&quot;</span>
<span class="s">    -Dgate.home=&quot;{GATEDIR}&quot;</span>
<span class="s">    CrateGatePipeline</span>
<span class="s">    --gate_app &quot;{GATEDIR}/plugins/ANNIE/ANNIE_with_defaults.gapp&quot;</span>
<span class="s">    --annotation Person</span>
<span class="s">    --annotation Location</span>
<span class="s">    --input_terminator END_OF_TEXT_FOR_NLP</span>
<span class="s">    --output_terminator END_OF_NLP_OUTPUT_RECORD</span>
<span class="s">    --log_tag {NLPLOGTAG}</span>
<span class="s">    --verbose</span>

<span class="na">progenvsection</span> <span class="o">=</span> <span class="s">MY_ENV_SECTION</span>

    <span class="c1"># The external program is slow, because NLP is slow. Therefore, we set up</span>
    <span class="c1"># the external program and use it repeatedly for a whole bunch of text.</span>
    <span class="c1"># Individual pieces of text are sent to it (via its stdin). We finish our</span>
    <span class="c1"># piece of text with a delimiter, which should (a) be specified in the -it</span>
    <span class="c1"># parameter above, and (b) be set below, TO THE SAME VALUE. The external</span>
    <span class="c1"># program should return a TSV-delimited set of field/value pairs, like</span>
    <span class="c1"># this:</span>
    <span class="c1">#</span>
    <span class="c1">#       field1\tvalue1\tfield2\tvalue2...</span>
    <span class="c1">#       field1\tvalue3\tfield2\tvalue4...</span>
    <span class="c1">#       ...</span>
    <span class="c1">#       TERMINATOR</span>
    <span class="c1">#</span>
    <span class="c1"># ... where TERMINATOR is something that you (a) specify with the -ot</span>
    <span class="c1"># parameter above, and (b) set below, TO THE SAME VALUE.</span>

<span class="na">input_terminator</span> <span class="o">=</span> <span class="s">END_OF_TEXT_FOR_NLP</span>
<span class="na">output_terminator</span> <span class="o">=</span> <span class="s">END_OF_NLP_OUTPUT_RECORD</span>

    <span class="c1"># If the external program leaks memory, you may wish to cap the number of</span>
    <span class="c1"># uses before it&#39;s restarted. Specify the max_external_prog_uses option if</span>
    <span class="c1"># so. Specify 0 or omit the option entirely to ignore this.</span>

<span class="c1"># max_external_prog_uses = 1000</span>

    <span class="c1"># ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
    <span class="c1"># Define the output tables used by this GATE processor</span>
    <span class="c1"># ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
    <span class="c1"># (This is an additional thing we need for GATE applications, since CRATE</span>
    <span class="c1"># doesn&#39;t automatically know what sort of output they will produce.)</span>

<span class="k">[output_person]</span>

    <span class="c1"># The tables and SPECIFIC output fields for a given GATE processor are</span>
    <span class="c1"># defined here.</span>

<span class="na">desttable</span> <span class="o">=</span> <span class="s">person</span>

<span class="na">renames</span> <span class="o">=</span>  <span class="s"># one pair per line; can quote, using shlex rules; case-sensitive</span>
<span class="s">    firstName   firstname</span>

<span class="na">destfields</span> <span class="o">=</span><span class="s"></span>
<span class="s">    rule        VARCHAR(100)</span>
<span class="s">    firstname   VARCHAR(100)</span>
<span class="s">    surname     VARCHAR(100)</span>
<span class="s">    gender      VARCHAR(7)</span>
<span class="s">    kind        VARCHAR(100)</span>

    <span class="c1"># ... longest gender: &quot;unknown&quot; (7)</span>

<span class="na">indexdefs</span> <span class="o">=</span><span class="s"></span>
<span class="s">    firstname   64</span>
<span class="s">    surname     64</span>

    <span class="c1"># ... a set of (indexed field, index length) pairs; length can be &quot;None&quot;</span>

<span class="k">[output_location]</span>

<span class="na">desttable</span> <span class="o">=</span> <span class="s">location</span>
<span class="na">renames</span> <span class="o">=</span><span class="s"></span>
<span class="s">    locType     loctype</span>
<span class="na">destfields</span> <span class="o">=</span><span class="s"></span>
<span class="s">    rule        VARCHAR(100)</span>
<span class="s">    loctype     VARCHAR(100)</span>
<span class="na">indexdefs</span> <span class="o">=</span><span class="s"></span>
<span class="s">    rule    100</span>
<span class="s">    loctype 100</span>


<span class="c1"># -----------------------------------------------------------------------------</span>
<span class="c1"># Specimen Sheffield/KCL KConnect (Bio-YODIE) processor definition</span>
<span class="c1"># -----------------------------------------------------------------------------</span>
<span class="c1"># https://gate.ac.uk/applications/bio-yodie.html</span>

    <span class="c1"># ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
    <span class="c1"># Define the processor</span>
    <span class="c1"># ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>

<span class="k">[procdef_gate_kconnect]</span>

<span class="na">destdb</span> <span class="o">=</span> <span class="s">DESTINATION_DATABASE</span>
<span class="na">outputtypemap</span> <span class="o">=</span><span class="s"></span>
<span class="s">    Disease_or_Syndrome output_disease_or_syndrome</span>
<span class="na">progargs</span> <span class="o">=</span> <span class="s">java</span>
<span class="s">    -classpath &quot;{NLPPROGDIR}&quot;{OS_PATHSEP}&quot;{GATEDIR}/bin/gate.jar&quot;{OS_PATHSEP}&quot;{GATEDIR}/lib/*&quot;</span>
<span class="s">    -Dgate.home=&quot;{GATEDIR}&quot;</span>
<span class="s">    CrateGatePipeline</span>
<span class="s">    --gate_app &quot;{KCONNECTDIR}/main-bio/main-bio.xgapp&quot;</span>
<span class="s">    --annotation Disease_or_Syndrome</span>
<span class="s">    --input_terminator END_OF_TEXT_FOR_NLP</span>
<span class="s">    --output_terminator END_OF_NLP_OUTPUT_RECORD</span>
<span class="s">    --log_tag {NLPLOGTAG}</span>
<span class="s">    --suppress_gate_stdout</span>
<span class="s">    --verbose</span>
<span class="na">progenvsection</span> <span class="o">=</span> <span class="s">MY_ENV_SECTION</span>
<span class="na">input_terminator</span> <span class="o">=</span> <span class="s">END_OF_TEXT_FOR_NLP</span>
<span class="na">output_terminator</span> <span class="o">=</span> <span class="s">END_OF_NLP_OUTPUT_RECORD</span>
<span class="c1"># max_external_prog_uses = 1000</span>

    <span class="c1"># ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
    <span class="c1"># Define the output tables used by this GATE processor</span>
    <span class="c1"># ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>

<span class="k">[output_disease_or_syndrome]</span>

<span class="na">desttable</span> <span class="o">=</span> <span class="s">kconnect_diseases</span>
<span class="na">renames</span> <span class="o">=</span><span class="s"></span>
<span class="s">    Experiencer     experiencer</span>
<span class="s">    Negation        negation</span>
<span class="s">    PREF            pref</span>
<span class="s">    STY             sty</span>
<span class="s">    TUI             tui</span>
<span class="s">    Temporality     temporality</span>
<span class="s">    VOCABS          vocabs</span>
<span class="na">destfields</span> <span class="o">=</span><span class="s"></span>
<span class="s">    # Found by manual inspection of KConnect/Bio-YODIE output from the GATE console:</span>
<span class="s">    experiencer  VARCHAR(100)  # e.g. &quot;Patient&quot;</span>
<span class="s">    negation     VARCHAR(100)  # e.g. &quot;Affirmed&quot;</span>
<span class="s">    pref         VARCHAR(100)  # e.g. &quot;Rheumatic gout&quot;; PREFferred name</span>
<span class="s">    sty          VARCHAR(100)  # e.g. &quot;Disease or Syndrome&quot;; Semantic Type (STY) [semantic type name]</span>
<span class="s">    tui          VARCHAR(4)    # e.g. &quot;T047&quot;; Type Unique Identifier (TUI) [semantic type identifier]; 4 characters; https://www.ncbi.nlm.nih.gov/books/NBK9679/</span>
<span class="s">    temporality  VARCHAR(100)  # e.g. &quot;Recent&quot;</span>
<span class="s">    vocabs       VARCHAR(255)  # e.g. &quot;AIR,MSH,NDFRT,MEDLINEPLUS,NCI,LNC,NCI_FDA,NCI,MTH,AIR,ICD9CM,LNC,SNOMEDCT_US,LCH_NW,HPO,SNOMEDCT_US,ICD9CM,SNOMEDCT_US,COSTAR,CST,DXP,QMR,OMIM,OMIM,AOD,CSP,NCI_NCI-GLOSS,CHV&quot;; list of UMLS vocabularies</span>
<span class="s">    inst         VARCHAR(8)    # e.g. &quot;C0003873&quot;; looks like a Concept Unique Identifier (CUI); 1 letter then 7 digits</span>
<span class="s">    inst_full    VARCHAR(255)  # e.g. &quot;http://linkedlifedata.com/resource/umls/id/C0003873&quot;</span>
<span class="s">    language     VARCHAR(100)  # e.g. &quot;&quot;; ?will look like &quot;ENG&quot; for English? See https://www.nlm.nih.gov/research/umls/implementation_resources/query_diagrams/er1.html</span>
<span class="s">    tui_full     VARCHAR(255)  # e.g. &quot;http://linkedlifedata.com/resource/semanticnetwork/id/T047&quot;</span>
<span class="na">indexdefs</span> <span class="o">=</span><span class="s"></span>
<span class="s">    pref    100</span>
<span class="s">    sty     100</span>
<span class="s">    tui     4</span>
<span class="s">    inst    8</span>

<span class="c1"># -----------------------------------------------------------------------------</span>
<span class="c1"># Specimen KCL GATE pharmacotherapy processor definition</span>
<span class="c1"># -----------------------------------------------------------------------------</span>
<span class="c1"># https://github.com/KHP-Informatics/brc-gate-pharmacotherapy</span>

    <span class="c1"># ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
    <span class="c1"># Define the processor</span>
    <span class="c1"># ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>

<span class="k">[procdef_gate_pharmacotherapy]</span>

<span class="na">destdb</span> <span class="o">=</span> <span class="s">DESTINATION_DATABASE</span>
<span class="na">outputtypemap</span> <span class="o">=</span><span class="s"></span>
<span class="s">    Prescription output_prescription</span>
<span class="na">progargs</span> <span class="o">=</span> <span class="s">java</span>
<span class="s">    -classpath &quot;{NLPPROGDIR}&quot;{OS_PATHSEP}&quot;{GATEDIR}/bin/gate.jar&quot;{OS_PATHSEP}&quot;{GATEDIR}/lib/*&quot;</span>
<span class="s">    -Dgate.home=&quot;{GATEDIR}&quot;</span>
<span class="s">    CrateGatePipeline</span>
<span class="s">    --gate_app &quot;{GATE_PHARMACOTHERAPY_DIR}/application.xgapp&quot;</span>
<span class="s">    --include_set Output</span>
<span class="s">    --annotation Prescription</span>
<span class="s">    --input_terminator END_OF_TEXT_FOR_NLP</span>
<span class="s">    --output_terminator END_OF_NLP_OUTPUT_RECORD</span>
<span class="s">    --log_tag {NLPLOGTAG}</span>
<span class="s">    --suppress_gate_stdout</span>
<span class="s">    --show_contents_on_crash</span>

<span class="c1">#    -v</span>
<span class="na">progenvsection</span> <span class="o">=</span> <span class="s">CPFT_ENV_SECTION</span>
<span class="na">input_terminator</span> <span class="o">=</span> <span class="s">END_OF_TEXT_FOR_NLP</span>
<span class="na">output_terminator</span> <span class="o">=</span> <span class="s">END_OF_NLP_OUTPUT_RECORD</span>
<span class="c1"># max_external_prog_uses = 1000</span>

    <span class="c1"># ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
    <span class="c1"># Define the output tables used by this GATE processor</span>
    <span class="c1"># ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>

<span class="c1"># Note new &quot;renames&quot; option, because the names of the annotations are not</span>
<span class="c1"># always valid SQL column names.</span>

<span class="k">[output_prescription]</span>

<span class="na">desttable</span> <span class="o">=</span> <span class="s">medications_gate</span>
<span class="na">renames</span> <span class="o">=</span>  <span class="s"># one pair per line; can quote, using shlex rules; case-sensitive</span>
<span class="s">    drug-type           drug_type</span>
<span class="s">    dose-value          dose_value</span>
<span class="s">    dose-unit           dose_unit</span>
<span class="s">    dose-multiple       dose_multiple</span>
<span class="s">    Directionality      directionality</span>
<span class="s">    Experiencer         experiencer</span>
<span class="s">    &quot;Length of Time&quot;    length_of_time</span>
<span class="s">    Temporality         temporality</span>
<span class="s">    &quot;Unit of Time&quot;      unit_of_time</span>
<span class="na">null_literals</span> <span class="o">=</span><span class="s"></span>
<span class="s">    # Sometimes GATE provides &quot;null&quot; for a NULL value; we can convert to SQL NULL.</span>
<span class="s">    # Sequence of words; shlex rules.</span>
<span class="s">    null</span>
<span class="s">    &quot;&quot;</span>
<span class="na">destfields</span> <span class="o">=</span><span class="s"></span>
<span class="s">    # Found by (a) manual inspection of BRC GATE pharmacotherapy output from</span>
<span class="s">    # the GATE console; (b) inspection of</span>
<span class="s">    # application-resources/schemas/Prescription.xml</span>
<span class="s">    # Note preference for DECIMAL over FLOAT/REAL; see</span>
<span class="s">    # https://stackoverflow.com/questions/1056323</span>
<span class="s">    # Note that not all annotations appear for all texts. Try e.g.:</span>
<span class="s">    #   Please start haloperidol 5mg tds.</span>
<span class="s">    #   I suggest you start haloperidol 5mg tds for one week.</span>
<span class="s">    rule            VARCHAR(100)  # not in XML but is present in a subset: e.g. &quot;weanOff&quot;; max length unclear</span>
<span class="s">    drug            VARCHAR(200)  # required string; e.g. &quot;haloperidol&quot;; max length 47 from &quot;wc -L BNF_generic.lst&quot;, 134 from BNF_trade.lst</span>
<span class="s">    drug_type       VARCHAR(100)  # required string; from &quot;drug-type&quot;; e.g. &quot;BNF_generic&quot;; ?length of longest drug &quot;.lst&quot; filename</span>
<span class="s">    dose            VARCHAR(100)  # required string; e.g. &quot;5mg&quot;; max length unclear</span>
<span class="s">    dose_value      DECIMAL       # required numeric; from &quot;dose-value&quot;; &quot;double&quot; in the XML but DECIMAL probably better; e.g. 5.0</span>
<span class="s">    dose_unit       VARCHAR(100)  # required string; from &quot;dose-unit&quot;; e.g. &quot;mg&quot;; max length unclear</span>
<span class="s">    dose_multiple   INT           # required integer; from &quot;dose-multiple&quot;; e.g. 1</span>
<span class="s">    route           VARCHAR(7)    # required string; one of: &quot;oral&quot;, &quot;im&quot;, &quot;iv&quot;, &quot;rectal&quot;, &quot;sc&quot;, &quot;dermal&quot;, &quot;unknown&quot;</span>
<span class="s">    status          VARCHAR(10)   # required; one of: &quot;start&quot;, &quot;continuing&quot;, &quot;stop&quot;</span>
<span class="s">    tense           VARCHAR(7)    # required; one of: &quot;past&quot;, &quot;present&quot;</span>
<span class="s">    date            VARCHAR(100)  # optional string; max length unclear</span>
<span class="s">    directionality  VARCHAR(100)  # optional string; max length unclear</span>
<span class="s">    experiencer     VARCHAR(100)  # optional string; e.g. &quot;Patient&quot;</span>
<span class="s">    frequency       DECIMAL       # optional numeric; &quot;double&quot; in the XML but DECIMAL probably better</span>
<span class="s">    interval        DECIMAL       # optional numeric; &quot;double&quot; in the XML but DECIMAL probably better</span>
<span class="s">    length_of_time  VARCHAR(100)  # optional string; from &quot;Length of Time&quot;; max length unclear</span>
<span class="s">    temporality     VARCHAR(100)  # optional string; e.g. &quot;Recent&quot;</span>
<span class="s">    time_unit       VARCHAR(100)  # optional string; from &quot;time-unit&quot;; e.g. &quot;day&quot;; max length unclear</span>
<span class="s">    unit_of_time    VARCHAR(100)  # optional string; from &quot;Unit of Time&quot;; max length unclear</span>
<span class="s">    when            VARCHAR(100)  # optional string; max length unclear</span>
<span class="na">indexdefs</span> <span class="o">=</span><span class="s"></span>
<span class="s">    rule    100</span>
<span class="s">    drug    200</span>
<span class="s">    route   7</span>
<span class="s">    status  10</span>
<span class="s">    tense   7</span>

<span class="c1"># -----------------------------------------------------------------------------</span>
<span class="c1"># Specimen KCL Lewy Body Diagnosis Application (LBDA) processor definition</span>
<span class="c1"># -----------------------------------------------------------------------------</span>
<span class="c1"># https://github.com/KHP-Informatics/brc-gate-LBD</span>

    <span class="c1"># ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
    <span class="c1"># Define the processor</span>
    <span class="c1"># ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>

<span class="k">[procdef_gate_kcl_lbda]</span>

    <span class="c1"># &quot;cDiagnosis&quot; is the &quot;confirmed diagnosis&quot; field, as d/w Jyoti Jyoti</span>
    <span class="c1"># 2018-03-20; see also README.md. This appears in the &quot;Automatic&quot; and the</span>
    <span class="c1"># unnamed set. There is also a near-miss one, &quot;DiagnosisAlmost&quot;, which</span>
    <span class="c1"># appears in the unnamed set.</span>
    <span class="c1">#   &quot;Mr Jones has Lewy body dementia.&quot;</span>
    <span class="c1">#       -&gt; DiagnosisAlmost</span>
    <span class="c1">#   &quot;Mr Jones has a diagnosis of Lewy body dementia.&quot;</span>
    <span class="c1">#       -&gt; DiagnosisAlmost, cDiagnosis</span>
    <span class="c1"># Note that we must use lower case in the outputtypemap.</span>

<span class="na">destdb</span> <span class="o">=</span> <span class="s">DESTINATION_DATABASE</span>
<span class="na">outputtypemap</span> <span class="o">=</span><span class="s"></span>
<span class="s">    cDiagnosis output_lbd_diagnosis</span>
<span class="s">    DiagnosisAlmost output_lbd_diagnosis</span>
<span class="na">progargs</span> <span class="o">=</span> <span class="s">java</span>
<span class="s">    -classpath &quot;{NLPPROGDIR}&quot;{OS_PATHSEP}&quot;{GATEDIR}/bin/gate.jar&quot;{OS_PATHSEP}&quot;{GATEDIR}/lib/*&quot;</span>
<span class="s">    -Dgate.home=&quot;{GATEDIR}&quot;</span>
<span class="s">    CrateGatePipeline</span>
<span class="s">    --gate_app &quot;{KCL_LBDA_DIR}/application.xgapp&quot;</span>
<span class="s">    --set_annotation &quot;&quot; DiagnosisAlmost</span>
<span class="s">    --set_annotation Automatic cDiagnosis</span>
<span class="s">    --input_terminator END_OF_TEXT_FOR_NLP</span>
<span class="s">    --output_terminator END_OF_NLP_OUTPUT_RECORD</span>
<span class="s">    --log_tag {NLPLOGTAG}</span>
<span class="s">    --suppress_gate_stdout</span>
<span class="s">    --verbose</span>
<span class="na">progenvsection</span> <span class="o">=</span> <span class="s">MY_ENV_SECTION</span>
<span class="na">input_terminator</span> <span class="o">=</span> <span class="s">END_OF_TEXT_FOR_NLP</span>
<span class="na">output_terminator</span> <span class="o">=</span> <span class="s">END_OF_NLP_OUTPUT_RECORD</span>
<span class="c1"># max_external_prog_uses = 1000</span>

    <span class="c1"># ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
    <span class="c1"># Define the output tables used by this GATE processor</span>
    <span class="c1"># ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>

<span class="k">[output_lbd_diagnosis]</span>

<span class="na">desttable</span> <span class="o">=</span> <span class="s">lewy_body_dementia_gate</span>
<span class="na">null_literals</span> <span class="o">=</span><span class="s"></span>
<span class="s">    null</span>
<span class="s">    &quot;&quot;</span>
<span class="na">destfields</span> <span class="o">=</span><span class="s"></span>
<span class="s">    # Found by</span>
<span class="s">    # (a) manual inspection of output from the GATE Developer console:</span>
<span class="s">    # - e.g. {rule=Includefin, text=Lewy body dementia}</span>
<span class="s">    # (b) inspection of contents:</span>
<span class="s">    # - run a Cygwin shell</span>
<span class="s">    # - find . -type f -exec grep cDiagnosis -l {} \;</span>
<span class="s">    # - 3 hits:</span>
<span class="s">    #       ./application-resources/jape/DiagnosisExclude2.jape</span>
<span class="s">    #           ... part of the &quot;Lewy&quot;-detection apparatus</span>
<span class="s">    #       ./application-resources/jape/text-feature.jape</span>
<span class="s">    #           ... adds &quot;text&quot; annotation to cDiagnosis Token</span>
<span class="s">    #       ./application.xgapp</span>
<span class="s">    #           ... in annotationTypes</span>
<span class="s">    # On that basis:</span>
<span class="s">    rule            VARCHAR(100)  #</span>
<span class="s">    text            VARCHAR(200)  #</span>
<span class="na">indexdefs</span> <span class="o">=</span><span class="s"></span>
<span class="s">    rule    100</span>
<span class="s">    text    200</span>

<span class="c1"># -----------------------------------------------------------------------------</span>
<span class="c1"># Specimen MedEx processor definition</span>
<span class="c1"># -----------------------------------------------------------------------------</span>
<span class="c1"># https://sbmi.uth.edu/ccb/resources/medex.htm</span>

<span class="k">[procdef_medex_drugs]</span>

<span class="na">destdb</span> <span class="o">=</span> <span class="s">DESTINATION_DATABASE</span>
<span class="na">desttable</span> <span class="o">=</span> <span class="s">drugs</span>
<span class="na">progargs</span> <span class="o">=</span> <span class="s">java</span>
<span class="s">    -classpath {NLPPROGDIR}:{MEDEXDIR}/bin:{MEDEXDIR}/lib/*</span>
<span class="s">    -Dfile.encoding=UTF-8</span>
<span class="s">    CrateMedexPipeline</span>
<span class="s">    -lt {NLPLOGTAG}</span>
<span class="s">    -v -v</span>
<span class="c1"># ... other arguments are added by the code</span>
<span class="na">progenvsection</span> <span class="o">=</span> <span class="s">MY_ENV_SECTION</span>


<span class="c1"># =============================================================================</span>
<span class="c1"># C. Environment variable definitions</span>
<span class="c1">#</span>
<span class="c1">#    We define environment variable groups here, with one group per section.</span>
<span class="c1">#    When a section is selected (e.g. by a &quot;progenvsection&quot; command in an NLP</span>
<span class="c1">#    processor definition), these variables can be substituted into the</span>
<span class="c1">#    &quot;progargs&quot; part of the NLP definition (for when external programs are</span>
<span class="c1">#    called) and are available in the operating system environment for those</span>
<span class="c1">#    programs themselves.</span>
<span class="c1"># =============================================================================</span>
<span class="c1"># - The environment will start by inheriting the parent environment, then add</span>
<span class="c1">#   variables here.</span>
<span class="c1"># - Keys are case-sensitive.</span>
<span class="c1"># - You&#39;ll need to modify this according to your local configuration.</span>

<span class="k">[MY_ENV_SECTION]</span>

<span class="na">GATEDIR</span> <span class="o">=</span> <span class="s">/home/myuser/somewhere/GATE_Developer_8.0</span>
<span class="na">NLPPROGDIR</span> <span class="o">=</span> <span class="s">/home/myuser/somewhere/crate_anon/nlp_manager/compiled_nlp_classes</span>
<span class="na">MEDEXDIR</span> <span class="o">=</span> <span class="s">/home/myuser/somewhere/Medex_UIMA_1.3.6</span>
<span class="na">KCONNECTDIR</span> <span class="o">=</span> <span class="s">/home/myuser/somewhere/yodie-pipeline-1-2-umls-only</span>
<span class="na">OS_PATHSEP</span> <span class="o">=</span> <span class="s">:</span>


<span class="c1"># =============================================================================</span>
<span class="c1"># D. Input field definitions</span>
<span class="c1">#</span>
<span class="c1">#    These define database &quot;inputs&quot; in more detail, including the database,</span>
<span class="c1">#    table, and field (column) containing the input, the associated primary key</span>
<span class="c1">#    field, and fields that should be copied to the destination to make</span>
<span class="c1">#    subsequent work easier (e.g. patient research IDs).</span>
<span class="c1"># =============================================================================</span>
<span class="c1"># - Referred to within the NLP definition, and cross-referencing database</span>
<span class="c1">#   definitions.</span>
<span class="c1"># - The &#39;copyfields&#39; are optional.</span>
<span class="c1"># - The &#39;indexed_copyfields&#39; are an optional subset of &#39;copyfields&#39;; they&#39;ll be</span>
<span class="c1">#   indexed.</span>

<span class="k">[INPUT_FIELD_CLINICAL_DOCUMENTS]</span>

<span class="na">srcdb</span> <span class="o">=</span> <span class="s">SOURCE_DATABASE</span>
<span class="na">srctable</span> <span class="o">=</span> <span class="s">EXTRACTED_CLINICAL_DOCUMENTS</span>
<span class="na">srcpkfield</span> <span class="o">=</span> <span class="s">DOCUMENT_PK</span>
<span class="na">srcfield</span> <span class="o">=</span> <span class="s">DOCUMENT_TEXT</span>
<span class="na">copyfields</span> <span class="o">=</span> <span class="s">RID_FIELD</span>
<span class="s">    TRID_FIELD</span>
<span class="na">indexed_copyfields</span> <span class="o">=</span> <span class="s">RID_FIELD</span>
<span class="s">    TRID_FIELD</span>

    <span class="c1"># Optional: specify 0 (the default) for no limit, or a number of rows (e.g.</span>
    <span class="c1"># 1000) to limit fetching, for debugging purposes.</span>
<span class="c1"># debug_row_limit = 0</span>

<span class="k">[INPUT_FIELD_PROGRESS_NOTES]</span>

<span class="na">srcdb</span> <span class="o">=</span> <span class="s">SOURCE_DATABASE</span>
<span class="na">srctable</span> <span class="o">=</span> <span class="s">PROGRESS_NOTES</span>
<span class="na">srcpkfield</span> <span class="o">=</span> <span class="s">PN_PK</span>
<span class="na">srcfield</span> <span class="o">=</span> <span class="s">PN_TEXT</span>
<span class="na">copyfields</span> <span class="o">=</span> <span class="s">RID_FIELD</span>
<span class="s">    TRID_FIELD</span>
<span class="na">indexed_copyfields</span> <span class="o">=</span> <span class="s">RID_FIELD</span>
<span class="s">    TRID_FIELD</span>


<span class="c1"># =============================================================================</span>
<span class="c1"># E. Database definitions, each in its own section</span>
<span class="c1">#</span>
<span class="c1">#    These are simply URLs that define how to connect to different databases.</span>
<span class="c1"># =============================================================================</span>
<span class="c1"># Use SQLAlchemy URLs: http://docs.sqlalchemy.org/en/latest/core/engines.html</span>

<span class="k">[SOURCE_DATABASE]</span>

<span class="na">url</span> <span class="o">=</span> <span class="s">mysql+mysqldb://anontest:XXX@127.0.0.1:3306/anonymous_output?charset=utf8</span>

<span class="k">[DESTINATION_DATABASE]</span>

<span class="na">url</span> <span class="o">=</span> <span class="s">mysql+mysqldb://anontest:XXX@127.0.0.1:3306/anonymous_output?charset=utf8</span>
</pre></div>
</div>
<p class="rubric">Footnotes</p>
<table class="docutils footnote" frame="void" id="nlpdefinitionclass" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id1">[1]</a></td><td>Internally, the config file section is represented by the <cite>NlpDefinition</cite>
class, which acts as the master config class.</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="inputfieldconfig" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id2">[2]</a></td><td>Internally, this information is represented by the <cite>InputFieldConfig</cite>
class.</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="nlpparser" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id3">[3]</a></td><td>Internally, this information is represented by classes such as
<cite>GateExtProgController</cite> and <cite>NumericalResultParser</cite>, which are subclasses
of <cite>NlpParser</cite>.</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="hashcollisions" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id4">[4]</a></td><td><a class="reference external" href="https://en.wikipedia.org/wiki/Hash_function">https://en.wikipedia.org/wiki/Hash_function</a></td></tr>
</tbody>
</table>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h3><a href="../index.html">Table Of Contents</a></h3>
<p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../introduction/overview.html">1. Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../introduction/package_elements.html">2. Package elements in brief</a></li>
<li class="toctree-l1"><a class="reference internal" href="../introduction/publications.html">3. Reference publications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../installation/installation.html">4. Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../installation/database_drivers.html">5. Databases and database drivers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../anonymisation/index.html">6. Anonymisation</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">7. Natural language processing (NLP)</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="overview.html">7.1. Overview of NLP</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">7.2. NLP config file</a></li>
<li class="toctree-l2"><a class="reference internal" href="run_nlp.html">7.3. Run the NLP</a></li>
<li class="toctree-l2"><a class="reference internal" href="crate_python_regex.html">7.4. CRATE’s Python regex NLP</a></li>
<li class="toctree-l2"><a class="reference internal" href="gate.html">7.5. GATE NLP applications</a></li>
<li class="toctree-l2"><a class="reference internal" href="medex.html">7.6. MedEx-UIMA drug NLP</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../website_config/index.html">8. Configuring the CRATE web interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../website_using/index.html">9. Using the CRATE web interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc/ancillary_tools.html">10. Ancillary tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc/troubleshooting.html">11. Troubleshooting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc/technical_notes.html">12. Technical notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc/upgrading.html">13. Upgrading CRATE</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc/tcpip_ports.html">14. Common relevant TCP/IP ports</a></li>
<li class="toctree-l1"><a class="reference internal" href="../autodoc/index.html">15. Automatic documentation of source code</a></li>
<li class="toctree-l1"><a class="reference internal" href="../changelog.html">16. Change log/history</a></li>
<li class="toctree-l1"><a class="reference internal" href="../to_do.html">17. Things to do</a></li>
<li class="toctree-l1"><a class="reference internal" href="../glossary.html">18. Abbreviations and glossary</a></li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="overview.html"
                        title="previous chapter">7.1. Overview of NLP</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="run_nlp.html"
                        title="next chapter">7.3. Run the NLP</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/nlp/nlp_config.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="run_nlp.html" title="7.3. Run the NLP"
             >next</a> |</li>
        <li class="right" >
          <a href="overview.html" title="7.1. Overview of NLP"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">CRATE  documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" >7. Natural language processing (NLP)</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2018, Rudolf Cardinal.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.7.5.
    </div>
  </body>
</html>
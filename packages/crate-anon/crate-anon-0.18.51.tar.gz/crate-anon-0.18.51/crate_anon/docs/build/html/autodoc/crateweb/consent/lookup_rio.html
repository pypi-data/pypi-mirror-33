
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>15.3.17. crate_anon.crateweb.consent.lookup_rio &#8212; CRATE  documentation</title>
    <link rel="stylesheet" href="../../../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/css/crate_docs.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="15.3.18. crate_anon.crateweb.consent.models" href="models.html" />
    <link rel="prev" title="15.3.16. crate_anon.crateweb.consent.lookup_dummy" href="lookup_dummy.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="models.html" title="15.3.18. crate_anon.crateweb.consent.models"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="lookup_dummy.html" title="15.3.16. crate_anon.crateweb.consent.lookup_dummy"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">CRATE  documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" >15. Automatic documentation of source code</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="../_index.html" accesskey="U">15.3. crate_anon.crateweb</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="module-crate_anon.crateweb.consent.lookup_rio">
<span id="crate-anon-crateweb-consent-lookup-rio"></span><h1>15.3.17. crate_anon.crateweb.consent.lookup_rio<a class="headerlink" href="#module-crate_anon.crateweb.consent.lookup_rio" title="Permalink to this headline">¶</a></h1>
<hr class="docutils" />
<blockquote>
<div><p>Copyright (C) 2015-2018 Rudolf Cardinal (<a class="reference external" href="mailto:rudolf&#37;&#52;&#48;pobox&#46;com">rudolf<span>&#64;</span>pobox<span>&#46;</span>com</a>).</p>
<p>This file is part of CRATE.</p>
<p>CRATE is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.</p>
<p>CRATE is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
GNU General Public License for more details.</p>
<p>You should have received a copy of the GNU General Public License
along with CRATE. If not, see &lt;<a class="reference external" href="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</a>&gt;.</p>
</div></blockquote>
<hr class="docutils" />
<dl class="function">
<dt id="crate_anon.crateweb.consent.lookup_rio.gen_opt_out_pids_mpids_rio_generic">
<code class="descclassname">crate_anon.crateweb.consent.lookup_rio.</code><code class="descname">gen_opt_out_pids_mpids_rio_generic</code><span class="sig-paren">(</span><em>source_db: str</em>, <em>raw_rio: bool = False</em>, <em>cpft_datamart: bool = False</em><span class="sig-paren">)</span> &#x2192; Generator[[Tuple[str, str], NoneType], NoneType]<a class="reference internal" href="../../../_modules/crate_anon/crateweb/consent/lookup_rio.html#gen_opt_out_pids_mpids_rio_generic"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#crate_anon.crateweb.consent.lookup_rio.gen_opt_out_pids_mpids_rio_generic" title="Permalink to this definition">¶</a></dt>
<dd><p>Generates (pid, mpid) tuples.</p>
</dd></dl>

<dl class="function">
<dt id="crate_anon.crateweb.consent.lookup_rio.get_latest_consent_mode_from_rio_generic">
<code class="descclassname">crate_anon.crateweb.consent.lookup_rio.</code><code class="descname">get_latest_consent_mode_from_rio_generic</code><span class="sig-paren">(</span><em>nhs_number: int, source_db: str, decisions: List[str], raw_rio: bool = False, cpft_datamart: bool = False</em><span class="sig-paren">)</span> &#x2192; Union[crate_anon.crateweb.consent.models.ConsentMode, NoneType]<a class="reference internal" href="../../../_modules/crate_anon/crateweb/consent/lookup_rio.html#get_latest_consent_mode_from_rio_generic"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#crate_anon.crateweb.consent.lookup_rio.get_latest_consent_mode_from_rio_generic" title="Permalink to this definition">¶</a></dt>
<dd><p>Shared function as very similar for the various copies of RiO data.</p>
<p>In raw RiO at CPFT, the traffic-light table is UserAssessConsentrd.
This is processed regularly into the CPFT Data Warehouse, so that
contains very fresh data and is a good choice.</p>
<p>For CPFT’s custom consent mode, built into RiO v6, the table copy in
the Data Warehouse is:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span>
    <span class="p">[</span><span class="n">ClientID</span><span class="p">]</span>  <span class="c1">-- VARCHAR(15) NOT NULL; RiO number as text</span>
    <span class="p">,[</span><span class="n">AssessmentDate</span><span class="p">]</span>  <span class="c1">-- DATETIME</span>
    <span class="p">,[</span><span class="n">ReferralNumber</span><span class="p">]</span>  <span class="c1">-- NVARCHAR(20); a small integer as text</span>
    <span class="p">,[</span><span class="n">ResearchContact</span><span class="p">]</span>  <span class="c1">-- NVARCHAR(20); &#39;RED&#39;, &#39;YELLOW&#39;, &#39;GREEN&#39;</span>
    <span class="p">,[</span><span class="n">OptOut</span><span class="p">]</span>
        <span class="c1">-- BIT; 1 for opt out; NULL (or potentially 0?) for not</span>
        <span class="c1">-- opted out</span>
    <span class="p">,[</span><span class="n">OptOutFromMedicalResearch_AfterDetailsRemoved</span><span class="p">]</span>
        <span class="c1">-- VARCHAR(1); &#39;Y&#39; for opt out; 9 for not opted out</span>
        <span class="c1">-- identical information to OptOut; OptOut is the simpler</span>
    <span class="p">,[</span><span class="n">PersonActingonBehalf_of_Patient</span><span class="p">]</span>
        <span class="c1">-- NTEXT, e.g. &#39;Mr Smith&#39; or NULL</span>
    <span class="p">,[</span><span class="n">PersonActingonBehalf_of_Patient_Relation</span><span class="p">]</span>
        <span class="c1">-- NTEXT, e.g. &#39;Husband&#39; or NULL or &#39;N/A&#39; or &#39;n/a&#39;</span>
    <span class="p">,[</span><span class="n">Personactingonbehalf_address</span><span class="p">]</span>
        <span class="c1">-- NTEXT, e.g. an address or NULL or &#39;N/A&#39; or &#39;n/a&#39;</span>
    <span class="p">,[</span><span class="n">WhoMakesDecisionFor_Patient</span><span class="p">]</span>
        <span class="c1">-- NVARCHAR(40), e.g. one of:</span>
        <span class="c1">--  &#39;16 or over, has capacity&#39;</span>
        <span class="c1">--  &#39;16 or over, lacks capacity&#39;</span>
        <span class="c1">--  &#39;Under 16, “Gillick competent”&#39;</span>
            <span class="c1">-- note left/right double quotes</span>
        <span class="c1">--  &#39;Under 16, parent/guardian consent&#39;</span>
<span class="k">FROM</span> <span class="p">[</span><span class="n">CPFT_DATAMART</span><span class="p">].[</span><span class="n">dbo</span><span class="p">].[</span><span class="n">ConsentToResearch</span><span class="p">]</span>
    <span class="c1">-- NB this is on a different CPFT server; see databases.txt</span>
</pre></div>
</div>
<p>Note also: the CPFT_DATAMART database does not provide patient-
identifiable information, except PatientOverview_RiO:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span>
    <span class="p">[</span><span class="n">NHSNumber</span><span class="p">]</span>     <span class="c1">-- VARCHAR(15); NHS number as text</span>
    <span class="p">,[</span><span class="n">ClientID</span><span class="p">]</span>     <span class="c1">-- VARCHAR(15) NOT NULL; RiO number as text</span>
    <span class="p">,[</span><span class="n">PatientName</span><span class="p">]</span>  <span class="c1">-- VARCHAR(202); e.g. &#39;Smith, John&#39;</span>
    <span class="p">,[</span><span class="n">Surname</span><span class="p">]</span>      <span class="c1">-- VARCHAR(100); e.g. &#39;Smith&#39;</span>
    <span class="p">,[</span><span class="n">DOB</span><span class="p">]</span>          <span class="c1">-- DATETIME; time part is zero</span>
    <span class="p">,[</span><span class="n">TeamStartDate</span><span class="p">]</span>    <span class="c1">-- DATETIME</span>
    <span class="p">,[</span><span class="n">TeamName</span><span class="p">]</span>         <span class="c1">-- NVARCHAR(50)</span>
    <span class="p">,[</span><span class="n">ReferralNumber</span><span class="p">]</span>   <span class="c1">-- INT NOT NULL; a small integer</span>
    <span class="p">,[</span><span class="n">LastAttendedApptDate_WithTeam</span><span class="p">]</span>    <span class="c1">-- DATE</span>
    <span class="p">,[</span><span class="n">FutureAppts_WithTeam</span><span class="p">]</span>     <span class="c1">-- DATE; just one despite the name</span>
    <span class="p">,[</span><span class="n">HCPs</span><span class="p">]</span>
        <span class="c1">-- NVARCHAR(MAX); semicolon-delimited list; e.g.</span>
        <span class="c1">-- &#39;; Alice Smith&#39;</span>
        <span class="c1">-- &#39;; Alice Smith; Bob Jones&#39;</span>
        <span class="c1">-- &#39;; Unknown Consultant&#39;</span>
<span class="k">FROM</span> <span class="p">[</span><span class="n">CPFT_DATAMART</span><span class="p">].[</span><span class="n">dbo</span><span class="p">].[</span><span class="n">PatientOverviewRiO</span><span class="p">]</span>
</pre></div>
</div>
<p>In raw RiO at CPFT, the traffic-light table is UserAssessConsentrd.</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span>
    <span class="p">[</span><span class="n">ClientID</span><span class="p">]</span>  <span class="c1">-- VARCHAR(15); RiO number as text</span>
    <span class="p">,[</span><span class="n">AssessmentDate</span><span class="p">]</span>  <span class="c1">-- DATETIME</span>
    <span class="p">,[</span><span class="n">system_ValidationData</span><span class="p">]</span>  <span class="c1">-- NTEXT; XML style</span>
    <span class="p">,[</span><span class="n">ResearchContact</span><span class="p">]</span>  <span class="c1">-- NVARCHAR(20); &#39;RED&#39;, &#39;YELLOW&#39;, &#39;GREEN&#39;, NULL</span>
    <span class="p">,[</span><span class="n">useemail</span><span class="p">]</span>  <span class="c1">-- BIT (1, 0, NULL)</span>
    <span class="p">,[</span><span class="n">optout</span><span class="p">]</span>  <span class="c1">-- BIT</span>
    <span class="p">,[</span><span class="n">capname</span><span class="p">]</span>  <span class="c1">-- NTEXT</span>
    <span class="p">,[</span><span class="n">capaddress</span><span class="p">]</span>  <span class="c1">-- NTEXT</span>
    <span class="p">,[</span><span class="n">caprelation</span><span class="p">]</span>  <span class="c1">-- NTEXT</span>
    <span class="p">,[</span><span class="n">capacity</span><span class="p">]</span>  <span class="c1">-- VARCHAR(20); e.g. &#39;a&#39;, &#39;b&#39;</span>
    <span class="p">,[</span><span class="n">type12_NoteID</span><span class="p">]</span>  <span class="c1">-- INT NOT NULL; small integer</span>
    <span class="p">,[</span><span class="n">type12_OriginalNoteID</span><span class="p">]</span>  <span class="c1">-- INT; usually NULL</span>
    <span class="p">,[</span><span class="n">type12_DeletedDate</span><span class="p">]</span>  <span class="c1">-- DATETIME; NULL if not deleted</span>
    <span class="p">,[</span><span class="n">type12_UpdatedBy</span><span class="p">]</span>  <span class="c1">-- NVARCHAR(20); username</span>
    <span class="p">,[</span><span class="n">type12_UpdatedDate</span><span class="p">]</span>  <span class="c1">-- DATETIME</span>
    <span class="p">,[</span><span class="n">formref</span><span class="p">]</span>  <span class="c1">-- NVARCHAR(20); typically a small integer as text</span>

    <span class="c1">-- If it&#39;s been preprocessed, also these:</span>
    <span class="p">,[</span><span class="n">crate_pk</span><span class="p">]</span>         <span class="c1">-- in CRATE preprocessed version only; BIGINT</span>
    <span class="p">,[</span><span class="n">crate_rio_number</span><span class="p">]</span> <span class="c1">-- in CRATE preprocessed version only; BIGINT</span>
<span class="k">FROM</span> <span class="p">[</span><span class="n">dbo</span><span class="p">].[</span><span class="n">UserAssessconsentrd</span><span class="p">]</span>
</pre></div>
</div>
<p>The NHS number table is:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span>
    <span class="p">[</span><span class="n">ClientID</span><span class="p">]</span>  <span class="c1">-- VARCHAR(15); RiO number as text</span>
    <span class="p">,[</span><span class="n">NNN</span><span class="p">]</span>  <span class="c1">-- CHAR(10); NHS number as text</span>
    <span class="c1">-- and lots more</span>
<span class="k">FROM</span> <span class="p">[</span><span class="n">dbo</span><span class="p">].</span><span class="n">ClientIndex</span><span class="p">]</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="crate_anon.crateweb.consent.lookup_rio.lookup_cpft_rio_crate_preprocessed">
<code class="descclassname">crate_anon.crateweb.consent.lookup_rio.</code><code class="descname">lookup_cpft_rio_crate_preprocessed</code><span class="sig-paren">(</span><em>lookup: crate_anon.crateweb.consent.models.PatientLookup, decisions: List[str], secret_decisions: List[str]</em><span class="sig-paren">)</span> &#x2192; None<a class="reference internal" href="../../../_modules/crate_anon/crateweb/consent/lookup_rio.html#lookup_cpft_rio_crate_preprocessed"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#crate_anon.crateweb.consent.lookup_rio.lookup_cpft_rio_crate_preprocessed" title="Permalink to this definition">¶</a></dt>
<dd><p>Here, we use the version of RiO preprocessed by the CRATE preprocessor.
This is almost identical to the RCEP version, saving us some thought and
lots of repetition of complex JOIN code to deal with the raw RiO database.</p>
<p>However, the CRATE preprocessor does this with views.
We would need to index the underlying tables; however, the CRATE
processor has also done this for us for the lookup tables, so we
don’t need so many.</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="n">USE</span> <span class="n">my_database_name</span><span class="p">;</span>

<span class="k">CREATE</span> <span class="k">INDEX</span> <span class="n">_idx_cdd_nhs</span> <span class="k">ON</span> <span class="n">ClientIndex</span> <span class="p">(</span><span class="n">NNN</span><span class="p">);</span>  <span class="c1">-- already in RiO source</span>

<span class="k">CREATE</span> <span class="k">INDEX</span> <span class="n">_idx_cnh_id</span> <span class="k">ON</span> <span class="n">ClientName</span> <span class="p">(</span><span class="n">ClientID</span><span class="p">);</span>  <span class="c1">-- already in RiO source  # noqa</span>
<span class="k">CREATE</span> <span class="k">INDEX</span> <span class="n">_idx_cnh_eff</span> <span class="k">ON</span> <span class="n">ClientName</span> <span class="p">(</span><span class="n">EffectiveDate</span><span class="p">);</span>  <span class="c1">-- ignored</span>
<span class="k">CREATE</span> <span class="k">INDEX</span> <span class="n">_idx_cnh_end</span> <span class="k">ON</span> <span class="n">ClientName</span> <span class="p">(</span><span class="n">EndDate</span><span class="p">);</span>  <span class="c1">-- ignored</span>

<span class="k">CREATE</span> <span class="k">INDEX</span> <span class="n">_idx_cah_id</span> <span class="k">ON</span> <span class="n">ClientAddress</span> <span class="p">(</span><span class="n">ClientID</span><span class="p">);</span>  <span class="c1">-- already in RiO source as part of composite index  # noqa</span>
<span class="k">CREATE</span> <span class="k">INDEX</span> <span class="n">_idx_cah_from</span> <span class="k">ON</span> <span class="n">ClientAddress</span> <span class="p">(</span><span class="n">FromDate</span><span class="p">);</span>  <span class="c1">-- ignored</span>
<span class="k">CREATE</span> <span class="k">INDEX</span> <span class="n">_idx_cah_to</span> <span class="k">ON</span> <span class="n">ClientAddress</span> <span class="p">(</span><span class="n">ToDate</span><span class="p">);</span>  <span class="c1">-- ignored</span>

<span class="k">CREATE</span> <span class="k">INDEX</span> <span class="n">_idx_cch_id</span> <span class="k">ON</span> <span class="n">ClientTelecom</span> <span class="p">(</span><span class="n">ClientID</span><span class="p">);</span>  <span class="c1">-- already in RiO source as part of composite index  # noqa</span>

<span class="k">CREATE</span> <span class="k">INDEX</span> <span class="n">_idx_cgh_id</span> <span class="k">ON</span> <span class="n">ClientHealthCareProvider</span> <span class="p">(</span><span class="n">ClientID</span><span class="p">);</span>  <span class="c1">-- already in RiO source  # noqa</span>
<span class="k">CREATE</span> <span class="k">INDEX</span> <span class="n">_idx_cgh_from</span> <span class="k">ON</span> <span class="n">ClientHealthCareProvider</span> <span class="p">(</span><span class="n">FromDate</span><span class="p">);</span>  <span class="c1">-- ignored  # noqa</span>
<span class="k">CREATE</span> <span class="k">INDEX</span> <span class="n">_idx_cgh_to</span> <span class="k">ON</span> <span class="n">ClientHealthCareProvider</span> <span class="p">(</span><span class="n">ToDate</span><span class="p">);</span>  <span class="c1">-- ignored</span>

<span class="k">CREATE</span> <span class="k">INDEX</span> <span class="n">_idx_cc_id</span> <span class="k">ON</span> <span class="n">CPACareCoordinator</span> <span class="p">(</span><span class="n">ClientID</span><span class="p">);</span>  <span class="c1">-- preprocessor adds this  # noqa</span>
<span class="k">CREATE</span> <span class="k">INDEX</span> <span class="n">_idx_cc_start</span> <span class="k">ON</span> <span class="n">CPACareCoordinator</span> <span class="p">(</span><span class="n">StartDate</span><span class="p">);</span>  <span class="c1">-- ignored</span>
<span class="k">CREATE</span> <span class="k">INDEX</span> <span class="n">_idx_cc_end</span> <span class="k">ON</span> <span class="n">CPACareCoordinator</span> <span class="p">(</span><span class="n">EndDate</span><span class="p">);</span>  <span class="c1">-- ignored</span>

<span class="k">CREATE</span> <span class="k">INDEX</span> <span class="n">_idx_ref_id</span> <span class="k">ON</span> <span class="n">AmsReferral</span> <span class="p">(</span><span class="n">ClientID</span><span class="p">);</span>  <span class="c1">-- already in RiO source as part of composite index  # noqa</span>
<span class="k">CREATE</span> <span class="k">INDEX</span> <span class="n">_idx_ref_recv</span> <span class="k">ON</span> <span class="n">AmsReferral</span> <span class="p">(</span><span class="n">ReferralReceivedDate</span><span class="p">);</span>  <span class="c1">-- ignored  # noqa</span>
<span class="k">CREATE</span> <span class="k">INDEX</span> <span class="n">_idx_ref_removal</span> <span class="k">ON</span> <span class="n">AmsReferral</span> <span class="p">(</span><span class="n">RemovalDateTime</span><span class="p">);</span>  <span class="c1">-- ignored</span>

<span class="k">CREATE</span> <span class="k">INDEX</span> <span class="n">_idx_rsh_id</span> <span class="k">ON</span> <span class="n">AmsReferralAllocation</span> <span class="p">(</span><span class="n">ClientID</span><span class="p">);</span>  <span class="c1">-- already in RiO source as part of composite index  # noqa</span>
<span class="k">CREATE</span> <span class="k">INDEX</span> <span class="n">_idx_rsh_start</span> <span class="k">ON</span> <span class="n">AmsReferralAllocation</span> <span class="p">(</span><span class="n">StartDate</span><span class="p">);</span>  <span class="c1">-- ignored</span>
<span class="k">CREATE</span> <span class="k">INDEX</span> <span class="n">_idx_rsh_end</span> <span class="k">ON</span> <span class="n">AmsReferralAllocation</span> <span class="p">(</span><span class="n">EndDate</span><span class="p">);</span>  <span class="c1">-- ignored</span>

<span class="k">CREATE</span> <span class="k">INDEX</span> <span class="n">_idx_rth_id</span> <span class="k">ON</span> <span class="n">AmsReferralTeam</span> <span class="p">(</span><span class="n">ClientID</span><span class="p">);</span>  <span class="c1">-- already in RiO source as part of composite index  # noqa</span>
<span class="k">CREATE</span> <span class="k">INDEX</span> <span class="n">_idx_rth_start</span> <span class="k">ON</span> <span class="n">AmsReferralTeam</span> <span class="p">(</span><span class="n">StartDate</span><span class="p">);</span>  <span class="c1">-- ignored</span>
<span class="k">CREATE</span> <span class="k">INDEX</span> <span class="n">_idx_rth_end</span> <span class="k">ON</span> <span class="n">AmsReferralTeam</span> <span class="p">(</span><span class="n">EndDate</span><span class="p">);</span>  <span class="c1">-- ignored</span>
</pre></div>
</div>
<p>… or alternative RiO number indexes on CRATE_COL_RIO_NUMBER field.</p>
<p>Then, the only field name differences from RCEP are:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Client_Name_History.End_Date  -- not End_Date_
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="crate_anon.crateweb.consent.lookup_rio.lookup_cpft_rio_generic">
<code class="descclassname">crate_anon.crateweb.consent.lookup_rio.</code><code class="descname">lookup_cpft_rio_generic</code><span class="sig-paren">(</span><em>lookup: crate_anon.crateweb.consent.models.PatientLookup, decisions: List[str], secret_decisions: List[str], as_crate_not_rcep: bool</em><span class="sig-paren">)</span> &#x2192; None<a class="reference internal" href="../../../_modules/crate_anon/crateweb/consent/lookup_rio.html#lookup_cpft_rio_generic"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#crate_anon.crateweb.consent.lookup_rio.lookup_cpft_rio_generic" title="Permalink to this definition">¶</a></dt>
<dd><p>Main:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Client_Demographic_Details
    Client_ID -- PK; RiO number; integer in VARCHAR(15) field
    Date_of_Birth -- DATETIME
    Date_of_Death -- DATETIME; NULL if not dead
    Death_Flag -- INT; 0 for alive, 1 for dead
    Deleted_Flag -- INT; 0 normally; 1 for deleted
    NHS_Number -- CHAR(10)
    Gender_Code -- &#39;F&#39;, &#39;M&#39;, &#39;U&#39;, &#39;X&#39;
    Gender_Description -- &#39;Male&#39;, &#39;Female&#39;, ...
</pre></div>
</div>
<p>Then, linked to it:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Client_Name_History
    Client_ID -- integer in VARCHAR(15)
    Effective_Date -- DATETIME
    End_Date_  -- DATETIME, typically NULL
          -- in the CRATE version, this is End_Date instead
    Name_Type_Code  -- &#39;1&#39; for &#39;usual name&#39;, &#39;2&#39; for &#39;Alias&#39;, &#39;3&#39;
        for &#39;Preferred name&#39;, &#39;4&#39; for &#39;Birth name&#39;, &#39;5&#39; for
        &#39;Maiden name&#39;, &#39;7&#39; for &#39;Other&#39;, &#39;CM&#39; for &#39;Client Merge&#39;;
        NVARCHAR(10)
    Name_Type_Description  -- e.g. &#39;Usual name&#39;, &#39;Alias&#39;
    Deleted_Flag -- INT

    title
    Given_Name_1  -- through to Given_Name_5
    Family_Name
    suffix
    ...

Client_Address_History
    Client_ID -- integer in VARCHAR(15)
    Address_Type_Code -- e.g. &#39;PRIMARY&#39; but also &#39;CA&#39;, &#39;FCH&#39;...
    Address_Type_Description
    Address_From_Date -- DATETIME
    Address_To_Date -- DATETIME; NULL for active ones

    Address_Line_1
    Address_Line_2
    Address_Line_3
    Address_Line_4
    Address_Line_5
    Post_Code
    ... -- no e-mail address field

Client_GP_History
    Client_ID -- integer in VARCHAR(15)
    GP_From_Date -- DATETIME
    GP_To_Date -- DATETIME; NULL for active ones

    GP_Name -- e.g. &#39;Smith JT&#39;
    GP_Practice_Address_Line1
    GP_Practice_Address_Line2
    GP_Practice_Address_Line3
    GP_Practice_Address_Line4
    GP_Practice_Address_Line5
    GP_Practice_Post_code
    ...
</pre></div>
</div>
<p>CPFT clinician details/?discharged info appear to be here:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>CPA_CareCoordinator
    Client_ID -- integer in VARCHAR(15)
    Start_Date -- DATETIME
    End_Date -- DATETIME
    End_Reason_Code
    End_Reason_Description
    End_Reason_National_Code

    Care_Coordinator_User_title
    Care_Coordinator_User_first_name
    Care_Coordinator_User_surname
    Care_Coordinator_User_email
    Care_Coordinator_User_Consultant_Flag -- INT; 0 or 1 (or NULL?)

Main_Referral_Data
    Client_ID -- integer in VARCHAR(15)
    Referral_Received_Date -- DATETIME
    Removal_DateTime -- DATETIME
    # Care_Spell_Start_Date
    # Care_Spell_End_Date -- never non-NULL in our data set
    # Discharge_HCP -- ??user closing the referral

    Referred_Consultant_User_title
    Referred_Consultant_User_first_name
    Referred_Consultant_User_surname
    Referred_Consultant_User_email
    Referred_Consultant_User_Consultant_Flag  -- 0, 1, NULL

Referral_Staff_History
    Client_ID -- integer in VARCHAR(15)
    Start_Date -- DATETIME
    End_Date -- DATETIME
    Current_At_Discharge -- INT -- ? -- 1 or NULL

    HCP_User_title
    HCP_User_first_name
    HCP_User_surname
    HCP_User_email
    HCP_User_Consultant_Flag  -- 0, 1, NULL

Referral_Team_History
        -- similar, but for teams; no individual info
    Client_ID -- integer in VARCHAR(15)
    Start_Date -- DATETIME
    End_Date -- DATETIME
    Current_At_Discharge -- INT -- ? -- 1 or NULL

    Team_Code -- NVARCHAR -- e.g. &#39;TCGMH712&#39;
    Team_Description -- NVARCHAR -- e.g. &#39;George Mackenzie&#39;
    Team_Classification_Group_Code -- NVARCHAR -- e.g. &#39;FS&#39;
    Team_Classification_Group_Description -- NVARCHAR -- e.g.
                                                    &#39;Forensic Service&#39;
</pre></div>
</div>
<p>Not obviously relevant:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Client_CPA -- records CPA start/end, etc.
Client_Professional_Contacts -- empty table!
</pre></div>
</div>
<p>Added 2017-02-27:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Client_Communications_History -- email/phone
    Client_ID -- integer in VARCHAR(15)
    Method_Code -- NVARCHAR(10); &#39;1&#39; for &#39;Telephone number&#39;, &#39;3&#39;
        for &#39;Email address&#39;, &#39;4&#39; for &#39;Minicom/textphone number&#39;
    Method_Description
    Context_Code -- e.g. &#39;1&#39; for &#39;Communication address at home&#39;,
        other codes for &#39;Vacation home...&#39;, etc.
    Context_Description
    Contact_Details -- NVARCHAR(80)
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="crate_anon.crateweb.consent.lookup_rio.lookup_cpft_rio_rcep">
<code class="descclassname">crate_anon.crateweb.consent.lookup_rio.</code><code class="descname">lookup_cpft_rio_rcep</code><span class="sig-paren">(</span><em>lookup: crate_anon.crateweb.consent.models.PatientLookup, decisions: List[str], secret_decisions: List[str]</em><span class="sig-paren">)</span> &#x2192; None<a class="reference internal" href="../../../_modules/crate_anon/crateweb/consent/lookup_rio.html#lookup_cpft_rio_rcep"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#crate_anon.crateweb.consent.lookup_rio.lookup_cpft_rio_rcep" title="Permalink to this definition">¶</a></dt>
<dd><p><strong>RiO notes, 2015-05-19</strong></p>
<p>… ADDENDUM 2017-02-27: this is the RiO database as modified by Servelec’s
RiO CRIS Extraction Program (RCEP). See also lookup_cpft_rio_raw().</p>
<p>For speed, RiO-RCEP needs these indexes:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="n">USE</span> <span class="n">my_database_name</span><span class="p">;</span>

<span class="k">CREATE</span> <span class="k">INDEX</span> <span class="n">_idx_cdd_nhs</span> <span class="k">ON</span> <span class="n">Client_Demographic_Details</span> <span class="p">(</span><span class="n">NHS_Number</span><span class="p">);</span>

<span class="k">CREATE</span> <span class="k">INDEX</span> <span class="n">_idx_cnh_id</span> <span class="k">ON</span> <span class="n">Client_Name_History</span> <span class="p">(</span><span class="n">Client_ID</span><span class="p">);</span>
<span class="k">CREATE</span> <span class="k">INDEX</span> <span class="n">_idx_cnh_eff</span> <span class="k">ON</span> <span class="n">Client_Name_History</span> <span class="p">(</span><span class="n">Effective_Date</span><span class="p">);</span>
<span class="k">CREATE</span> <span class="k">INDEX</span> <span class="n">_idx_cnh_end</span> <span class="k">ON</span> <span class="n">Client_Name_History</span> <span class="p">(</span><span class="n">End_Date_</span><span class="p">);</span>

<span class="k">CREATE</span> <span class="k">INDEX</span> <span class="n">_idx_cah_id</span> <span class="k">ON</span> <span class="n">Client_Address_History</span> <span class="p">(</span><span class="n">Client_ID</span><span class="p">);</span>
<span class="k">CREATE</span> <span class="k">INDEX</span> <span class="n">_idx_cah_from</span> <span class="k">ON</span> <span class="n">Client_Address_History</span> <span class="p">(</span><span class="n">Address_From_Date</span><span class="p">);</span>
<span class="k">CREATE</span> <span class="k">INDEX</span> <span class="n">_idx_cah_to</span> <span class="k">ON</span> <span class="n">Client_Address_History</span> <span class="p">(</span><span class="n">Address_To_Date</span><span class="p">);</span>

<span class="k">CREATE</span> <span class="k">INDEX</span> <span class="n">_idx_cch_id</span> <span class="k">ON</span> <span class="n">Client_Communications_History</span> <span class="p">(</span><span class="n">Client_ID</span><span class="p">);</span>

<span class="k">CREATE</span> <span class="k">INDEX</span> <span class="n">_idx_cgh_id</span> <span class="k">ON</span> <span class="n">Client_GP_History</span> <span class="p">(</span><span class="n">Client_ID</span><span class="p">);</span>
<span class="k">CREATE</span> <span class="k">INDEX</span> <span class="n">_idx_cgh_from</span> <span class="k">ON</span> <span class="n">Client_GP_History</span> <span class="p">(</span><span class="n">GP_From_Date</span><span class="p">);</span>
<span class="k">CREATE</span> <span class="k">INDEX</span> <span class="n">_idx_cgh_to</span> <span class="k">ON</span> <span class="n">Client_GP_History</span> <span class="p">(</span><span class="n">GP_To_Date</span><span class="p">);</span>

<span class="k">CREATE</span> <span class="k">INDEX</span> <span class="n">_idx_cc_id</span> <span class="k">ON</span> <span class="n">CPA_CareCoordinator</span> <span class="p">(</span><span class="n">Client_ID</span><span class="p">);</span>
<span class="k">CREATE</span> <span class="k">INDEX</span> <span class="n">_idx_cc_start</span> <span class="k">ON</span> <span class="n">CPA_CareCoordinator</span> <span class="p">(</span><span class="n">Start_Date</span><span class="p">);</span>
<span class="k">CREATE</span> <span class="k">INDEX</span> <span class="n">_idx_cc_end</span> <span class="k">ON</span> <span class="n">CPA_CareCoordinator</span> <span class="p">(</span><span class="n">End_Date</span><span class="p">);</span>

<span class="k">CREATE</span> <span class="k">INDEX</span> <span class="n">_idx_ref_id</span> <span class="k">ON</span> <span class="n">Main_Referral_Data</span> <span class="p">(</span><span class="n">Client_ID</span><span class="p">);</span>
<span class="k">CREATE</span> <span class="k">INDEX</span> <span class="n">_idx_ref_recv</span> <span class="k">ON</span> <span class="n">Main_Referral_Data</span> <span class="p">(</span><span class="n">Referral_Received_Date</span><span class="p">);</span>
<span class="k">CREATE</span> <span class="k">INDEX</span> <span class="n">_idx_ref_removal</span> <span class="k">ON</span> <span class="n">Main_Referral_Data</span> <span class="p">(</span><span class="n">Removal_DateTime</span><span class="p">);</span>

<span class="k">CREATE</span> <span class="k">INDEX</span> <span class="n">_idx_rsh_id</span> <span class="k">ON</span> <span class="n">Referral_Staff_History</span> <span class="p">(</span><span class="n">Client_ID</span><span class="p">);</span>
<span class="k">CREATE</span> <span class="k">INDEX</span> <span class="n">_idx_rsh_start</span> <span class="k">ON</span> <span class="n">Referral_Staff_History</span> <span class="p">(</span><span class="n">Start_Date</span><span class="p">);</span>
<span class="k">CREATE</span> <span class="k">INDEX</span> <span class="n">_idx_rsh_end</span> <span class="k">ON</span> <span class="n">Referral_Staff_History</span> <span class="p">(</span><span class="n">End_Date</span><span class="p">);</span>

<span class="k">CREATE</span> <span class="k">INDEX</span> <span class="n">_idx_rth_id</span> <span class="k">ON</span> <span class="n">Referral_Team_History</span> <span class="p">(</span><span class="n">Client_ID</span><span class="p">);</span>
<span class="k">CREATE</span> <span class="k">INDEX</span> <span class="n">_idx_rth_start</span> <span class="k">ON</span> <span class="n">Referral_Team_History</span> <span class="p">(</span><span class="n">Start_Date</span><span class="p">);</span>
<span class="k">CREATE</span> <span class="k">INDEX</span> <span class="n">_idx_rth_end</span> <span class="k">ON</span> <span class="n">Referral_Team_History</span> <span class="p">(</span><span class="n">End_Date</span><span class="p">);</span>

<span class="c1">-- CREATE INDEX _idx_rth_teamdesc ON Referral_Team_History (Team_Description);  # noqa</span>
</pre></div>
</div>
</dd></dl>

</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h3><a href="../../../index.html">Table Of Contents</a></h3>
<p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../introduction/overview.html">1. Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../introduction/package_elements.html">2. Package elements in brief</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../introduction/publications.html">3. Reference publications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../installation/installation.html">4. Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../installation/database_drivers.html">5. Databases and database drivers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../anonymisation/index.html">6. Anonymisation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../nlp/index.html">7. Natural language processing (NLP)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../website_config/index.html">8. Configuring the CRATE web interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../website_using/index.html">9. Using the CRATE web interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../misc/ancillary_tools.html">10. Ancillary tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../misc/troubleshooting.html">11. Troubleshooting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../misc/technical_notes.html">12. Technical notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../misc/upgrading.html">13. Upgrading CRATE</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../misc/tcpip_ports.html">14. Common relevant TCP/IP ports</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../index.html">15. Automatic documentation of source code</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../anonymise/_index.html">15.1. crate_anon.anonymise</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../common/_index.html">15.2. crate_anon.common</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../_index.html">15.3. crate_anon.crateweb</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../nlp_manager/_index.html">15.4. crate_anon.nlp_manager</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../preprocess/_index.html">15.5. crate_anon.preprocess</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tools/_index.html">15.6. crate_anon.tools</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../changelog.html">16. Change log/history</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../to_do.html">17. Things to do</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../glossary.html">18. Abbreviations and glossary</a></li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="lookup_dummy.html"
                        title="previous chapter">15.3.16. crate_anon.crateweb.consent.lookup_dummy</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="models.html"
                        title="next chapter">15.3.18. crate_anon.crateweb.consent.models</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../../../_sources/autodoc/crateweb/consent/lookup_rio.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="models.html" title="15.3.18. crate_anon.crateweb.consent.models"
             >next</a> |</li>
        <li class="right" >
          <a href="lookup_dummy.html" title="15.3.16. crate_anon.crateweb.consent.lookup_dummy"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">CRATE  documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" >15. Automatic documentation of source code</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="../_index.html" >15.3. crate_anon.crateweb</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2018, Rudolf Cardinal.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.7.5.
    </div>
  </body>
</html>